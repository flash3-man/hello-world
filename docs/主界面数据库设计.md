# ä¸»ç•Œé¢æ•°æ®åº“è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†æ”¯æŒä¸»ç•Œé¢åŠŸèƒ½çš„æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡ï¼ŒåŒ…æ‹¬é”€å”®æ•°æ®ã€é¢„è­¦ä¿¡æ¯ã€ç”¨æˆ·é…ç½®ã€ç›®æ ‡ç®¡ç†ç­‰æ ¸å¿ƒä¸šåŠ¡è¡¨ã€‚

## ğŸ—„ï¸ æ ¸å¿ƒæ•°æ®è¡¨è®¾è®¡

### 1. é”€å”®æ•°æ®è¡¨ (sales_data)

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨ç”¨æˆ·çš„é”€å”®æ•°æ®ï¼Œæ”¯æŒæŒ‰æ—¥æœŸç»Ÿè®¡å’ŒæŸ¥è¯¢

```sql
CREATE TABLE sales_data (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    date DATE NOT NULL COMMENT 'æ•°æ®æ—¥æœŸ',
    total_sales DECIMAL(15,2) DEFAULT 0 COMMENT 'æ€»é”€å”®é¢',
    net_sales DECIMAL(15,2) DEFAULT 0 COMMENT 'å‡€é”€å”®é¢',
    settled_sales DECIMAL(15,2) DEFAULT 0 COMMENT 'å·²ç»“ç®—é”€å”®é¢',
    unsettled_sales DECIMAL(15,2) DEFAULT 0 COMMENT 'æœªç»“ç®—é”€å”®é¢',
    return_amount DECIMAL(15,2) DEFAULT 0 COMMENT 'é€€è´§é‡‘é¢',
    receivables DECIMAL(15,2) DEFAULT 0 COMMENT 'åº”æ”¶ä½™é¢',
    customer_payment DECIMAL(15,2) DEFAULT 0 COMMENT 'å®¢æˆ·å›æ¬¾',
    order_count INT DEFAULT 0 COMMENT 'è®¢å•æ•°é‡',
    customer_count INT DEFAULT 0 COMMENT 'å®¢æˆ·æ•°é‡',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    
    INDEX idx_user_date (user_id, date),
    INDEX idx_date (date),
    UNIQUE KEY uk_user_date (user_id, date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é”€å”®æ•°æ®è¡¨';
```

### 2. é¢„è­¦ä¿¡æ¯è¡¨ (alerts)

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨ç³»ç»Ÿç”Ÿæˆçš„å„ç±»é¢„è­¦ä¿¡æ¯

```sql
CREATE TABLE alerts (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    title VARCHAR(200) NOT NULL COMMENT 'é¢„è­¦æ ‡é¢˜',
    message VARCHAR(500) NOT NULL COMMENT 'é¢„è­¦æ¶ˆæ¯',
    priority ENUM('low', 'medium', 'high') DEFAULT 'medium' COMMENT 'ä¼˜å…ˆçº§',
    type VARCHAR(50) NOT NULL COMMENT 'é¢„è­¦ç±»å‹',
    details JSON COMMENT 'è¯¦ç»†ä¿¡æ¯',
    is_read BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦å·²è¯»',
    related_id VARCHAR(100) COMMENT 'å…³è”ä¸šåŠ¡ID',
    expires_at TIMESTAMP NULL COMMENT 'è¿‡æœŸæ—¶é—´',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    
    INDEX idx_user_priority (user_id, priority),
    INDEX idx_user_unread (user_id, is_read),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é¢„è­¦ä¿¡æ¯è¡¨';
```

### 3. ç”¨æˆ·åŠŸèƒ½é…ç½®è¡¨ (user_function_config)

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨ç”¨æˆ·çš„å¿«é€ŸåŠŸèƒ½é…ç½®

```sql
CREATE TABLE user_function_config (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    function_id VARCHAR(50) NOT NULL COMMENT 'åŠŸèƒ½ID',
    function_name VARCHAR(100) NOT NULL COMMENT 'åŠŸèƒ½åç§°',
    icon VARCHAR(50) COMMENT 'å›¾æ ‡åç§°',
    route VARCHAR(200) COMMENT 'è·¯ç”±åœ°å€',
    display_order INT DEFAULT 0 COMMENT 'æ˜¾ç¤ºé¡ºåº',
    is_enabled BOOLEAN DEFAULT TRUE COMMENT 'æ˜¯å¦å¯ç”¨',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    
    UNIQUE KEY uk_user_function (user_id, function_id),
    INDEX idx_user_order (user_id, display_order)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·åŠŸèƒ½é…ç½®è¡¨';
```

### 4. ç›®æ ‡ç®¡ç†è¡¨ (goals)

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨ç”¨æˆ·è®¾å®šçš„å„ç±»ç›®æ ‡

```sql
CREATE TABLE goals (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    name VARCHAR(100) NOT NULL COMMENT 'ç›®æ ‡åç§°',
    target_value DECIMAL(15,2) NOT NULL COMMENT 'ç›®æ ‡å€¼',
    achieved_value DECIMAL(15,2) DEFAULT 0 COMMENT 'å·²å®Œæˆå€¼',
    start_date DATE NOT NULL COMMENT 'å¼€å§‹æ—¥æœŸ',
    end_date DATE NOT NULL COMMENT 'ç»“æŸæ—¥æœŸ',
    status ENUM('active', 'completed', 'paused') DEFAULT 'active' COMMENT 'çŠ¶æ€',
    completion_rate DECIMAL(5,2) DEFAULT 0 COMMENT 'å®Œæˆç‡',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    
    INDEX idx_user_status (user_id, status),
    INDEX idx_date_range (start_date, end_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç›®æ ‡ç®¡ç†è¡¨';
```

### 5. æœç´¢å†å²è¡¨ (search_history)

**è¡¨è¯´æ˜ï¼š** å­˜å‚¨ç”¨æˆ·çš„æœç´¢å†å²è®°å½•

```sql
CREATE TABLE search_history (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    keyword VARCHAR(200) NOT NULL COMMENT 'æœç´¢å…³é”®è¯',
    search_type VARCHAR(50) COMMENT 'æœç´¢ç±»å‹',
    result_count INT DEFAULT 0 COMMENT 'ç»“æœæ•°é‡',
    search_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'æœç´¢æ—¶é—´',
    
    INDEX idx_user_time (user_id, search_time),
    INDEX idx_keyword (keyword)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æœç´¢å†å²è¡¨';
```

## ğŸ“Š æ•°æ®å…³ç³»å›¾

```mermaid
erDiagram
    USERS ||--o{ SALES_DATA : has
    USERS ||--o{ ALERTS : receives
    USERS ||--o{ USER_FUNCTION_CONFIG : configures
    USERS ||--o{ GOALS : sets
    USERS ||--o{ SEARCH_HISTORY : searches
    
    SALES_DATA {
        bigint id PK
        bigint user_id FK
        date date
        decimal total_sales
        decimal net_sales
        decimal settled_sales
        decimal unsettled_sales
        decimal return_amount
        decimal receivables
        decimal customer_payment
    }
    
    ALERTS {
        bigint id PK
        bigint user_id FK
        varchar title
        varchar message
        enum priority
        varchar type
        json details
        boolean is_read
    }
    
    USER_FUNCTION_CONFIG {
        bigint id PK
        bigint user_id FK
        varchar function_id
        varchar function_name
        varchar icon
        varchar route
        int display_order
        boolean is_enabled
    }
    
    GOALS {
        bigint id PK
        bigint user_id FK
        varchar name
        decimal target_value
        decimal achieved_value
        date start_date
        date end_date
        enum status
        decimal completion_rate
    }
```

## ğŸ” å¸¸ç”¨æŸ¥è¯¢è¯­å¥

### 1. è·å–ç”¨æˆ·å½“æœˆé”€å”®æ•°æ®
```sql
SELECT 
    SUM(total_sales) as month_total_sales,
    SUM(net_sales) as month_net_sales,
    SUM(settled_sales) as month_settled_sales,
    SUM(unsettled_sales) as month_unsettled_sales,
    SUM(return_amount) as month_return_amount,
    AVG(receivables) as avg_receivables,
    SUM(customer_payment) as month_customer_payment
FROM sales_data 
WHERE user_id = ? 
    AND date >= DATE_FORMAT(NOW(), '%Y-%m-01')
    AND date <= LAST_DAY(NOW());
```

### 2. è·å–ç”¨æˆ·ä»Šæ—¥å’Œæ˜¨æ—¥é”€å”®å¯¹æ¯”
```sql
SELECT 
    DATE(date) as sales_date,
    total_sales,
    net_sales,
    order_count,
    customer_count
FROM sales_data 
WHERE user_id = ? 
    AND date IN (CURDATE(), DATE_SUB(CURDATE(), INTERVAL 1 DAY))
ORDER BY date DESC;
```

### 3. è·å–ç”¨æˆ·æœªè¯»é«˜ä¼˜å…ˆçº§é¢„è­¦
```sql
SELECT 
    id,
    title,
    message,
    priority,
    type,
    details,
    created_at
FROM alerts 
WHERE user_id = ? 
    AND is_read = FALSE 
    AND priority = 'high'
    AND (expires_at IS NULL OR expires_at > NOW())
ORDER BY created_at DESC
LIMIT 5;
```

### 4. è·å–ç”¨æˆ·åŠŸèƒ½é…ç½®
```sql
SELECT 
    function_id,
    function_name,
    icon,
    route,
    display_order
FROM user_function_config 
WHERE user_id = ? 
    AND is_enabled = TRUE
ORDER BY display_order ASC
LIMIT 8;
```

### 5. è·å–ç”¨æˆ·æ´»è·ƒç›®æ ‡åŠå®Œæˆæƒ…å†µ
```sql
SELECT 
    id,
    name,
    target_value,
    achieved_value,
    ROUND((achieved_value / target_value) * 100, 2) as completion_rate,
    start_date,
    end_date,
    CASE 
        WHEN achieved_value >= target_value THEN 'è¶…é¢å®Œæˆ'
        WHEN (achieved_value / target_value) >= 0.8 THEN 'æ¥è¿‘å®Œæˆ'
        ELSE 'è¿›è¡Œä¸­'
    END as status_label,
    CASE 
        WHEN achieved_value > target_value THEN CONCAT('è¶…é¢å®Œæˆ ', ROUND(((achieved_value - target_value) / target_value) * 100, 2), '%')
        ELSE CONCAT('è¿˜éœ€å®Œæˆ ', ROUND(target_value - achieved_value, 2))
    END as difference_desc
FROM goals 
WHERE user_id = ? 
    AND status = 'active'
    AND start_date <= CURDATE()
    AND end_date >= CURDATE()
ORDER BY completion_rate DESC;
```

## ğŸ“ˆ æ•°æ®åˆå§‹åŒ–è„šæœ¬

### 1. æ’å…¥æµ‹è¯•é”€å”®æ•°æ®
```sql
-- æ’å…¥æœ€è¿‘30å¤©çš„é”€å”®æ•°æ®
INSERT INTO sales_data (user_id, date, total_sales, net_sales, settled_sales, unsettled_sales, return_amount, receivables, customer_payment, order_count, customer_count)
SELECT 
    1 as user_id,
    DATE_SUB(CURDATE(), INTERVAL seq DAY) as date,
    ROUND(RAND() * 10000 + 1000, 2) as total_sales,
    ROUND(RAND() * 9500 + 950, 2) as net_sales,
    ROUND(RAND() * 5000 + 500, 2) as settled_sales,
    ROUND(RAND() * 4500 + 450, 2) as unsettled_sales,
    ROUND(RAND() * 500 + 50, 2) as return_amount,
    ROUND(RAND() * 50000 + 400000, 2) as receivables,
    ROUND(RAND() * 3000 + 200, 2) as customer_payment,
    FLOOR(RAND() * 20 + 5) as order_count,
    FLOOR(RAND() * 10 + 3) as customer_count
FROM (
    SELECT 0 seq UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION 
    SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9 UNION
    SELECT 10 UNION SELECT 11 UNION SELECT 12 UNION SELECT 13 UNION SELECT 14 UNION
    SELECT 15 UNION SELECT 16 UNION SELECT 17 UNION SELECT 18 UNION SELECT 19 UNION
    SELECT 20 UNION SELECT 21 UNION SELECT 22 UNION SELECT 23 UNION SELECT 24 UNION
    SELECT 25 UNION SELECT 26 UNION SELECT 27 UNION SELECT 28 UNION SELECT 29
) seq_table;
```

### 2. æ’å…¥é»˜è®¤åŠŸèƒ½é…ç½®
```sql
INSERT INTO user_function_config (user_id, function_id, function_name, icon, route, display_order) VALUES
(1, 'employee_report', 'å‘˜å·¥æœˆæŠ¥', 'users', '/employee-report', 1),
(1, 'performance_analysis', 'ä¸šç»©å˜åŒ–åˆ†æ', 'trending-up', '/performance-analysis', 2),
(1, 'employee_analysis', 'å‘˜å·¥æ•´ä½“åˆ†æ', 'user-check', '/employee-analysis', 3),
(1, 'goal_management', 'ç›®æ ‡ç®¡ç†', 'target', '/goal-management', 4),
(1, 'business_report', 'æˆ‘çš„ç»è¥æœˆæŠ¥', 'file-text', '/business-report', 5),
(1, 'market_analysis', 'é“ºå¸‚åˆ†æ', 'map-pin', '/market-analysis', 6),
(1, 'employee_performance', 'å‘˜å·¥ä¸šç»©æ±‡æ€»', 'bar-chart', '/employee-performance', 7),
(1, 'customer_returns', 'å®¢æˆ·é”€é€€æ±‡æ€»', 'refresh-cw', '/customer-returns', 8);
```

### 3. æ’å…¥ç¤ºä¾‹ç›®æ ‡
```sql
INSERT INTO goals (user_id, name, target_value, achieved_value, start_date, end_date, status) VALUES
(1, 'é”€å”®é‡‘é¢', 20000.00, 40423.13, '2025-01-01', '2025-12-31', 'active'),
(1, 'äº”æœˆç›®æ ‡é…ç½®', 60000.00, 36565.72, '2025-05-01', '2025-05-31', 'active');
```

### 4. æ’å…¥ç¤ºä¾‹é¢„è­¦
```sql
INSERT INTO alerts (user_id, title, message, priority, type, details) VALUES
(1, 'ç»è¥å¼‚å¸¸é¢„è­¦', 'å°æ˜“ç›‘æ§åˆ°çš„ç»è¥å¼‚å¸¸', 'high', 'business_exception', 
 JSON_OBJECT('description', 'å®¢æˆ·å¼ ä¸‰è¿ç»­3å¤©æœªä¸‹å•', 'suggestion', 'å»ºè®®ä¸»åŠ¨è”ç³»å®¢æˆ·äº†è§£æƒ…å†µ')),
(1, 'åº“å­˜é¢„è­¦', 'éƒ¨åˆ†å•†å“åº“å­˜ä¸è¶³', 'medium', 'inventory_warning',
 JSON_OBJECT('description', 'å•†å“Aåº“å­˜ä»…å‰©5ä»¶', 'suggestion', 'å»ºè®®åŠæ—¶è¡¥è´§'));
```

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ç´¢å¼•ä¼˜åŒ–
```sql
-- ä¸ºç»å¸¸æŸ¥è¯¢çš„å­—æ®µç»„åˆåˆ›å»ºå¤åˆç´¢å¼•
CREATE INDEX idx_sales_user_date_range ON sales_data(user_id, date DESC);
CREATE INDEX idx_alerts_user_status ON alerts(user_id, is_read, priority, created_at DESC);
CREATE INDEX idx_goals_user_active ON goals(user_id, status, start_date, end_date);
```

### 2. åˆ†åŒºè¡¨å»ºè®®
```sql
-- å¯¹äºå¤§æ•°æ®é‡çš„é”€å”®æ•°æ®è¡¨ï¼Œå»ºè®®æŒ‰æœˆåˆ†åŒº
ALTER TABLE sales_data 
PARTITION BY RANGE (TO_DAYS(date)) (
    PARTITION p202401 VALUES LESS THAN (TO_DAYS('2024-02-01')),
    PARTITION p202402 VALUES LESS THAN (TO_DAYS('2024-03-01')),
    PARTITION p202403 VALUES LESS THAN (TO_DAYS('2024-04-01')),
    PARTITION p202404 VALUES LESS THAN (TO_DAYS('2024-05-01')),
    PARTITION p202405 VALUES LESS THAN (TO_DAYS('2024-06-01')),
    PARTITION p202406 VALUES LESS THAN (TO_DAYS('2024-07-01')),
    PARTITION p202407 VALUES LESS THAN (TO_DAYS('2024-08-01')),
    PARTITION p202408 VALUES LESS THAN (TO_DAYS('2024-09-01')),
    PARTITION p202409 VALUES LESS THAN (TO_DAYS('2024-10-01')),
    PARTITION p202410 VALUES LESS THAN (TO_DAYS('2024-11-01')),
    PARTITION p202411 VALUES LESS THAN (TO_DAYS('2024-12-01')),
    PARTITION p202412 VALUES LESS THAN (TO_DAYS('2025-01-01')),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

### 3. æ•°æ®æ¸…ç†ç­–ç•¥
```sql
-- å®šæœŸæ¸…ç†è¿‡æœŸçš„æœç´¢å†å²ï¼ˆä¿ç•™æœ€è¿‘3ä¸ªæœˆï¼‰
DELETE FROM search_history 
WHERE search_time < DATE_SUB(NOW(), INTERVAL 3 MONTH);

-- å®šæœŸæ¸…ç†å·²è¿‡æœŸçš„é¢„è­¦ä¿¡æ¯
DELETE FROM alerts 
WHERE expires_at IS NOT NULL 
    AND expires_at < DATE_SUB(NOW(), INTERVAL 7 DAY);
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-08-15  
**ç»´æŠ¤äººå‘˜**: æ•°æ®åº“è®¾è®¡å›¢é˜Ÿ
