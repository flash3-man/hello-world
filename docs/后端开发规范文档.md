# 后端开发规范文档

## 🏗️ 技术架构

### 微服务架构设计
```
┌─────────────────────────────────────────────────────────────┐
│                    API网关层                                 │
│  Spring Cloud Gateway + OAuth2 + Rate Limiting             │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                    微服务层                                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │ 用户服务    │  │ 数据服务    │  │ 分析服务    │        │
│  │ User Service│  │ Data Service│  │Analytics Svc│        │
│  └─────────────┘  └─────────────┘  └─────────────┘        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │ 任务服务    │  │ 报表服务    │  │ 消息服务    │        │
│  │ Job Service │  │Report Service│ │Message Svc  │        │
│  └─────────────┘  └─────────────┘  └─────────────┘        │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                    基础设施层                                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │ 数据库      │  │ 缓存        │  │ 消息队列    │        │
│  │ MySQL       │  │ Redis       │  │ RabbitMQ    │        │
│  └─────────────┘  └─────────────┘  └─────────────┘        │
└─────────────────────────────────────────────────────────────┘
```

### 技术栈选型
- **框架**: Spring Boot 2.5.3
- **微服务**: Spring Cloud 2020.0.3
- **安全**: Spring Security + OAuth2 2.3.6
- **数据访问**: MyBatis Plus 3.4.3
- **缓存**: Redis + Redisson
- **消息队列**: RabbitMQ 3.8
- **任务调度**: XXL-JOB 2.3.0
- **API文档**: Swagger3 + Knife4j
- **监控**: Spring Boot Actuator + Micrometer

## 📁 项目结构规范

### 标准项目结构
```
business-analysis-backend/
├── business-analysis-gateway/          # API网关
├── business-analysis-common/           # 公共模块
│   ├── common-core/                   # 核心工具类
│   ├── common-security/               # 安全组件
│   ├── common-redis/                  # Redis组件
│   └── common-swagger/                # Swagger组件
├── business-analysis-modules/          # 业务模块
│   ├── user-service/                  # 用户服务
│   │   ├── src/main/java/com/company/user/
│   │   │   ├── controller/           # 控制器层
│   │   │   ├── service/              # 服务层
│   │   │   │   ├── impl/            # 服务实现
│   │   │   │   └── IUserService.java
│   │   │   ├── mapper/               # 数据访问层
│   │   │   ├── entity/               # 实体类
│   │   │   ├── dto/                  # 数据传输对象
│   │   │   │   ├── request/         # 请求DTO
│   │   │   │   └── response/        # 响应DTO
│   │   │   ├── config/               # 配置类
│   │   │   └── UserServiceApplication.java
│   │   └── src/main/resources/
│   │       ├── mapper/               # MyBatis映射文件
│   │       ├── application.yml       # 配置文件
│   │       └── bootstrap.yml         # 启动配置
│   ├── data-service/                  # 数据服务
│   ├── analytics-service/             # 分析服务
│   ├── job-service/                   # 任务服务
│   └── message-service/               # 消息服务
└── business-analysis-api/              # API定义模块
    ├── user-api/                      # 用户API
    ├── data-api/                      # 数据API
    └── analytics-api/                 # 分析API
```

### 包命名规范
```java
// 基础包结构
com.company.businessanalysis
├── .common                    // 公共组件
│   ├── .config               // 配置类
│   ├── .constant             // 常量定义
│   ├── .exception            // 异常处理
│   ├── .util                 // 工具类
│   └── .annotation           // 自定义注解
├── .user                     // 用户模块
│   ├── .controller           // 控制器
│   ├── .service              // 服务层
│   ├── .mapper               // 数据访问层
│   ├── .entity               // 实体类
│   └── .dto                  // 数据传输对象
├── .data                     // 数据模块
├── .analytics                // 分析模块
├── .job                      // 任务模块
└── .message                  // 消息模块
```

## 🎯 代码规范

### 命名规范
```java
// 类命名：PascalCase
public class EmployeePerformanceService {}
public class UserController {}
public class DataSyncJobHandler {}

// 方法命名：camelCase
public List<EmployeePerformance> getEmployeePerformanceList() {}
public void updateEmployeePerformance() {}
public boolean validateUserPermission() {}

// 变量命名：camelCase
private String employeeName;
private BigDecimal salesAmount;
private LocalDateTime createTime;

// 常量命名：UPPER_SNAKE_CASE
public static final String DEFAULT_DATE_FORMAT = "yyyy-MM-dd";
public static final int MAX_PAGE_SIZE = 100;
public static final String CACHE_KEY_PREFIX = "business:performance:";

// 包命名：lowercase
package com.company.businessanalysis.user.service;
package com.company.businessanalysis.data.mapper;
```

### 注释规范
```java
/**
 * 员工业绩服务类
 * 
 * @author 开发团队
 * @version 1.0
 * @since 2024-01-01
 */
@Service
@Slf4j
public class EmployeePerformanceService {
    
    /**
     * 查询员工业绩列表
     * 
     * @param queryDTO 查询条件
     * @return 员工业绩分页数据
     * @throws BusinessException 业务异常
     */
    public PageResponse<EmployeePerformanceDTO> getEmployeePerformanceList(
            EmployeePerformanceQueryDTO queryDTO) throws BusinessException {
        
        // 1. 参数验证
        validateQueryParams(queryDTO);
        
        // 2. 构建查询条件
        LambdaQueryWrapper<EmployeePerformance> queryWrapper = buildQueryWrapper(queryDTO);
        
        // 3. 分页查询
        Page<EmployeePerformance> page = new Page<>(queryDTO.getPageNum(), queryDTO.getPageSize());
        Page<EmployeePerformance> result = employeePerformanceMapper.selectPage(page, queryWrapper);
        
        // 4. 数据转换
        List<EmployeePerformanceDTO> dtoList = result.getRecords().stream()
                .map(this::convertToDTO)
                .collect(Collectors.toList());
        
        // 5. 构建响应
        return PageResponse.<EmployeePerformanceDTO>builder()
                .total(result.getTotal())
                .list(dtoList)
                .pageNum(queryDTO.getPageNum())
                .pageSize(queryDTO.getPageSize())
                .pages(result.getPages())
                .build();
    }
    
    /**
     * 验证查询参数
     * 
     * @param queryDTO 查询参数
     * @throws BusinessException 参数验证失败
     */
    private void validateQueryParams(EmployeePerformanceQueryDTO queryDTO) throws BusinessException {
        if (queryDTO.getStartDate() == null || queryDTO.getEndDate() == null) {
            throw new BusinessException(ErrorCode.PARAM_ERROR, "开始日期和结束日期不能为空");
        }
        
        if (queryDTO.getStartDate().isAfter(queryDTO.getEndDate())) {
            throw new BusinessException(ErrorCode.PARAM_ERROR, "开始日期不能大于结束日期");
        }
        
        // 日期范围不能超过1年
        if (ChronoUnit.DAYS.between(queryDTO.getStartDate(), queryDTO.getEndDate()) > 365) {
            throw new BusinessException(ErrorCode.PARAM_ERROR, "查询日期范围不能超过365天");
        }
    }
}
```

## 🔧 Spring Boot配置规范

### 应用配置
```yaml
# application.yml
server:
  port: 8080
  servlet:
    context-path: /api
  compression:
    enabled: true
    mime-types: application/json,application/xml,text/html,text/xml,text/plain

spring:
  application:
    name: business-analysis-data-service
  
  profiles:
    active: @spring.profiles.active@
  
  # 数据源配置
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:business_analysis}?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:password}
    type: com.zaxxer.hikari.HikariDataSource
    hikari:
      minimum-idle: 5
      maximum-pool-size: 20
      auto-commit: true
      idle-timeout: 30000
      pool-name: HikariCP
      max-lifetime: 1800000
      connection-timeout: 30000
      connection-test-query: SELECT 1
  
  # Redis配置
  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    database: ${REDIS_DATABASE:0}
    timeout: 10000ms
    lettuce:
      pool:
        max-active: 8
        max-wait: -1ms
        max-idle: 8
        min-idle: 0
  
  # RabbitMQ配置
  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USERNAME:guest}
    password: ${RABBITMQ_PASSWORD:guest}
    virtual-host: ${RABBITMQ_VHOST:/}
    connection-timeout: 15000
    
# MyBatis Plus配置
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: false
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  global-config:
    db-config:
      id-type: AUTO
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0
    banner: false
  mapper-locations: classpath*:mapper/**/*Mapper.xml

# 日志配置
logging:
  level:
    com.company.businessanalysis: DEBUG
    org.springframework.security: DEBUG
  pattern:
    console: "%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
  file:
    name: logs/business-analysis.log
    max-size: 100MB
    max-history: 30

# 监控配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true
```

### 多环境配置
```yaml
# application-dev.yml (开发环境)
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/business_analysis_dev
    username: dev_user
    password: dev_password
  
  redis:
    host: localhost
    port: 6379
    database: 0

logging:
  level:
    root: INFO
    com.company.businessanalysis: DEBUG

# application-test.yml (测试环境)
spring:
  datasource:
    url: jdbc:mysql://test-db:3306/business_analysis_test
    username: test_user
    password: test_password
  
  redis:
    host: test-redis
    port: 6379
    database: 1

# application-prod.yml (生产环境)
spring:
  datasource:
    url: jdbc:mysql://prod-db:3306/business_analysis_prod
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
  
  redis:
    host: ${REDIS_HOST}
    port: ${REDIS_PORT}
    password: ${REDIS_PASSWORD}
    database: 0

logging:
  level:
    root: WARN
    com.company.businessanalysis: INFO
```

## 🎯 分层架构设计

### Controller层规范
```java
/**
 * 员工业绩控制器
 */
@Api(tags = "员工业绩管理")
@RestController
@RequestMapping("/performance/employee")
@Slf4j
@Validated
public class EmployeePerformanceController {
    
    @Autowired
    private IEmployeePerformanceService employeePerformanceService;
    
    /**
     * 查询员工业绩列表
     */
    @ApiOperation(value = "查询员工业绩列表", notes = "支持多维度筛选和分页查询")
    @GetMapping("/list")
    @PreAuthorize("hasAuthority('performance:employee:list')")
    public Result<PageResponse<EmployeePerformanceDTO>> getEmployeePerformanceList(
            @Valid EmployeePerformanceQueryDTO queryDTO) {
        
        log.info("查询员工业绩列表，参数：{}", queryDTO);
        
        try {
            PageResponse<EmployeePerformanceDTO> result = 
                employeePerformanceService.getEmployeePerformanceList(queryDTO);
            
            log.info("查询员工业绩列表成功，返回{}条记录", result.getTotal());
            return Result.success(result);
            
        } catch (BusinessException e) {
            log.warn("查询员工业绩列表失败：{}", e.getMessage());
            return Result.error(e.getCode(), e.getMessage());
        } catch (Exception e) {
            log.error("查询员工业绩列表异常", e);
            return Result.error("系统异常，请稍后重试");
        }
    }
    
    /**
     * 获取员工业绩详情
     */
    @ApiOperation(value = "获取员工业绩详情")
    @GetMapping("/{employeeId}")
    @PreAuthorize("hasAuthority('performance:employee:detail')")
    public Result<EmployeePerformanceDetailDTO> getEmployeePerformanceDetail(
            @ApiParam(value = "员工ID", required = true) @PathVariable Long employeeId,
            @Valid EmployeePerformanceDetailQueryDTO queryDTO) {
        
        log.info("查询员工业绩详情，员工ID：{}，参数：{}", employeeId, queryDTO);
        
        try {
            EmployeePerformanceDetailDTO result = 
                employeePerformanceService.getEmployeePerformanceDetail(employeeId, queryDTO);
            
            return Result.success(result);
            
        } catch (BusinessException e) {
            log.warn("查询员工业绩详情失败：{}", e.getMessage());
            return Result.error(e.getCode(), e.getMessage());
        }
    }
    
    /**
     * 导出员工业绩数据
     */
    @ApiOperation(value = "导出员工业绩数据")
    @PostMapping("/export")
    @PreAuthorize("hasAuthority('performance:employee:export')")
    public Result<ExportTaskDTO> exportEmployeePerformance(
            @Valid @RequestBody EmployeePerformanceExportDTO exportDTO) {
        
        log.info("导出员工业绩数据，参数：{}", exportDTO);
        
        try {
            ExportTaskDTO result = employeePerformanceService.exportEmployeePerformance(exportDTO);
            return Result.success(result);
            
        } catch (BusinessException e) {
            log.warn("导出员工业绩数据失败：{}", e.getMessage());
            return Result.error(e.getCode(), e.getMessage());
        }
    }
}
```

### Service层规范
```java
/**
 * 员工业绩服务接口
 */
public interface IEmployeePerformanceService {
    
    /**
     * 查询员工业绩列表
     * 
     * @param queryDTO 查询条件
     * @return 分页结果
     */
    PageResponse<EmployeePerformanceDTO> getEmployeePerformanceList(EmployeePerformanceQueryDTO queryDTO);
    
    /**
     * 获取员工业绩详情
     * 
     * @param employeeId 员工ID
     * @param queryDTO 查询条件
     * @return 员工业绩详情
     */
    EmployeePerformanceDetailDTO getEmployeePerformanceDetail(Long employeeId, 
            EmployeePerformanceDetailQueryDTO queryDTO);
    
    /**
     * 导出员工业绩数据
     * 
     * @param exportDTO 导出参数
     * @return 导出任务信息
     */
    ExportTaskDTO exportEmployeePerformance(EmployeePerformanceExportDTO exportDTO);
}

/**
 * 员工业绩服务实现
 */
@Service
@Slf4j
@Transactional(rollbackFor = Exception.class)
public class EmployeePerformanceServiceImpl implements IEmployeePerformanceService {
    
    @Autowired
    private EmployeePerformanceMapper employeePerformanceMapper;
    
    @Autowired
    private DataVersionService dataVersionService;
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    private static final String CACHE_KEY_PREFIX = "performance:employee:";
    private static final int CACHE_EXPIRE_SECONDS = 300; // 5分钟缓存
    
    @Override
    @Cacheable(value = "employeePerformance", key = "#queryDTO.hashCode()", unless = "#result == null")
    public PageResponse<EmployeePerformanceDTO> getEmployeePerformanceList(
            EmployeePerformanceQueryDTO queryDTO) {
        
        log.debug("开始查询员工业绩列表，参数：{}", queryDTO);
        
        // 1. 参数验证
        validateQueryParams(queryDTO);
        
        // 2. 获取当前数据版本
        String versionId = StringUtils.isNotBlank(queryDTO.getVersionId()) 
            ? queryDTO.getVersionId() 
            : dataVersionService.getCurrentVersion("employee_performance");
        
        // 3. 构建查询条件
        LambdaQueryWrapper<EmployeePerformance> queryWrapper = new LambdaQueryWrapper<>();
        queryWrapper.eq(EmployeePerformance::getVersionId, versionId)
                   .between(EmployeePerformance::getDataDate, queryDTO.getStartDate(), queryDTO.getEndDate());
        
        // 员工筛选
        if (CollectionUtils.isNotEmpty(queryDTO.getEmployeeIds())) {
            queryWrapper.in(EmployeePerformance::getEmployeeId, queryDTO.getEmployeeIds());
        }
        
        // 部门筛选
        if (CollectionUtils.isNotEmpty(queryDTO.getDeptIds())) {
            queryWrapper.in(EmployeePerformance::getDeptId, queryDTO.getDeptIds());
        }
        
        // 金额范围筛选
        if (queryDTO.getMinSalesAmount() != null) {
            queryWrapper.ge(EmployeePerformance::getSalesAmount, queryDTO.getMinSalesAmount());
        }
        if (queryDTO.getMaxSalesAmount() != null) {
            queryWrapper.le(EmployeePerformance::getSalesAmount, queryDTO.getMaxSalesAmount());
        }
        
        // 排序
        if (StringUtils.isNotBlank(queryDTO.getSortField())) {
            if ("desc".equalsIgnoreCase(queryDTO.getSortOrder())) {
                queryWrapper.orderByDesc(getColumnByField(queryDTO.getSortField()));
            } else {
                queryWrapper.orderByAsc(getColumnByField(queryDTO.getSortField()));
            }
        } else {
            queryWrapper.orderByDesc(EmployeePerformance::getSalesAmount);
        }
        
        // 4. 分页查询
        Page<EmployeePerformance> page = new Page<>(queryDTO.getPageNum(), queryDTO.getPageSize());
        Page<EmployeePerformance> result = employeePerformanceMapper.selectPage(page, queryWrapper);
        
        // 5. 数据转换
        List<EmployeePerformanceDTO> dtoList = result.getRecords().stream()
                .map(this::convertToDTO)
                .collect(Collectors.toList());
        
        // 6. 构建响应
        PageResponse<EmployeePerformanceDTO> response = PageResponse.<EmployeePerformanceDTO>builder()
                .total(result.getTotal())
                .list(dtoList)
                .pageNum(queryDTO.getPageNum())
                .pageSize(queryDTO.getPageSize())
                .pages(result.getPages())
                .hasNext(result.hasNext())
                .hasPrev(result.hasPrevious())
                .build();
        
        log.debug("查询员工业绩列表完成，返回{}条记录", response.getTotal());
        return response;
    }
    
    /**
     * 实体转DTO
     */
    private EmployeePerformanceDTO convertToDTO(EmployeePerformance entity) {
        EmployeePerformanceDTO dto = new EmployeePerformanceDTO();
        BeanUtils.copyProperties(entity, dto);
        
        // 计算衍生字段
        dto.setOrderAmountDisplay(formatCurrency(entity.getOrderAmount()));
        dto.setSalesAmountDisplay(formatCurrency(entity.getSalesAmount()));
        dto.setProfitRateDisplay(formatPercent(entity.getProfitRate()));
        
        return dto;
    }
    
    /**
     * 根据字段名获取数据库列名
     */
    private SFunction<EmployeePerformance, ?> getColumnByField(String field) {
        switch (field) {
            case "salesAmount": return EmployeePerformance::getSalesAmount;
            case "orderCount": return EmployeePerformance::getOrderCount;
            case "profitRate": return EmployeePerformance::getProfitRate;
            case "createTime": return EmployeePerformance::getCreateTime;
            default: return EmployeePerformance::getSalesAmount;
        }
    }
}
```

## 🗄️ 数据访问层规范

### Mapper接口设计
```java
/**
 * 员工业绩数据访问接口
 */
@Mapper
public interface EmployeePerformanceMapper extends BaseMapper<EmployeePerformance> {

    /**
     * 根据条件查询员工业绩统计
     *
     * @param queryDTO 查询条件
     * @return 统计结果
     */
    List<EmployeePerformanceStatDTO> selectPerformanceStatistics(@Param("query") EmployeePerformanceQueryDTO queryDTO);

    /**
     * 查询员工业绩趋势数据
     *
     * @param employeeId 员工ID
     * @param startDate 开始日期
     * @param endDate 结束日期
     * @param versionId 版本ID
     * @return 趋势数据
     */
    List<PerformanceTrendDTO> selectPerformanceTrend(@Param("employeeId") Long employeeId,
                                                    @Param("startDate") LocalDate startDate,
                                                    @Param("endDate") LocalDate endDate,
                                                    @Param("versionId") String versionId);

    /**
     * 批量插入员工业绩数据
     *
     * @param performanceList 业绩数据列表
     * @return 插入记录数
     */
    int batchInsertPerformance(@Param("list") List<EmployeePerformance> performanceList);

    /**
     * 根据版本ID删除数据
     *
     * @param versionId 版本ID
     * @return 删除记录数
     */
    int deleteByVersionId(@Param("versionId") String versionId);
}
```

### 实体类设计
```java
/**
 * 员工业绩实体类
 */
@Data
@EqualsAndHashCode(callSuper = false)
@TableName("employee_performance")
@ApiModel(value = "EmployeePerformance对象", description = "员工业绩表")
public class EmployeePerformance extends BaseEntity {

    @ApiModelProperty(value = "主键ID")
    @TableId(value = "id", type = IdType.AUTO)
    private Long id;

    @ApiModelProperty(value = "数据版本ID")
    @TableField("version_id")
    private Long versionId;

    @ApiModelProperty(value = "员工ID")
    @TableField("employee_id")
    private Long employeeId;

    @ApiModelProperty(value = "员工姓名")
    @TableField("employee_name")
    private String employeeName;

    @ApiModelProperty(value = "员工编码")
    @TableField("employee_code")
    private String employeeCode;

    @ApiModelProperty(value = "部门ID")
    @TableField("dept_id")
    private Long deptId;

    @ApiModelProperty(value = "部门名称")
    @TableField("dept_name")
    private String deptName;

    @ApiModelProperty(value = "数据日期")
    @TableField("data_date")
    private LocalDate dataDate;

    // 订单相关指标
    @ApiModelProperty(value = "订单金额")
    @TableField("order_amount")
    private BigDecimal orderAmount;

    @ApiModelProperty(value = "订单数量")
    @TableField("order_count")
    private Integer orderCount;

    @ApiModelProperty(value = "订单客户数")
    @TableField("order_customers")
    private Integer orderCustomers;

    // 销售相关指标
    @ApiModelProperty(value = "销售金额")
    @TableField("sales_amount")
    private BigDecimal salesAmount;

    @ApiModelProperty(value = "销售单数")
    @TableField("sales_count")
    private Integer salesCount;

    @ApiModelProperty(value = "净销售额")
    @TableField("net_sales")
    private BigDecimal netSales;

    @ApiModelProperty(value = "销售毛利")
    @TableField("sales_profit")
    private BigDecimal salesProfit;

    @ApiModelProperty(value = "毛利率")
    @TableField("profit_rate")
    private BigDecimal profitRate;

    // 客户相关指标
    @ApiModelProperty(value = "拜访客户数")
    @TableField("visit_customers")
    private Integer visitCustomers;

    @ApiModelProperty(value = "铺货客户数")
    @TableField("distribution_customers")
    private Integer distributionCustomers;

    @ApiModelProperty(value = "进货客户数")
    @TableField("purchase_customers")
    private Integer purchaseCustomers;

    @ApiModelProperty(value = "客单价")
    @TableField("avg_order_value")
    private BigDecimal avgOrderValue;

    // 商品相关指标
    @ApiModelProperty(value = "出货商品数")
    @TableField("outbound_products")
    private Integer outboundProducts;

    @ApiModelProperty(value = "销售商品数量")
    @TableField("sales_quantity")
    private Integer salesQuantity;

    @ApiModelProperty(value = "退货商品数量")
    @TableField("return_quantity")
    private Integer returnQuantity;

    @ApiModelProperty(value = "赠品成本")
    @TableField("gift_cost")
    private BigDecimal giftCost;
}

/**
 * 基础实体类
 */
@Data
@ApiModel("基础实体")
public abstract class BaseEntity {

    @ApiModelProperty(value = "创建时间")
    @TableField(value = "create_time", fill = FieldFill.INSERT)
    private LocalDateTime createTime;

    @ApiModelProperty(value = "更新时间")
    @TableField(value = "update_time", fill = FieldFill.INSERT_UPDATE)
    private LocalDateTime updateTime;

    @ApiModelProperty(value = "创建人")
    @TableField(value = "create_by", fill = FieldFill.INSERT)
    private Long createBy;

    @ApiModelProperty(value = "更新人")
    @TableField(value = "update_by", fill = FieldFill.INSERT_UPDATE)
    private Long updateBy;

    @ApiModelProperty(value = "逻辑删除标志")
    @TableField("deleted")
    @TableLogic
    private Integer deleted;
}
```

## 🔄 缓存策略规范

### Redis缓存配置
```java
/**
 * Redis配置类
 */
@Configuration
@EnableCaching
@Slf4j
public class RedisConfig {

    /**
     * Redis模板配置
     */
    @Bean
    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory connectionFactory) {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(connectionFactory);

        // 使用Jackson2JsonRedisSerializer来序列化和反序列化redis的value值
        Jackson2JsonRedisSerializer<Object> jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer<>(Object.class);
        ObjectMapper om = new ObjectMapper();
        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        om.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL);
        jackson2JsonRedisSerializer.setObjectMapper(om);

        // 使用StringRedisSerializer来序列化和反序列化redis的key值
        template.setKeySerializer(new StringRedisSerializer());
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setValueSerializer(jackson2JsonRedisSerializer);
        template.setHashValueSerializer(jackson2JsonRedisSerializer);

        template.afterPropertiesSet();
        return template;
    }

    /**
     * 缓存管理器
     */
    @Bean
    public CacheManager cacheManager(RedisConnectionFactory connectionFactory) {
        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()
                .entryTtl(Duration.ofMinutes(5)) // 默认5分钟过期
                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(new StringRedisSerializer()))
                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(new GenericJackson2JsonRedisSerializer()))
                .disableCachingNullValues();

        return RedisCacheManager.builder(connectionFactory)
                .cacheDefaults(config)
                .build();
    }

    /**
     * Redisson配置
     */
    @Bean
    public RedissonClient redissonClient() {
        Config config = new Config();
        config.useSingleServer()
                .setAddress("redis://localhost:6379")
                .setPassword(null)
                .setDatabase(0)
                .setConnectionMinimumIdleSize(5)
                .setConnectionPoolSize(10)
                .setIdleConnectionTimeout(10000)
                .setConnectTimeout(10000)
                .setTimeout(3000)
                .setRetryAttempts(3)
                .setRetryInterval(1500);

        return Redisson.create(config);
    }
}
```
