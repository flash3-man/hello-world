# åç«¯å¼€å‘è§„èŒƒæ–‡æ¡£

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### å¾®æœåŠ¡æ¶æ„è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APIç½‘å…³å±‚                                 â”‚
â”‚  Spring Cloud Gateway + OAuth2 + Rate Limiting             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¾®æœåŠ¡å±‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ ç”¨æˆ·æœåŠ¡    â”‚  â”‚ æ•°æ®æœåŠ¡    â”‚  â”‚ åˆ†ææœåŠ¡    â”‚        â”‚
â”‚  â”‚ User Serviceâ”‚  â”‚ Data Serviceâ”‚  â”‚Analytics Svcâ”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ ä»»åŠ¡æœåŠ¡    â”‚  â”‚ æŠ¥è¡¨æœåŠ¡    â”‚  â”‚ æ¶ˆæ¯æœåŠ¡    â”‚        â”‚
â”‚  â”‚ Job Service â”‚  â”‚Report Serviceâ”‚ â”‚Message Svc  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŸºç¡€è®¾æ–½å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ æ•°æ®åº“      â”‚  â”‚ ç¼“å­˜        â”‚  â”‚ æ¶ˆæ¯é˜Ÿåˆ—    â”‚        â”‚
â”‚  â”‚ MySQL       â”‚  â”‚ Redis       â”‚  â”‚ RabbitMQ    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆé€‰å‹
- **æ¡†æ¶**: Spring Boot 2.5.3
- **å¾®æœåŠ¡**: Spring Cloud 2020.0.3
- **å®‰å…¨**: Spring Security + OAuth2 2.3.6
- **æ•°æ®è®¿é—®**: MyBatis Plus 3.4.3
- **ç¼“å­˜**: Redis + Redisson
- **æ¶ˆæ¯é˜Ÿåˆ—**: RabbitMQ 3.8
- **ä»»åŠ¡è°ƒåº¦**: XXL-JOB 2.3.0
- **APIæ–‡æ¡£**: Swagger3 + Knife4j
- **ç›‘æ§**: Spring Boot Actuator + Micrometer

## ğŸ“ é¡¹ç›®ç»“æ„è§„èŒƒ

### æ ‡å‡†é¡¹ç›®ç»“æ„
```
business-analysis-backend/
â”œâ”€â”€ business-analysis-gateway/          # APIç½‘å…³
â”œâ”€â”€ business-analysis-common/           # å…¬å…±æ¨¡å—
â”‚   â”œâ”€â”€ common-core/                   # æ ¸å¿ƒå·¥å…·ç±»
â”‚   â”œâ”€â”€ common-security/               # å®‰å…¨ç»„ä»¶
â”‚   â”œâ”€â”€ common-redis/                  # Redisç»„ä»¶
â”‚   â””â”€â”€ common-swagger/                # Swaggerç»„ä»¶
â”œâ”€â”€ business-analysis-modules/          # ä¸šåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ user-service/                  # ç”¨æˆ·æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ src/main/java/com/company/user/
â”‚   â”‚   â”‚   â”œâ”€â”€ controller/           # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ service/              # æœåŠ¡å±‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ impl/            # æœåŠ¡å®ç°
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ IUserService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ mapper/               # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ entity/               # å®ä½“ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ dto/                  # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ request/         # è¯·æ±‚DTO
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ response/        # å“åº”DTO
â”‚   â”‚   â”‚   â”œâ”€â”€ config/               # é…ç½®ç±»
â”‚   â”‚   â”‚   â””â”€â”€ UserServiceApplication.java
â”‚   â”‚   â””â”€â”€ src/main/resources/
â”‚   â”‚       â”œâ”€â”€ mapper/               # MyBatisæ˜ å°„æ–‡ä»¶
â”‚   â”‚       â”œâ”€â”€ application.yml       # é…ç½®æ–‡ä»¶
â”‚   â”‚       â””â”€â”€ bootstrap.yml         # å¯åŠ¨é…ç½®
â”‚   â”œâ”€â”€ data-service/                  # æ•°æ®æœåŠ¡
â”‚   â”œâ”€â”€ analytics-service/             # åˆ†ææœåŠ¡
â”‚   â”œâ”€â”€ job-service/                   # ä»»åŠ¡æœåŠ¡
â”‚   â””â”€â”€ message-service/               # æ¶ˆæ¯æœåŠ¡
â””â”€â”€ business-analysis-api/              # APIå®šä¹‰æ¨¡å—
    â”œâ”€â”€ user-api/                      # ç”¨æˆ·API
    â”œâ”€â”€ data-api/                      # æ•°æ®API
    â””â”€â”€ analytics-api/                 # åˆ†æAPI
```

### åŒ…å‘½åè§„èŒƒ
```java
// åŸºç¡€åŒ…ç»“æ„
com.company.businessanalysis
â”œâ”€â”€ .common                    // å…¬å…±ç»„ä»¶
â”‚   â”œâ”€â”€ .config               // é…ç½®ç±»
â”‚   â”œâ”€â”€ .constant             // å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ .exception            // å¼‚å¸¸å¤„ç†
â”‚   â”œâ”€â”€ .util                 // å·¥å…·ç±»
â”‚   â””â”€â”€ .annotation           // è‡ªå®šä¹‰æ³¨è§£
â”œâ”€â”€ .user                     // ç”¨æˆ·æ¨¡å—
â”‚   â”œâ”€â”€ .controller           // æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ .service              // æœåŠ¡å±‚
â”‚   â”œâ”€â”€ .mapper               // æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ .entity               // å®ä½“ç±»
â”‚   â””â”€â”€ .dto                  // æ•°æ®ä¼ è¾“å¯¹è±¡
â”œâ”€â”€ .data                     // æ•°æ®æ¨¡å—
â”œâ”€â”€ .analytics                // åˆ†ææ¨¡å—
â”œâ”€â”€ .job                      // ä»»åŠ¡æ¨¡å—
â””â”€â”€ .message                  // æ¶ˆæ¯æ¨¡å—
```

## ğŸ¯ ä»£ç è§„èŒƒ

### å‘½åè§„èŒƒ
```java
// ç±»å‘½åï¼šPascalCase
public class EmployeePerformanceService {}
public class UserController {}
public class DataSyncJobHandler {}

// æ–¹æ³•å‘½åï¼šcamelCase
public List<EmployeePerformance> getEmployeePerformanceList() {}
public void updateEmployeePerformance() {}
public boolean validateUserPermission() {}

// å˜é‡å‘½åï¼šcamelCase
private String employeeName;
private BigDecimal salesAmount;
private LocalDateTime createTime;

// å¸¸é‡å‘½åï¼šUPPER_SNAKE_CASE
public static final String DEFAULT_DATE_FORMAT = "yyyy-MM-dd";
public static final int MAX_PAGE_SIZE = 100;
public static final String CACHE_KEY_PREFIX = "business:performance:";

// åŒ…å‘½åï¼šlowercase
package com.company.businessanalysis.user.service;
package com.company.businessanalysis.data.mapper;
```

### æ³¨é‡Šè§„èŒƒ
```java
/**
 * å‘˜å·¥ä¸šç»©æœåŠ¡ç±»
 * 
 * @author å¼€å‘å›¢é˜Ÿ
 * @version 1.0
 * @since 2024-01-01
 */
@Service
@Slf4j
public class EmployeePerformanceService {
    
    /**
     * æŸ¥è¯¢å‘˜å·¥ä¸šç»©åˆ—è¡¨
     * 
     * @param queryDTO æŸ¥è¯¢æ¡ä»¶
     * @return å‘˜å·¥ä¸šç»©åˆ†é¡µæ•°æ®
     * @throws BusinessException ä¸šåŠ¡å¼‚å¸¸
     */
    public PageResponse<EmployeePerformanceDTO> getEmployeePerformanceList(
            EmployeePerformanceQueryDTO queryDTO) throws BusinessException {
        
        // 1. å‚æ•°éªŒè¯
        validateQueryParams(queryDTO);
        
        // 2. æ„å»ºæŸ¥è¯¢æ¡ä»¶
        LambdaQueryWrapper<EmployeePerformance> queryWrapper = buildQueryWrapper(queryDTO);
        
        // 3. åˆ†é¡µæŸ¥è¯¢
        Page<EmployeePerformance> page = new Page<>(queryDTO.getPageNum(), queryDTO.getPageSize());
        Page<EmployeePerformance> result = employeePerformanceMapper.selectPage(page, queryWrapper);
        
        // 4. æ•°æ®è½¬æ¢
        List<EmployeePerformanceDTO> dtoList = result.getRecords().stream()
                .map(this::convertToDTO)
                .collect(Collectors.toList());
        
        // 5. æ„å»ºå“åº”
        return PageResponse.<EmployeePerformanceDTO>builder()
                .total(result.getTotal())
                .list(dtoList)
                .pageNum(queryDTO.getPageNum())
                .pageSize(queryDTO.getPageSize())
                .pages(result.getPages())
                .build();
    }
    
    /**
     * éªŒè¯æŸ¥è¯¢å‚æ•°
     * 
     * @param queryDTO æŸ¥è¯¢å‚æ•°
     * @throws BusinessException å‚æ•°éªŒè¯å¤±è´¥
     */
    private void validateQueryParams(EmployeePerformanceQueryDTO queryDTO) throws BusinessException {
        if (queryDTO.getStartDate() == null || queryDTO.getEndDate() == null) {
            throw new BusinessException(ErrorCode.PARAM_ERROR, "å¼€å§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸä¸èƒ½ä¸ºç©º");
        }
        
        if (queryDTO.getStartDate().isAfter(queryDTO.getEndDate())) {
            throw new BusinessException(ErrorCode.PARAM_ERROR, "å¼€å§‹æ—¥æœŸä¸èƒ½å¤§äºç»“æŸæ—¥æœŸ");
        }
        
        // æ—¥æœŸèŒƒå›´ä¸èƒ½è¶…è¿‡1å¹´
        if (ChronoUnit.DAYS.between(queryDTO.getStartDate(), queryDTO.getEndDate()) > 365) {
            throw new BusinessException(ErrorCode.PARAM_ERROR, "æŸ¥è¯¢æ—¥æœŸèŒƒå›´ä¸èƒ½è¶…è¿‡365å¤©");
        }
    }
}
```

## ğŸ”§ Spring Booté…ç½®è§„èŒƒ

### åº”ç”¨é…ç½®
```yaml
# application.yml
server:
  port: 8080
  servlet:
    context-path: /api
  compression:
    enabled: true
    mime-types: application/json,application/xml,text/html,text/xml,text/plain

spring:
  application:
    name: business-analysis-data-service
  
  profiles:
    active: @spring.profiles.active@
  
  # æ•°æ®æºé…ç½®
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:business_analysis}?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:password}
    type: com.zaxxer.hikari.HikariDataSource
    hikari:
      minimum-idle: 5
      maximum-pool-size: 20
      auto-commit: true
      idle-timeout: 30000
      pool-name: HikariCP
      max-lifetime: 1800000
      connection-timeout: 30000
      connection-test-query: SELECT 1
  
  # Redisé…ç½®
  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    database: ${REDIS_DATABASE:0}
    timeout: 10000ms
    lettuce:
      pool:
        max-active: 8
        max-wait: -1ms
        max-idle: 8
        min-idle: 0
  
  # RabbitMQé…ç½®
  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USERNAME:guest}
    password: ${RABBITMQ_PASSWORD:guest}
    virtual-host: ${RABBITMQ_VHOST:/}
    connection-timeout: 15000
    
# MyBatis Plusé…ç½®
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: false
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  global-config:
    db-config:
      id-type: AUTO
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0
    banner: false
  mapper-locations: classpath*:mapper/**/*Mapper.xml

# æ—¥å¿—é…ç½®
logging:
  level:
    com.company.businessanalysis: DEBUG
    org.springframework.security: DEBUG
  pattern:
    console: "%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
  file:
    name: logs/business-analysis.log
    max-size: 100MB
    max-history: 30

# ç›‘æ§é…ç½®
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true
```

### å¤šç¯å¢ƒé…ç½®
```yaml
# application-dev.yml (å¼€å‘ç¯å¢ƒ)
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/business_analysis_dev
    username: dev_user
    password: dev_password
  
  redis:
    host: localhost
    port: 6379
    database: 0

logging:
  level:
    root: INFO
    com.company.businessanalysis: DEBUG

# application-test.yml (æµ‹è¯•ç¯å¢ƒ)
spring:
  datasource:
    url: jdbc:mysql://test-db:3306/business_analysis_test
    username: test_user
    password: test_password
  
  redis:
    host: test-redis
    port: 6379
    database: 1

# application-prod.yml (ç”Ÿäº§ç¯å¢ƒ)
spring:
  datasource:
    url: jdbc:mysql://prod-db:3306/business_analysis_prod
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
  
  redis:
    host: ${REDIS_HOST}
    port: ${REDIS_PORT}
    password: ${REDIS_PASSWORD}
    database: 0

logging:
  level:
    root: WARN
    com.company.businessanalysis: INFO
```

## ğŸ¯ åˆ†å±‚æ¶æ„è®¾è®¡

### Controllerå±‚è§„èŒƒ
```java
/**
 * å‘˜å·¥ä¸šç»©æ§åˆ¶å™¨
 */
@Api(tags = "å‘˜å·¥ä¸šç»©ç®¡ç†")
@RestController
@RequestMapping("/performance/employee")
@Slf4j
@Validated
public class EmployeePerformanceController {
    
    @Autowired
    private IEmployeePerformanceService employeePerformanceService;
    
    /**
     * æŸ¥è¯¢å‘˜å·¥ä¸šç»©åˆ—è¡¨
     */
    @ApiOperation(value = "æŸ¥è¯¢å‘˜å·¥ä¸šç»©åˆ—è¡¨", notes = "æ”¯æŒå¤šç»´åº¦ç­›é€‰å’Œåˆ†é¡µæŸ¥è¯¢")
    @GetMapping("/list")
    @PreAuthorize("hasAuthority('performance:employee:list')")
    public Result<PageResponse<EmployeePerformanceDTO>> getEmployeePerformanceList(
            @Valid EmployeePerformanceQueryDTO queryDTO) {
        
        log.info("æŸ¥è¯¢å‘˜å·¥ä¸šç»©åˆ—è¡¨ï¼Œå‚æ•°ï¼š{}", queryDTO);
        
        try {
            PageResponse<EmployeePerformanceDTO> result = 
                employeePerformanceService.getEmployeePerformanceList(queryDTO);
            
            log.info("æŸ¥è¯¢å‘˜å·¥ä¸šç»©åˆ—è¡¨æˆåŠŸï¼Œè¿”å›{}æ¡è®°å½•", result.getTotal());
            return Result.success(result);
            
        } catch (BusinessException e) {
            log.warn("æŸ¥è¯¢å‘˜å·¥ä¸šç»©åˆ—è¡¨å¤±è´¥ï¼š{}", e.getMessage());
            return Result.error(e.getCode(), e.getMessage());
        } catch (Exception e) {
            log.error("æŸ¥è¯¢å‘˜å·¥ä¸šç»©åˆ—è¡¨å¼‚å¸¸", e);
            return Result.error("ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•");
        }
    }
    
    /**
     * è·å–å‘˜å·¥ä¸šç»©è¯¦æƒ…
     */
    @ApiOperation(value = "è·å–å‘˜å·¥ä¸šç»©è¯¦æƒ…")
    @GetMapping("/{employeeId}")
    @PreAuthorize("hasAuthority('performance:employee:detail')")
    public Result<EmployeePerformanceDetailDTO> getEmployeePerformanceDetail(
            @ApiParam(value = "å‘˜å·¥ID", required = true) @PathVariable Long employeeId,
            @Valid EmployeePerformanceDetailQueryDTO queryDTO) {
        
        log.info("æŸ¥è¯¢å‘˜å·¥ä¸šç»©è¯¦æƒ…ï¼Œå‘˜å·¥IDï¼š{}ï¼Œå‚æ•°ï¼š{}", employeeId, queryDTO);
        
        try {
            EmployeePerformanceDetailDTO result = 
                employeePerformanceService.getEmployeePerformanceDetail(employeeId, queryDTO);
            
            return Result.success(result);
            
        } catch (BusinessException e) {
            log.warn("æŸ¥è¯¢å‘˜å·¥ä¸šç»©è¯¦æƒ…å¤±è´¥ï¼š{}", e.getMessage());
            return Result.error(e.getCode(), e.getMessage());
        }
    }
    
    /**
     * å¯¼å‡ºå‘˜å·¥ä¸šç»©æ•°æ®
     */
    @ApiOperation(value = "å¯¼å‡ºå‘˜å·¥ä¸šç»©æ•°æ®")
    @PostMapping("/export")
    @PreAuthorize("hasAuthority('performance:employee:export')")
    public Result<ExportTaskDTO> exportEmployeePerformance(
            @Valid @RequestBody EmployeePerformanceExportDTO exportDTO) {
        
        log.info("å¯¼å‡ºå‘˜å·¥ä¸šç»©æ•°æ®ï¼Œå‚æ•°ï¼š{}", exportDTO);
        
        try {
            ExportTaskDTO result = employeePerformanceService.exportEmployeePerformance(exportDTO);
            return Result.success(result);
            
        } catch (BusinessException e) {
            log.warn("å¯¼å‡ºå‘˜å·¥ä¸šç»©æ•°æ®å¤±è´¥ï¼š{}", e.getMessage());
            return Result.error(e.getCode(), e.getMessage());
        }
    }
}
```

### Serviceå±‚è§„èŒƒ
```java
/**
 * å‘˜å·¥ä¸šç»©æœåŠ¡æ¥å£
 */
public interface IEmployeePerformanceService {
    
    /**
     * æŸ¥è¯¢å‘˜å·¥ä¸šç»©åˆ—è¡¨
     * 
     * @param queryDTO æŸ¥è¯¢æ¡ä»¶
     * @return åˆ†é¡µç»“æœ
     */
    PageResponse<EmployeePerformanceDTO> getEmployeePerformanceList(EmployeePerformanceQueryDTO queryDTO);
    
    /**
     * è·å–å‘˜å·¥ä¸šç»©è¯¦æƒ…
     * 
     * @param employeeId å‘˜å·¥ID
     * @param queryDTO æŸ¥è¯¢æ¡ä»¶
     * @return å‘˜å·¥ä¸šç»©è¯¦æƒ…
     */
    EmployeePerformanceDetailDTO getEmployeePerformanceDetail(Long employeeId, 
            EmployeePerformanceDetailQueryDTO queryDTO);
    
    /**
     * å¯¼å‡ºå‘˜å·¥ä¸šç»©æ•°æ®
     * 
     * @param exportDTO å¯¼å‡ºå‚æ•°
     * @return å¯¼å‡ºä»»åŠ¡ä¿¡æ¯
     */
    ExportTaskDTO exportEmployeePerformance(EmployeePerformanceExportDTO exportDTO);
}

/**
 * å‘˜å·¥ä¸šç»©æœåŠ¡å®ç°
 */
@Service
@Slf4j
@Transactional(rollbackFor = Exception.class)
public class EmployeePerformanceServiceImpl implements IEmployeePerformanceService {
    
    @Autowired
    private EmployeePerformanceMapper employeePerformanceMapper;
    
    @Autowired
    private DataVersionService dataVersionService;
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    private static final String CACHE_KEY_PREFIX = "performance:employee:";
    private static final int CACHE_EXPIRE_SECONDS = 300; // 5åˆ†é’Ÿç¼“å­˜
    
    @Override
    @Cacheable(value = "employeePerformance", key = "#queryDTO.hashCode()", unless = "#result == null")
    public PageResponse<EmployeePerformanceDTO> getEmployeePerformanceList(
            EmployeePerformanceQueryDTO queryDTO) {
        
        log.debug("å¼€å§‹æŸ¥è¯¢å‘˜å·¥ä¸šç»©åˆ—è¡¨ï¼Œå‚æ•°ï¼š{}", queryDTO);
        
        // 1. å‚æ•°éªŒè¯
        validateQueryParams(queryDTO);
        
        // 2. è·å–å½“å‰æ•°æ®ç‰ˆæœ¬
        String versionId = StringUtils.isNotBlank(queryDTO.getVersionId()) 
            ? queryDTO.getVersionId() 
            : dataVersionService.getCurrentVersion("employee_performance");
        
        // 3. æ„å»ºæŸ¥è¯¢æ¡ä»¶
        LambdaQueryWrapper<EmployeePerformance> queryWrapper = new LambdaQueryWrapper<>();
        queryWrapper.eq(EmployeePerformance::getVersionId, versionId)
                   .between(EmployeePerformance::getDataDate, queryDTO.getStartDate(), queryDTO.getEndDate());
        
        // å‘˜å·¥ç­›é€‰
        if (CollectionUtils.isNotEmpty(queryDTO.getEmployeeIds())) {
            queryWrapper.in(EmployeePerformance::getEmployeeId, queryDTO.getEmployeeIds());
        }
        
        // éƒ¨é—¨ç­›é€‰
        if (CollectionUtils.isNotEmpty(queryDTO.getDeptIds())) {
            queryWrapper.in(EmployeePerformance::getDeptId, queryDTO.getDeptIds());
        }
        
        // é‡‘é¢èŒƒå›´ç­›é€‰
        if (queryDTO.getMinSalesAmount() != null) {
            queryWrapper.ge(EmployeePerformance::getSalesAmount, queryDTO.getMinSalesAmount());
        }
        if (queryDTO.getMaxSalesAmount() != null) {
            queryWrapper.le(EmployeePerformance::getSalesAmount, queryDTO.getMaxSalesAmount());
        }
        
        // æ’åº
        if (StringUtils.isNotBlank(queryDTO.getSortField())) {
            if ("desc".equalsIgnoreCase(queryDTO.getSortOrder())) {
                queryWrapper.orderByDesc(getColumnByField(queryDTO.getSortField()));
            } else {
                queryWrapper.orderByAsc(getColumnByField(queryDTO.getSortField()));
            }
        } else {
            queryWrapper.orderByDesc(EmployeePerformance::getSalesAmount);
        }
        
        // 4. åˆ†é¡µæŸ¥è¯¢
        Page<EmployeePerformance> page = new Page<>(queryDTO.getPageNum(), queryDTO.getPageSize());
        Page<EmployeePerformance> result = employeePerformanceMapper.selectPage(page, queryWrapper);
        
        // 5. æ•°æ®è½¬æ¢
        List<EmployeePerformanceDTO> dtoList = result.getRecords().stream()
                .map(this::convertToDTO)
                .collect(Collectors.toList());
        
        // 6. æ„å»ºå“åº”
        PageResponse<EmployeePerformanceDTO> response = PageResponse.<EmployeePerformanceDTO>builder()
                .total(result.getTotal())
                .list(dtoList)
                .pageNum(queryDTO.getPageNum())
                .pageSize(queryDTO.getPageSize())
                .pages(result.getPages())
                .hasNext(result.hasNext())
                .hasPrev(result.hasPrevious())
                .build();
        
        log.debug("æŸ¥è¯¢å‘˜å·¥ä¸šç»©åˆ—è¡¨å®Œæˆï¼Œè¿”å›{}æ¡è®°å½•", response.getTotal());
        return response;
    }
    
    /**
     * å®ä½“è½¬DTO
     */
    private EmployeePerformanceDTO convertToDTO(EmployeePerformance entity) {
        EmployeePerformanceDTO dto = new EmployeePerformanceDTO();
        BeanUtils.copyProperties(entity, dto);
        
        // è®¡ç®—è¡ç”Ÿå­—æ®µ
        dto.setOrderAmountDisplay(formatCurrency(entity.getOrderAmount()));
        dto.setSalesAmountDisplay(formatCurrency(entity.getSalesAmount()));
        dto.setProfitRateDisplay(formatPercent(entity.getProfitRate()));
        
        return dto;
    }
    
    /**
     * æ ¹æ®å­—æ®µåè·å–æ•°æ®åº“åˆ—å
     */
    private SFunction<EmployeePerformance, ?> getColumnByField(String field) {
        switch (field) {
            case "salesAmount": return EmployeePerformance::getSalesAmount;
            case "orderCount": return EmployeePerformance::getOrderCount;
            case "profitRate": return EmployeePerformance::getProfitRate;
            case "createTime": return EmployeePerformance::getCreateTime;
            default: return EmployeePerformance::getSalesAmount;
        }
    }
}
```

## ğŸ—„ï¸ æ•°æ®è®¿é—®å±‚è§„èŒƒ

### Mapperæ¥å£è®¾è®¡
```java
/**
 * å‘˜å·¥ä¸šç»©æ•°æ®è®¿é—®æ¥å£
 */
@Mapper
public interface EmployeePerformanceMapper extends BaseMapper<EmployeePerformance> {

    /**
     * æ ¹æ®æ¡ä»¶æŸ¥è¯¢å‘˜å·¥ä¸šç»©ç»Ÿè®¡
     *
     * @param queryDTO æŸ¥è¯¢æ¡ä»¶
     * @return ç»Ÿè®¡ç»“æœ
     */
    List<EmployeePerformanceStatDTO> selectPerformanceStatistics(@Param("query") EmployeePerformanceQueryDTO queryDTO);

    /**
     * æŸ¥è¯¢å‘˜å·¥ä¸šç»©è¶‹åŠ¿æ•°æ®
     *
     * @param employeeId å‘˜å·¥ID
     * @param startDate å¼€å§‹æ—¥æœŸ
     * @param endDate ç»“æŸæ—¥æœŸ
     * @param versionId ç‰ˆæœ¬ID
     * @return è¶‹åŠ¿æ•°æ®
     */
    List<PerformanceTrendDTO> selectPerformanceTrend(@Param("employeeId") Long employeeId,
                                                    @Param("startDate") LocalDate startDate,
                                                    @Param("endDate") LocalDate endDate,
                                                    @Param("versionId") String versionId);

    /**
     * æ‰¹é‡æ’å…¥å‘˜å·¥ä¸šç»©æ•°æ®
     *
     * @param performanceList ä¸šç»©æ•°æ®åˆ—è¡¨
     * @return æ’å…¥è®°å½•æ•°
     */
    int batchInsertPerformance(@Param("list") List<EmployeePerformance> performanceList);

    /**
     * æ ¹æ®ç‰ˆæœ¬IDåˆ é™¤æ•°æ®
     *
     * @param versionId ç‰ˆæœ¬ID
     * @return åˆ é™¤è®°å½•æ•°
     */
    int deleteByVersionId(@Param("versionId") String versionId);
}
```

### å®ä½“ç±»è®¾è®¡
```java
/**
 * å‘˜å·¥ä¸šç»©å®ä½“ç±»
 */
@Data
@EqualsAndHashCode(callSuper = false)
@TableName("employee_performance")
@ApiModel(value = "EmployeePerformanceå¯¹è±¡", description = "å‘˜å·¥ä¸šç»©è¡¨")
public class EmployeePerformance extends BaseEntity {

    @ApiModelProperty(value = "ä¸»é”®ID")
    @TableId(value = "id", type = IdType.AUTO)
    private Long id;

    @ApiModelProperty(value = "æ•°æ®ç‰ˆæœ¬ID")
    @TableField("version_id")
    private Long versionId;

    @ApiModelProperty(value = "å‘˜å·¥ID")
    @TableField("employee_id")
    private Long employeeId;

    @ApiModelProperty(value = "å‘˜å·¥å§“å")
    @TableField("employee_name")
    private String employeeName;

    @ApiModelProperty(value = "å‘˜å·¥ç¼–ç ")
    @TableField("employee_code")
    private String employeeCode;

    @ApiModelProperty(value = "éƒ¨é—¨ID")
    @TableField("dept_id")
    private Long deptId;

    @ApiModelProperty(value = "éƒ¨é—¨åç§°")
    @TableField("dept_name")
    private String deptName;

    @ApiModelProperty(value = "æ•°æ®æ—¥æœŸ")
    @TableField("data_date")
    private LocalDate dataDate;

    // è®¢å•ç›¸å…³æŒ‡æ ‡
    @ApiModelProperty(value = "è®¢å•é‡‘é¢")
    @TableField("order_amount")
    private BigDecimal orderAmount;

    @ApiModelProperty(value = "è®¢å•æ•°é‡")
    @TableField("order_count")
    private Integer orderCount;

    @ApiModelProperty(value = "è®¢å•å®¢æˆ·æ•°")
    @TableField("order_customers")
    private Integer orderCustomers;

    // é”€å”®ç›¸å…³æŒ‡æ ‡
    @ApiModelProperty(value = "é”€å”®é‡‘é¢")
    @TableField("sales_amount")
    private BigDecimal salesAmount;

    @ApiModelProperty(value = "é”€å”®å•æ•°")
    @TableField("sales_count")
    private Integer salesCount;

    @ApiModelProperty(value = "å‡€é”€å”®é¢")
    @TableField("net_sales")
    private BigDecimal netSales;

    @ApiModelProperty(value = "é”€å”®æ¯›åˆ©")
    @TableField("sales_profit")
    private BigDecimal salesProfit;

    @ApiModelProperty(value = "æ¯›åˆ©ç‡")
    @TableField("profit_rate")
    private BigDecimal profitRate;

    // å®¢æˆ·ç›¸å…³æŒ‡æ ‡
    @ApiModelProperty(value = "æ‹œè®¿å®¢æˆ·æ•°")
    @TableField("visit_customers")
    private Integer visitCustomers;

    @ApiModelProperty(value = "é“ºè´§å®¢æˆ·æ•°")
    @TableField("distribution_customers")
    private Integer distributionCustomers;

    @ApiModelProperty(value = "è¿›è´§å®¢æˆ·æ•°")
    @TableField("purchase_customers")
    private Integer purchaseCustomers;

    @ApiModelProperty(value = "å®¢å•ä»·")
    @TableField("avg_order_value")
    private BigDecimal avgOrderValue;

    // å•†å“ç›¸å…³æŒ‡æ ‡
    @ApiModelProperty(value = "å‡ºè´§å•†å“æ•°")
    @TableField("outbound_products")
    private Integer outboundProducts;

    @ApiModelProperty(value = "é”€å”®å•†å“æ•°é‡")
    @TableField("sales_quantity")
    private Integer salesQuantity;

    @ApiModelProperty(value = "é€€è´§å•†å“æ•°é‡")
    @TableField("return_quantity")
    private Integer returnQuantity;

    @ApiModelProperty(value = "èµ å“æˆæœ¬")
    @TableField("gift_cost")
    private BigDecimal giftCost;
}

/**
 * åŸºç¡€å®ä½“ç±»
 */
@Data
@ApiModel("åŸºç¡€å®ä½“")
public abstract class BaseEntity {

    @ApiModelProperty(value = "åˆ›å»ºæ—¶é—´")
    @TableField(value = "create_time", fill = FieldFill.INSERT)
    private LocalDateTime createTime;

    @ApiModelProperty(value = "æ›´æ–°æ—¶é—´")
    @TableField(value = "update_time", fill = FieldFill.INSERT_UPDATE)
    private LocalDateTime updateTime;

    @ApiModelProperty(value = "åˆ›å»ºäºº")
    @TableField(value = "create_by", fill = FieldFill.INSERT)
    private Long createBy;

    @ApiModelProperty(value = "æ›´æ–°äºº")
    @TableField(value = "update_by", fill = FieldFill.INSERT_UPDATE)
    private Long updateBy;

    @ApiModelProperty(value = "é€»è¾‘åˆ é™¤æ ‡å¿—")
    @TableField("deleted")
    @TableLogic
    private Integer deleted;
}
```

## ğŸ”„ ç¼“å­˜ç­–ç•¥è§„èŒƒ

### Redisç¼“å­˜é…ç½®
```java
/**
 * Redisé…ç½®ç±»
 */
@Configuration
@EnableCaching
@Slf4j
public class RedisConfig {

    /**
     * Redisæ¨¡æ¿é…ç½®
     */
    @Bean
    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory connectionFactory) {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(connectionFactory);

        // ä½¿ç”¨Jackson2JsonRedisSerializeræ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–redisçš„valueå€¼
        Jackson2JsonRedisSerializer<Object> jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer<>(Object.class);
        ObjectMapper om = new ObjectMapper();
        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        om.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL);
        jackson2JsonRedisSerializer.setObjectMapper(om);

        // ä½¿ç”¨StringRedisSerializeræ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–redisçš„keyå€¼
        template.setKeySerializer(new StringRedisSerializer());
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setValueSerializer(jackson2JsonRedisSerializer);
        template.setHashValueSerializer(jackson2JsonRedisSerializer);

        template.afterPropertiesSet();
        return template;
    }

    /**
     * ç¼“å­˜ç®¡ç†å™¨
     */
    @Bean
    public CacheManager cacheManager(RedisConnectionFactory connectionFactory) {
        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()
                .entryTtl(Duration.ofMinutes(5)) // é»˜è®¤5åˆ†é’Ÿè¿‡æœŸ
                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(new StringRedisSerializer()))
                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(new GenericJackson2JsonRedisSerializer()))
                .disableCachingNullValues();

        return RedisCacheManager.builder(connectionFactory)
                .cacheDefaults(config)
                .build();
    }

    /**
     * Redissoné…ç½®
     */
    @Bean
    public RedissonClient redissonClient() {
        Config config = new Config();
        config.useSingleServer()
                .setAddress("redis://localhost:6379")
                .setPassword(null)
                .setDatabase(0)
                .setConnectionMinimumIdleSize(5)
                .setConnectionPoolSize(10)
                .setIdleConnectionTimeout(10000)
                .setConnectTimeout(10000)
                .setTimeout(3000)
                .setRetryAttempts(3)
                .setRetryInterval(1500);

        return Redisson.create(config);
    }
}
```
