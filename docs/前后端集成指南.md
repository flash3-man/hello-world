# å‰åç«¯é›†æˆæŒ‡å— - ä¸»ç•Œé¢å¼€å‘

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜äº†ä¸»ç•Œé¢ï¼ˆHomePageï¼‰å‰åç«¯é›†æˆçš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬å¼€å‘ç¯å¢ƒé…ç½®ã€APIè°ƒç”¨ã€æ•°æ®æµè®¾è®¡ã€é”™è¯¯å¤„ç†ç­‰ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```mermaid
graph TB
    subgraph "å‰ç«¯ Vue.js"
        A[HomePage.vue] --> B[API Service]
        B --> C[Vuex Store]
        C --> D[Components]
    end
    
    subgraph "åç«¯ Spring Boot"
        E[Controller] --> F[Service]
        F --> G[Repository]
        G --> H[Database]
    end
    
    B --> E
    E --> B
```

## ğŸ”§ å¼€å‘ç¯å¢ƒé…ç½®

### 1. å‰ç«¯ç¯å¢ƒé…ç½®

#### å®‰è£…ä¾èµ–
```bash
# å®‰è£…é¡¹ç›®ä¾èµ–
npm install

# å®‰è£…HTTPå®¢æˆ·ç«¯
npm install axios

# å®‰è£…çŠ¶æ€ç®¡ç†
npm install vuex

# å®‰è£…UIç»„ä»¶åº“ï¼ˆå¯é€‰ï¼‰
npm install element-ui
```

#### ç¯å¢ƒå˜é‡é…ç½®
```javascript
// .env.development
VUE_APP_API_BASE_URL=http://localhost:8080/api
VUE_APP_WEBSOCKET_URL=ws://localhost:8080/ws

// .env.production  
VUE_APP_API_BASE_URL=https://api.chaoyue.com/api
VUE_APP_WEBSOCKET_URL=wss://api.chaoyue.com/ws
```

#### APIå®¢æˆ·ç«¯é…ç½®
```javascript
// src/utils/request.js
import axios from 'axios'
import { Message } from 'element-ui'
import store from '@/store'
import router from '@/router'

const service = axios.create({
  baseURL: process.env.VUE_APP_API_BASE_URL,
  timeout: 10000
})

// è¯·æ±‚æ‹¦æˆªå™¨
service.interceptors.request.use(
  config => {
    const token = store.getters.token
    if (token) {
      config.headers['Authorization'] = `Bearer ${token}`
    }
    return config
  },
  error => {
    console.error('Request error:', error)
    return Promise.reject(error)
  }
)

// å“åº”æ‹¦æˆªå™¨
service.interceptors.response.use(
  response => {
    const res = response.data
    
    if (res.code !== 200) {
      Message.error(res.message || 'è¯·æ±‚å¤±è´¥')
      
      // 401: æœªæˆæƒï¼Œè·³è½¬ç™»å½•
      if (res.code === 401) {
        store.dispatch('user/logout').then(() => {
          router.push('/login')
        })
      }
      
      return Promise.reject(new Error(res.message || 'è¯·æ±‚å¤±è´¥'))
    }
    
    return res
  },
  error => {
    console.error('Response error:', error)
    
    let message = 'ç½‘ç»œé”™è¯¯'
    if (error.response) {
      switch (error.response.status) {
        case 400:
          message = 'è¯·æ±‚å‚æ•°é”™è¯¯'
          break
        case 401:
          message = 'æœªæˆæƒï¼Œè¯·é‡æ–°ç™»å½•'
          store.dispatch('user/logout').then(() => {
            router.push('/login')
          })
          break
        case 403:
          message = 'æƒé™ä¸è¶³'
          break
        case 404:
          message = 'è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨'
          break
        case 500:
          message = 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
          break
        default:
          message = `è¿æ¥é”™è¯¯${error.response.status}`
      }
    }
    
    Message.error(message)
    return Promise.reject(error)
  }
)

export default service
```

### 2. åç«¯ç¯å¢ƒé…ç½®

#### Mavenä¾èµ–
```xml
<!-- pom.xml -->
<dependencies>
    <!-- Spring Boot Starter Web -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    
    <!-- Spring Boot Starter Data JPA -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-jpa</artifactId>
    </dependency>
    
    <!-- MySQL Driver -->
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <scope>runtime</scope>
    </dependency>
    
    <!-- Redis -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-redis</artifactId>
    </dependency>
    
    <!-- JWT -->
    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt</artifactId>
        <version>0.9.1</version>
    </dependency>
    
    <!-- Validation -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-validation</artifactId>
    </dependency>
</dependencies>
```

#### åº”ç”¨é…ç½®
```yaml
# application.yml
spring:
  application:
    name: chaoyue-business-api
    
  datasource:
    url: jdbc:mysql://localhost:3306/chaoyue_business?useUnicode=true&characterEncoding=utf8&serverTimezone=GMT%2B8
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:password}
    driver-class-name: com.mysql.cj.jdbc.Driver
    
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.MySQL8Dialect
        
  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    timeout: 3000ms
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0
        
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8
    
server:
  port: 8080
  servlet:
    context-path: /api
    
logging:
  level:
    com.chaoyue.business: DEBUG
    org.springframework.web: DEBUG
    
# JWTé…ç½®
jwt:
  secret: chaoyue-business-secret-key-2024
  expiration: 86400 # 24å°æ—¶
  
# ä¸šåŠ¡é…ç½®
business:
  dashboard:
    refresh-interval: 300 # 5åˆ†é’Ÿ
  alert:
    max-display: 5
```

## ğŸ“¡ APIæœåŠ¡å±‚è®¾è®¡

### 1. å‰ç«¯APIæœåŠ¡
```javascript
// src/api/dashboard.js
import request from '@/utils/request'

export default {
  // è·å–é”€å”®æ•°æ®æ¦‚è§ˆ
  getSalesOverview() {
    return request({
      url: '/dashboard/sales-overview',
      method: 'get'
    })
  },
  
  // è·å–æ•°æ®è¯¦æƒ…
  getDataDetail(type) {
    return request({
      url: `/dashboard/data-detail/${type}`,
      method: 'get'
    })
  },
  
  // è·å–é”€å”®è¶‹åŠ¿
  getSalesTrend(params) {
    return request({
      url: '/dashboard/sales-trend',
      method: 'get',
      params
    })
  }
}
```

```javascript
// src/api/alerts.js
import request from '@/utils/request'

export default {
  // è·å–é¢„è­¦åˆ—è¡¨
  getList(params) {
    return request({
      url: '/alerts/list',
      method: 'get',
      params
    })
  },
  
  // æ ‡è®°ä¸ºå·²è¯»
  markAsRead(alertId) {
    return request({
      url: `/alerts/${alertId}/read`,
      method: 'put'
    })
  },
  
  // è·å–é¢„è­¦è¯¦æƒ…
  getDetail(alertId) {
    return request({
      url: `/alerts/${alertId}/detail`,
      method: 'get'
    })
  }
}
```

```javascript
// src/api/index.js - ç»Ÿä¸€å¯¼å‡º
import dashboard from './dashboard'
import alerts from './alerts'
import search from './search'
import user from './user'
import goals from './goals'

export default {
  dashboard,
  alerts,
  search,
  user,
  goals
}
```

### 2. Vueç»„ä»¶ä¸­çš„ä½¿ç”¨
```javascript
// src/views/HomePage.vue
<template>
  <div class="home-page">
    <!-- æ•°æ®çœ‹æ¿ -->
    <div class="data-dashboard" v-loading="loading.dashboard">
      <div class="sales-card">
        <div class="sales-value">{{ salesData.currentMonth.totalSales | currency }}</div>
        <div class="sales-label">æœ¬æœˆé”€å”®é‡‘é¢</div>
      </div>
    </div>
    
    <!-- é¢„è­¦ä¿¡æ¯ -->
    <div class="alert-banner" v-if="currentAlert">
      <span>{{ currentAlert.message }}</span>
    </div>
  </div>
</template>

<script>
import api from '@/api'

export default {
  name: 'HomePage',
  
  data() {
    return {
      salesData: {
        currentMonth: {},
        lastMonth: {},
        today: {},
        yesterday: {}
      },
      alerts: [],
      currentAlert: null,
      loading: {
        dashboard: false,
        alerts: false
      },
      refreshTimer: null
    }
  },
  
  async mounted() {
    await this.initializeData()
    this.startAutoRefresh()
  },
  
  beforeDestroy() {
    if (this.refreshTimer) {
      clearInterval(this.refreshTimer)
    }
  },
  
  methods: {
    async initializeData() {
      try {
        await Promise.all([
          this.loadSalesData(),
          this.loadAlerts(),
          this.loadFunctionConfig()
        ])
      } catch (error) {
        console.error('åˆå§‹åŒ–æ•°æ®å¤±è´¥:', error)
      }
    },
    
    async loadSalesData() {
      this.loading.dashboard = true
      try {
        const response = await api.dashboard.getSalesOverview()
        this.salesData = response.data
      } catch (error) {
        this.$message.error('åŠ è½½é”€å”®æ•°æ®å¤±è´¥')
      } finally {
        this.loading.dashboard = false
      }
    },
    
    async loadAlerts() {
      this.loading.alerts = true
      try {
        const response = await api.alerts.getList({ 
          unreadOnly: true, 
          limit: 5 
        })
        this.alerts = response.data.content
        this.startAlertRotation()
      } catch (error) {
        this.$message.error('åŠ è½½é¢„è­¦ä¿¡æ¯å¤±è´¥')
      } finally {
        this.loading.alerts = false
      }
    },
    
    startAutoRefresh() {
      this.refreshTimer = setInterval(() => {
        this.loadSalesData()
        this.loadAlerts()
      }, 300000) // 5åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡
    },
    
    startAlertRotation() {
      if (this.alerts.length > 0) {
        let currentIndex = 0
        this.currentAlert = this.alerts[0]
        
        setInterval(() => {
          currentIndex = (currentIndex + 1) % this.alerts.length
          this.currentAlert = this.alerts[currentIndex]
        }, 5000) // 5ç§’åˆ‡æ¢ä¸€æ¬¡
      }
    }
  },
  
  filters: {
    currency(value) {
      if (!value) return '0.00'
      return Number(value).toLocaleString('zh-CN', {
        style: 'currency',
        currency: 'CNY'
      })
    }
  }
}
</script>
```

## ğŸ”„ çŠ¶æ€ç®¡ç† (Vuex)

### 1. Storeæ¨¡å—è®¾è®¡
```javascript
// src/store/modules/dashboard.js
import api from '@/api'

const state = {
  salesData: {
    currentMonth: {},
    lastMonth: {},
    today: {},
    yesterday: {}
  },
  alerts: [],
  functionConfig: [],
  goals: [],
  loading: false,
  lastUpdateTime: null
}

const mutations = {
  SET_SALES_DATA(state, data) {
    state.salesData = data
    state.lastUpdateTime = new Date()
  },
  
  SET_ALERTS(state, alerts) {
    state.alerts = alerts
  },
  
  SET_FUNCTION_CONFIG(state, config) {
    state.functionConfig = config
  },
  
  SET_GOALS(state, goals) {
    state.goals = goals
  },
  
  SET_LOADING(state, loading) {
    state.loading = loading
  },
  
  MARK_ALERT_READ(state, alertId) {
    const alert = state.alerts.find(a => a.id === alertId)
    if (alert) {
      alert.isRead = true
    }
  }
}

const actions = {
  async fetchSalesData({ commit }) {
    commit('SET_LOADING', true)
    try {
      const response = await api.dashboard.getSalesOverview()
      commit('SET_SALES_DATA', response.data)
      return response.data
    } finally {
      commit('SET_LOADING', false)
    }
  },
  
  async fetchAlerts({ commit }, params = {}) {
    try {
      const response = await api.alerts.getList(params)
      commit('SET_ALERTS', response.data.content)
      return response.data
    } catch (error) {
      console.error('è·å–é¢„è­¦å¤±è´¥:', error)
      throw error
    }
  },
  
  async markAlertAsRead({ commit }, alertId) {
    try {
      await api.alerts.markAsRead(alertId)
      commit('MARK_ALERT_READ', alertId)
    } catch (error) {
      console.error('æ ‡è®°é¢„è­¦å¤±è´¥:', error)
      throw error
    }
  }
}

const getters = {
  unreadAlerts: state => state.alerts.filter(alert => !alert.isRead),
  highPriorityAlerts: state => state.alerts.filter(alert => alert.priority === 'high'),
  isDataStale: state => {
    if (!state.lastUpdateTime) return true
    const now = new Date()
    const diff = now - state.lastUpdateTime
    return diff > 300000 // 5åˆ†é’Ÿ
  }
}

export default {
  namespaced: true,
  state,
  mutations,
  actions,
  getters
}
```

### 2. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨Store
```javascript
// ä½¿ç”¨mapState, mapActionsç­‰è¾…åŠ©å‡½æ•°
import { mapState, mapActions, mapGetters } from 'vuex'

export default {
  computed: {
    ...mapState('dashboard', ['salesData', 'alerts', 'loading']),
    ...mapGetters('dashboard', ['unreadAlerts', 'isDataStale'])
  },
  
  methods: {
    ...mapActions('dashboard', ['fetchSalesData', 'fetchAlerts', 'markAlertAsRead']),
    
    async refreshData() {
      try {
        await Promise.all([
          this.fetchSalesData(),
          this.fetchAlerts()
        ])
        this.$message.success('æ•°æ®åˆ·æ–°æˆåŠŸ')
      } catch (error) {
        this.$message.error('æ•°æ®åˆ·æ–°å¤±è´¥')
      }
    }
  }
}
```

## ğŸ”’ è®¤è¯ä¸æƒé™

### 1. JWT Tokenç®¡ç†
```javascript
// src/utils/auth.js
const TOKEN_KEY = 'chaoyue_token'
const USER_KEY = 'chaoyue_user'

export function getToken() {
  return localStorage.getItem(TOKEN_KEY)
}

export function setToken(token) {
  return localStorage.setItem(TOKEN_KEY, token)
}

export function removeToken() {
  return localStorage.removeItem(TOKEN_KEY)
}

export function getUser() {
  const user = localStorage.getItem(USER_KEY)
  return user ? JSON.parse(user) : null
}

export function setUser(user) {
  return localStorage.setItem(USER_KEY, JSON.stringify(user))
}

export function removeUser() {
  return localStorage.removeItem(USER_KEY)
}
```

### 2. è·¯ç”±å®ˆå«
```javascript
// src/router/index.js
import { getToken } from '@/utils/auth'

router.beforeEach((to, from, next) => {
  const hasToken = getToken()
  
  if (to.path === '/login') {
    if (hasToken) {
      next({ path: '/' })
    } else {
      next()
    }
  } else {
    if (hasToken) {
      next()
    } else {
      next('/login')
    }
  }
})
```

## ğŸš¨ é”™è¯¯å¤„ç†

### 1. å…¨å±€é”™è¯¯å¤„ç†
```javascript
// src/utils/errorHandler.js
export function handleApiError(error, context) {
  console.error('API Error:', error)
  
  let message = 'æ“ä½œå¤±è´¥'
  
  if (error.response) {
    const { status, data } = error.response
    
    switch (status) {
      case 400:
        message = data.message || 'è¯·æ±‚å‚æ•°é”™è¯¯'
        break
      case 401:
        message = 'ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•'
        // è·³è½¬åˆ°ç™»å½•é¡µ
        context.$router.push('/login')
        break
      case 403:
        message = 'æƒé™ä¸è¶³'
        break
      case 404:
        message = 'è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨'
        break
      case 500:
        message = 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•'
        break
      default:
        message = `è¯·æ±‚å¤±è´¥ (${status})`
    }
  } else if (error.request) {
    message = 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ'
  }
  
  context.$message.error(message)
  return Promise.reject(error)
}
```

### 2. ç»„ä»¶çº§é”™è¯¯å¤„ç†
```javascript
// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
async loadData() {
  try {
    const data = await api.dashboard.getSalesOverview()
    this.salesData = data
  } catch (error) {
    this.handleApiError(error, this)
  }
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®ç¼“å­˜ç­–ç•¥
```javascript
// src/utils/cache.js
class DataCache {
  constructor() {
    this.cache = new Map()
    this.expireTime = 5 * 60 * 1000 // 5åˆ†é’Ÿ
  }
  
  set(key, data) {
    this.cache.set(key, {
      data,
      timestamp: Date.now()
    })
  }
  
  get(key) {
    const item = this.cache.get(key)
    if (!item) return null
    
    if (Date.now() - item.timestamp > this.expireTime) {
      this.cache.delete(key)
      return null
    }
    
    return item.data
  }
  
  clear() {
    this.cache.clear()
  }
}

export default new DataCache()
```

### 2. é˜²æŠ–èŠ‚æµ
```javascript
// src/utils/debounce.js
export function debounce(func, wait) {
  let timeout
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout)
      func(...args)
    }
    clearTimeout(timeout)
    timeout = setTimeout(later, wait)
  }
}

export function throttle(func, limit) {
  let inThrottle
  return function() {
    const args = arguments
    const context = this
    if (!inThrottle) {
      func.apply(context, args)
      inThrottle = true
      setTimeout(() => inThrottle = false, limit)
    }
  }
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-08-15  
**ç»´æŠ¤äººå‘˜**: å‰ç«¯å¼€å‘å›¢é˜Ÿ
