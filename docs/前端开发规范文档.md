# å‰ç«¯å¼€å‘è§„èŒƒæ–‡æ¡£

## ğŸ“± ç§»åŠ¨ç«¯æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆé€‰å‹
- **æ¡†æ¶**: Vue 3.3+ (Composition API)
- **è¯­è¨€**: TypeScript 5.0+
- **UIç»„ä»¶**: Vant 4.6+ (ç§»åŠ¨ç«¯UIåº“)
- **çŠ¶æ€ç®¡ç†**: Pinia 2.1+
- **è·¯ç”±**: Vue Router 4.2+
- **HTTPå®¢æˆ·ç«¯**: Axios 1.4+
- **æ„å»ºå·¥å…·**: Vite 4.0+
- **ä»£ç è§„èŒƒ**: ESLint + Prettier
- **æµ‹è¯•æ¡†æ¶**: Vitest + Vue Test Utils

### é¡¹ç›®ç›®å½•ç»“æ„
```
src/
â”œâ”€â”€ api/                    # APIæ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ modules/           # æŒ‰æ¨¡å—åˆ†ç»„çš„æ¥å£
â”‚   â”‚   â”œâ”€â”€ auth.ts       # è®¤è¯ç›¸å…³æ¥å£
â”‚   â”‚   â”œâ”€â”€ performance.ts # ä¸šç»©ç›¸å…³æ¥å£
â”‚   â”‚   â””â”€â”€ analysis.ts   # åˆ†æç›¸å…³æ¥å£
â”‚   â”œâ”€â”€ types/            # æ¥å£ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ request.ts        # è¯·æ±‚å°è£…
â”œâ”€â”€ assets/               # é™æ€èµ„æº
â”‚   â”œâ”€â”€ images/          # å›¾ç‰‡èµ„æº
â”‚   â”œâ”€â”€ icons/           # å›¾æ ‡èµ„æº
â”‚   â””â”€â”€ styles/          # å…¨å±€æ ·å¼
â”œâ”€â”€ components/           # å…¬å…±ç»„ä»¶
â”‚   â”œâ”€â”€ common/          # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ charts/          # å›¾è¡¨ç»„ä»¶
â”‚   â””â”€â”€ business/        # ä¸šåŠ¡ç»„ä»¶
â”œâ”€â”€ composables/          # ç»„åˆå¼å‡½æ•°
â”‚   â”œâ”€â”€ useAuth.ts       # è®¤è¯ç›¸å…³
â”‚   â”œâ”€â”€ useRequest.ts    # è¯·æ±‚ç›¸å…³
â”‚   â””â”€â”€ useChart.ts      # å›¾è¡¨ç›¸å…³
â”œâ”€â”€ pages/               # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ home/           # é¦–é¡µ
â”‚   â”œâ”€â”€ performance/    # ä¸šç»©æ¨¡å—
â”‚   â”œâ”€â”€ analysis/       # åˆ†ææ¨¡å—
â”‚   â””â”€â”€ profile/        # ä¸ªäººä¸­å¿ƒ
â”œâ”€â”€ router/              # è·¯ç”±é…ç½®
â”œâ”€â”€ stores/              # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ auth.ts         # è®¤è¯çŠ¶æ€
â”‚   â”œâ”€â”€ performance.ts  # ä¸šç»©æ•°æ®çŠ¶æ€
â”‚   â””â”€â”€ app.ts          # åº”ç”¨å…¨å±€çŠ¶æ€
â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ format.ts       # æ ¼å¼åŒ–å·¥å…·
â”‚   â”œâ”€â”€ validate.ts     # éªŒè¯å·¥å…·
â”‚   â””â”€â”€ storage.ts      # å­˜å‚¨å·¥å…·
â”œâ”€â”€ types/               # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ api.ts          # APIç±»å‹
â”‚   â”œâ”€â”€ business.ts     # ä¸šåŠ¡ç±»å‹
â”‚   â””â”€â”€ common.ts       # é€šç”¨ç±»å‹
â”œâ”€â”€ App.vue             # æ ¹ç»„ä»¶
â””â”€â”€ main.ts             # å…¥å£æ–‡ä»¶
```

## ğŸ¨ UI/UXè®¾è®¡è§„èŒƒ

### è®¾è®¡ç³»ç»Ÿ
```scss
// è®¾è®¡ä»¤ç‰Œ (Design Tokens)
:root {
  // ä¸»è‰²è°ƒ
  --primary-color: #1890ff;
  --primary-light: #40a9ff;
  --primary-dark: #096dd9;
  
  // è¾…åŠ©è‰²
  --success-color: #52c41a;
  --warning-color: #faad14;
  --error-color: #f5222d;
  --info-color: #1890ff;
  
  // ä¸­æ€§è‰²
  --text-primary: #262626;
  --text-secondary: #595959;
  --text-disabled: #bfbfbf;
  --border-color: #d9d9d9;
  --background-color: #f5f5f5;
  
  // é—´è·
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 16px;
  --spacing-lg: 24px;
  --spacing-xl: 32px;
  
  // å­—ä½“
  --font-size-xs: 10px;
  --font-size-sm: 12px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-xxl: 20px;
  
  // åœ†è§’
  --border-radius-sm: 2px;
  --border-radius-md: 4px;
  --border-radius-lg: 8px;
  
  // é˜´å½±
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12);
  --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.12);
  --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.12);
}
```

### ç»„ä»¶è®¾è®¡åŸåˆ™
1. **åŸå­åŒ–è®¾è®¡**: æŒ‰ç…§åŸå­ã€åˆ†å­ã€ç»„ç»‡ã€æ¨¡æ¿ã€é¡µé¢çš„å±‚æ¬¡è®¾è®¡
2. **å“åº”å¼è®¾è®¡**: é€‚é…ä¸åŒå±å¹•å°ºå¯¸å’Œæ–¹å‘
3. **æ— éšœç¢è®¾è®¡**: æ”¯æŒå±å¹•é˜…è¯»å™¨å’Œé”®ç›˜å¯¼èˆª
4. **æ€§èƒ½ä¼˜åŒ–**: ç»„ä»¶æ‡’åŠ è½½ã€è™šæ‹Ÿæ»šåŠ¨
5. **ä¸»é¢˜å®šåˆ¶**: æ”¯æŒä¸»é¢˜åˆ‡æ¢å’Œä¸ªæ€§åŒ–å®šåˆ¶

### ç§»åŠ¨ç«¯é€‚é…æ–¹æ¡ˆ
```typescript
// remé€‚é…æ–¹æ¡ˆ
function setRem() {
  const baseSize = 37.5; // åŸºå‡†å¤§å°
  const scale = document.documentElement.clientWidth / 375; // è®¾è®¡ç¨¿å®½åº¦375px
  document.documentElement.style.fontSize = baseSize * Math.min(scale, 2) + 'px';
}

// viewporté€‚é…
const viewport = document.querySelector('meta[name=viewport]');
viewport?.setAttribute('content', 
  'width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no');

// å®‰å…¨åŒºåŸŸé€‚é… (iPhone Xç­‰)
.safe-area-inset {
  padding-top: constant(safe-area-inset-top);
  padding-top: env(safe-area-inset-top);
  padding-bottom: constant(safe-area-inset-bottom);
  padding-bottom: env(safe-area-inset-bottom);
}
```

## ğŸ”§ å¼€å‘å·¥å…·é…ç½®

### Viteé…ç½®
```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import { resolve } from 'path';

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      '@/api': resolve(__dirname, 'src/api'),
      '@/components': resolve(__dirname, 'src/components'),
      '@/utils': resolve(__dirname, 'src/utils'),
      '@/types': resolve(__dirname, 'src/types')
    }
  },
  css: {
    preprocessorOptions: {
      scss: {
        additionalData: '@import "@/assets/styles/variables.scss";'
      }
    }
  },
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '/api')
      }
    }
  },
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['vue', 'vue-router', 'pinia'],
          ui: ['vant'],
          charts: ['echarts']
        }
      }
    }
  }
});
```

### ESLinté…ç½®
```javascript
// .eslintrc.js
module.exports = {
  env: {
    browser: true,
    es2021: true,
    node: true
  },
  extends: [
    'eslint:recommended',
    '@vue/eslint-config-typescript',
    '@vue/eslint-config-prettier'
  ],
  parserOptions: {
    ecmaVersion: 'latest',
    sourceType: 'module'
  },
  rules: {
    // Vueç›¸å…³è§„åˆ™
    'vue/multi-word-component-names': 'off',
    'vue/no-unused-vars': 'error',
    'vue/no-mutating-props': 'error',
    
    // TypeScriptç›¸å…³è§„åˆ™
    '@typescript-eslint/no-unused-vars': 'error',
    '@typescript-eslint/explicit-function-return-type': 'warn',
    '@typescript-eslint/no-explicit-any': 'warn',
    
    // é€šç”¨è§„åˆ™
    'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'no-debugger': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'prefer-const': 'error',
    'no-var': 'error'
  }
};
```

## ğŸ“¦ çŠ¶æ€ç®¡ç†è§„èŒƒ

### Pinia Storeè®¾è®¡
```typescript
// stores/auth.ts
import { defineStore } from 'pinia';
import { ref, computed } from 'vue';
import type { User, LoginRequest } from '@/types/auth';

export const useAuthStore = defineStore('auth', () => {
  // çŠ¶æ€
  const token = ref<string>('');
  const user = ref<User | null>(null);
  const permissions = ref<string[]>([]);
  
  // è®¡ç®—å±æ€§
  const isLoggedIn = computed(() => !!token.value);
  const hasPermission = computed(() => (permission: string) => {
    return permissions.value.includes(permission) || permissions.value.includes('*:*:*');
  });
  
  // æ–¹æ³•
  async function login(loginData: LoginRequest) {
    try {
      const response = await authApi.login(loginData);
      token.value = response.data.token;
      user.value = response.data.user;
      permissions.value = response.data.user.permissions;
      
      // å­˜å‚¨åˆ°æœ¬åœ°
      localStorage.setItem('token', token.value);
      localStorage.setItem('user', JSON.stringify(user.value));
      
      return response;
    } catch (error) {
      throw error;
    }
  }
  
  function logout() {
    token.value = '';
    user.value = null;
    permissions.value = [];
    localStorage.removeItem('token');
    localStorage.removeItem('user');
  }
  
  function initAuth() {
    const savedToken = localStorage.getItem('token');
    const savedUser = localStorage.getItem('user');
    
    if (savedToken && savedUser) {
      token.value = savedToken;
      user.value = JSON.parse(savedUser);
      permissions.value = user.value?.permissions || [];
    }
  }
  
  return {
    // çŠ¶æ€
    token,
    user,
    permissions,
    // è®¡ç®—å±æ€§
    isLoggedIn,
    hasPermission,
    // æ–¹æ³•
    login,
    logout,
    initAuth
  };
});
```

### ä¸šåŠ¡æ•°æ®Store
```typescript
// stores/performance.ts
import { defineStore } from 'pinia';
import { ref, reactive } from 'vue';
import type { EmployeePerformance, PerformanceQuery } from '@/types/performance';

export const usePerformanceStore = defineStore('performance', () => {
  // çŠ¶æ€
  const performanceList = ref<EmployeePerformance[]>([]);
  const loading = ref(false);
  const currentVersion = ref<string>('');
  
  // æŸ¥è¯¢æ¡ä»¶
  const queryParams = reactive<PerformanceQuery>({
    pageNum: 1,
    pageSize: 20,
    startDate: '',
    endDate: '',
    sortField: 'salesAmount',
    sortOrder: 'desc'
  });
  
  // åˆ†é¡µä¿¡æ¯
  const pagination = reactive({
    total: 0,
    pageNum: 1,
    pageSize: 20,
    pages: 0
  });
  
  // æ–¹æ³•
  async function fetchPerformanceList(params?: Partial<PerformanceQuery>) {
    loading.value = true;
    try {
      Object.assign(queryParams, params);
      const response = await performanceApi.getEmployeePerformanceList(queryParams);
      
      performanceList.value = response.data.list;
      Object.assign(pagination, {
        total: response.data.total,
        pageNum: response.data.pageNum,
        pageSize: response.data.pageSize,
        pages: response.data.pages
      });
      
      return response;
    } catch (error) {
      throw error;
    } finally {
      loading.value = false;
    }
  }
  
  function resetQuery() {
    Object.assign(queryParams, {
      pageNum: 1,
      pageSize: 20,
      startDate: '',
      endDate: '',
      employeeIds: [],
      deptIds: [],
      sortField: 'salesAmount',
      sortOrder: 'desc'
    });
  }
  
  return {
    // çŠ¶æ€
    performanceList,
    loading,
    currentVersion,
    queryParams,
    pagination,
    // æ–¹æ³•
    fetchPerformanceList,
    resetQuery
  };
});
```

## ğŸ¯ ç»„ä»¶å¼€å‘è§„èŒƒ

### ç»„ä»¶å‘½åè§„èŒƒ
```typescript
// ç»„ä»¶æ–‡ä»¶å‘½åï¼šPascalCase
// æ–‡ä»¶å: EmployeePerformanceCard.vue
// ç»„ä»¶å: EmployeePerformanceCard

// ç»„ä»¶æ³¨å†Œåï¼škebab-case
<employee-performance-card />

// Propså‘½åï¼šcamelCase
interface Props {
  employeeData: EmployeePerformance;
  showDetails?: boolean;
  onItemClick?: (item: EmployeePerformance) => void;
}
```

### ç»„ä»¶ç»“æ„æ¨¡æ¿
```vue
<template>
  <div class="employee-performance-card">
    <!-- ç»„ä»¶å†…å®¹ -->
    <div class="card-header">
      <h3 class="employee-name">{{ employeeData.employeeName }}</h3>
      <span class="dept-name">{{ employeeData.deptName }}</span>
    </div>
    
    <div class="card-content">
      <div class="metric-item" v-for="metric in displayMetrics" :key="metric.key">
        <span class="metric-label">{{ metric.label }}</span>
        <span class="metric-value" :class="metric.className">
          {{ formatValue(metric.value, metric.type) }}
        </span>
      </div>
    </div>
    
    <div class="card-actions" v-if="showActions">
      <van-button size="small" @click="handleViewDetail">æŸ¥çœ‹è¯¦æƒ…</van-button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import type { EmployeePerformance } from '@/types/performance';
import { formatCurrency, formatPercent } from '@/utils/format';

// Propså®šä¹‰
interface Props {
  employeeData: EmployeePerformance;
  showActions?: boolean;
}

const props = withDefaults(defineProps<Props>(), {
  showActions: true
});

// Emitså®šä¹‰
interface Emits {
  viewDetail: [employee: EmployeePerformance];
  itemClick: [employee: EmployeePerformance];
}

const emit = defineEmits<Emits>();

// è®¡ç®—å±æ€§
const displayMetrics = computed(() => [
  {
    key: 'salesAmount',
    label: 'é”€å”®é‡‘é¢',
    value: props.employeeData.salesAmount,
    type: 'currency',
    className: 'text-primary'
  },
  {
    key: 'orderCount',
    label: 'è®¢å•æ•°é‡',
    value: props.employeeData.orderCount,
    type: 'number',
    className: 'text-info'
  },
  {
    key: 'profitRate',
    label: 'æ¯›åˆ©ç‡',
    value: props.employeeData.profitRate,
    type: 'percent',
    className: props.employeeData.profitRate >= 25 ? 'text-success' : 'text-warning'
  }
]);

// æ–¹æ³•
function formatValue(value: number, type: string): string {
  switch (type) {
    case 'currency':
      return formatCurrency(value);
    case 'percent':
      return formatPercent(value);
    default:
      return value.toString();
  }
}

function handleViewDetail() {
  emit('viewDetail', props.employeeData);
}
</script>

<style lang="scss" scoped>
.employee-performance-card {
  background: white;
  border-radius: var(--border-radius-lg);
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-sm);
  box-shadow: var(--shadow-sm);
  
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-sm);
    
    .employee-name {
      font-size: var(--font-size-lg);
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }
    
    .dept-name {
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
    }
  }
  
  .card-content {
    .metric-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-xs) 0;
      
      .metric-label {
        font-size: var(--font-size-sm);
        color: var(--text-secondary);
      }
      
      .metric-value {
        font-size: var(--font-size-md);
        font-weight: 500;
        
        &.text-primary { color: var(--primary-color); }
        &.text-success { color: var(--success-color); }
        &.text-warning { color: var(--warning-color); }
        &.text-info { color: var(--info-color); }
      }
    }
  }
  
  .card-actions {
    margin-top: var(--spacing-md);
    text-align: right;
  }
}
</style>
```

## ğŸ”Œ APIè°ƒç”¨è§„èŒƒ

### HTTPè¯·æ±‚å°è£…
```typescript
// api/request.ts
import axios, { type AxiosInstance, type AxiosRequestConfig, type AxiosResponse } from 'axios';
import { showToast } from 'vant';
import { useAuthStore } from '@/stores/auth';
import router from '@/router';

// åˆ›å»ºaxioså®ä¾‹
const request: AxiosInstance = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
});

// è¯·æ±‚æ‹¦æˆªå™¨
request.interceptors.request.use(
  (config) => {
    const authStore = useAuthStore();
    
    // æ·»åŠ è®¤è¯token
    if (authStore.token) {
      config.headers.Authorization = `Bearer ${authStore.token}`;
    }
    
    // æ·»åŠ è¯·æ±‚ID
    config.headers['X-Request-ID'] = generateRequestId();
    
    // æ·»åŠ å®¢æˆ·ç«¯ä¿¡æ¯
    config.headers['X-Client-Version'] = import.meta.env.VITE_APP_VERSION;
    config.headers['X-Platform'] = 'mobile';
    
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// å“åº”æ‹¦æˆªå™¨
request.interceptors.response.use(
  (response: AxiosResponse) => {
    const { code, message, data } = response.data;
    
    if (code === 200) {
      return response.data;
    } else {
      // ä¸šåŠ¡é”™è¯¯å¤„ç†
      showToast(message || 'è¯·æ±‚å¤±è´¥');
      return Promise.reject(new Error(message));
    }
  },
  (error) => {
    // HTTPé”™è¯¯å¤„ç†
    if (error.response) {
      const { status, data } = error.response;
      
      switch (status) {
        case 401:
          // Tokenè¿‡æœŸï¼Œè·³è½¬ç™»å½•
          const authStore = useAuthStore();
          authStore.logout();
          router.push('/login');
          showToast('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
          break;
        case 403:
          showToast('æƒé™ä¸è¶³');
          break;
        case 404:
          showToast('è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨');
          break;
        case 500:
          showToast('æœåŠ¡å™¨å†…éƒ¨é”™è¯¯');
          break;
        default:
          showToast(data?.message || 'ç½‘ç»œé”™è¯¯');
      }
    } else {
      showToast('ç½‘ç»œè¿æ¥å¤±è´¥');
    }
    
    return Promise.reject(error);
  }
);

export default request;
```

### APIæ¨¡å—å®šä¹‰
```typescript
// api/modules/performance.ts
import request from '@/api/request';
import type { 
  EmployeePerformanceQuery, 
  EmployeePerformanceResponse,
  EmployeeDetailResponse 
} from '@/types/performance';

export const performanceApi = {
  // è·å–å‘˜å·¥ä¸šç»©åˆ—è¡¨
  getEmployeePerformanceList(params: EmployeePerformanceQuery) {
    return request.get<PageResponse<EmployeePerformanceResponse>>('/performance/employee/list', {
      params
    });
  },
  
  // è·å–å‘˜å·¥ä¸šç»©è¯¦æƒ…
  getEmployeePerformanceDetail(employeeId: number, params: {
    startDate: string;
    endDate: string;
    versionId?: string;
  }) {
    return request.get<EmployeeDetailResponse>(`/performance/employee/${employeeId}`, {
      params
    });
  },
  
  // å¯¼å‡ºå‘˜å·¥ä¸šç»©æ•°æ®
  exportEmployeePerformance(params: {
    startDate: string;
    endDate: string;
    employeeIds?: number[];
    format: 'excel' | 'csv';
  }) {
    return request.post<{ downloadUrl: string }>('/export/employee-performance', params);
  }
};
```

## ğŸ“Š å›¾è¡¨ç»„ä»¶è§„èŒƒ

### EChartså°è£…
```vue
<!-- components/charts/BaseChart.vue -->
<template>
  <div ref="chartRef" :style="{ width, height }" class="base-chart"></div>
</template>

<script setup lang="ts">
import { ref, onMounted, onUnmounted, watch, nextTick } from 'vue';
import * as echarts from 'echarts/core';
import type { EChartsOption } from 'echarts';

interface Props {
  option: EChartsOption;
  width?: string;
  height?: string;
  theme?: string;
}

const props = withDefaults(defineProps<Props>(), {
  width: '100%',
  height: '300px',
  theme: 'default'
});

const chartRef = ref<HTMLDivElement>();
let chartInstance: echarts.ECharts | null = null;

// åˆå§‹åŒ–å›¾è¡¨
function initChart() {
  if (!chartRef.value) return;
  
  chartInstance = echarts.init(chartRef.value, props.theme);
  chartInstance.setOption(props.option);
  
  // å“åº”å¼è°ƒæ•´
  window.addEventListener('resize', handleResize);
}

// æ›´æ–°å›¾è¡¨
function updateChart() {
  if (chartInstance) {
    chartInstance.setOption(props.option, true);
  }
}

// è°ƒæ•´å¤§å°
function handleResize() {
  if (chartInstance) {
    chartInstance.resize();
  }
}

// ç›‘å¬é…ç½®å˜åŒ–
watch(() => props.option, updateChart, { deep: true });

onMounted(() => {
  nextTick(initChart);
});

onUnmounted(() => {
  if (chartInstance) {
    chartInstance.dispose();
    window.removeEventListener('resize', handleResize);
  }
});
</script>

<style lang="scss" scoped>
.base-chart {
  min-height: 200px;
}
</style>
```

## ğŸ” å·¥å…·å‡½æ•°è§„èŒƒ

### æ ¼å¼åŒ–å·¥å…·
```typescript
// utils/format.ts

/**
 * æ ¼å¼åŒ–è´§å¸
 * @param value æ•°å€¼
 * @param currency è´§å¸ç¬¦å·
 * @returns æ ¼å¼åŒ–åçš„è´§å¸å­—ç¬¦ä¸²
 */
export function formatCurrency(value: number, currency = 'Â¥'): string {
  if (value === null || value === undefined) return '-';
  
  return `${currency}${value.toLocaleString('zh-CN', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  })}`;
}

/**
 * æ ¼å¼åŒ–ç™¾åˆ†æ¯”
 * @param value æ•°å€¼
 * @param decimals å°æ•°ä½æ•°
 * @returns æ ¼å¼åŒ–åçš„ç™¾åˆ†æ¯”å­—ç¬¦ä¸²
 */
export function formatPercent(value: number, decimals = 2): string {
  if (value === null || value === undefined) return '-';
  
  return `${value.toFixed(decimals)}%`;
}

/**
 * æ ¼å¼åŒ–æ•°å­—
 * @param value æ•°å€¼
 * @param decimals å°æ•°ä½æ•°
 * @returns æ ¼å¼åŒ–åçš„æ•°å­—å­—ç¬¦ä¸²
 */
export function formatNumber(value: number, decimals = 0): string {
  if (value === null || value === undefined) return '-';
  
  return value.toLocaleString('zh-CN', {
    minimumFractionDigits: decimals,
    maximumFractionDigits: decimals
  });
}

/**
 * æ ¼å¼åŒ–æ—¥æœŸ
 * @param date æ—¥æœŸ
 * @param format æ ¼å¼
 * @returns æ ¼å¼åŒ–åçš„æ—¥æœŸå­—ç¬¦ä¸²
 */
export function formatDate(date: string | Date, format = 'YYYY-MM-DD'): string {
  if (!date) return '-';
  
  const d = new Date(date);
  const year = d.getFullYear();
  const month = String(d.getMonth() + 1).padStart(2, '0');
  const day = String(d.getDate()).padStart(2, '0');
  const hour = String(d.getHours()).padStart(2, '0');
  const minute = String(d.getMinutes()).padStart(2, '0');
  const second = String(d.getSeconds()).padStart(2, '0');
  
  return format
    .replace('YYYY', year.toString())
    .replace('MM', month)
    .replace('DD', day)
    .replace('HH', hour)
    .replace('mm', minute)
    .replace('ss', second);
}

/**
 * æ ¼å¼åŒ–å¢é•¿ç‡
 * @param current å½“å‰å€¼
 * @param previous ä¸ŠæœŸå€¼
 * @returns å¢é•¿ç‡å¯¹è±¡
 */
export function formatGrowthRate(current: number, previous: number) {
  if (!previous || previous === 0) {
    return {
      rate: 0,
      text: '-',
      type: 'neutral' as const
    };
  }
  
  const rate = ((current - previous) / previous) * 100;
  const type = rate > 0 ? 'increase' : rate < 0 ? 'decrease' : 'neutral';
  const text = rate > 0 ? `+${rate.toFixed(2)}%` : `${rate.toFixed(2)}%`;
  
  return { rate, text, type };
}
```

### éªŒè¯å·¥å…·
```typescript
// utils/validate.ts

/**
 * éªŒè¯æ‰‹æœºå·
 */
export function validatePhone(phone: string): boolean {
  const phoneRegex = /^1[3-9]\d{9}$/;
  return phoneRegex.test(phone);
}

/**
 * éªŒè¯é‚®ç®±
 */
export function validateEmail(email: string): boolean {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
}

/**
 * éªŒè¯æ—¥æœŸèŒƒå›´
 */
export function validateDateRange(startDate: string, endDate: string): {
  valid: boolean;
  message?: string;
} {
  if (!startDate || !endDate) {
    return { valid: false, message: 'è¯·é€‰æ‹©æ—¥æœŸèŒƒå›´' };
  }
  
  const start = new Date(startDate);
  const end = new Date(endDate);
  
  if (start > end) {
    return { valid: false, message: 'å¼€å§‹æ—¥æœŸä¸èƒ½å¤§äºç»“æŸæ—¥æœŸ' };
  }
  
  const diffDays = (end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24);
  if (diffDays > 365) {
    return { valid: false, message: 'æ—¥æœŸèŒƒå›´ä¸èƒ½è¶…è¿‡365å¤©' };
  }
  
  return { valid: true };
}

/**
 * è¡¨å•éªŒè¯è§„åˆ™
 */
export const validationRules = {
  required: (message = 'æ­¤å­—æ®µä¸ºå¿…å¡«é¡¹') => (value: any) => {
    if (value === null || value === undefined || value === '') {
      return message;
    }
    return true;
  },
  
  minLength: (min: number, message?: string) => (value: string) => {
    if (value && value.length < min) {
      return message || `æœ€å°‘è¾“å…¥${min}ä¸ªå­—ç¬¦`;
    }
    return true;
  },
  
  maxLength: (max: number, message?: string) => (value: string) => {
    if (value && value.length > max) {
      return message || `æœ€å¤šè¾“å…¥${max}ä¸ªå­—ç¬¦`;
    }
    return true;
  },
  
  phone: (message = 'è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·') => (value: string) => {
    if (value && !validatePhone(value)) {
      return message;
    }
    return true;
  },
  
  email: (message = 'è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±åœ°å€') => (value: string) => {
    if (value && !validateEmail(value)) {
      return message;
    }
    return true;
  }
};
```

## ğŸ›£ï¸ è·¯ç”±é…ç½®è§„èŒƒ

### è·¯ç”±ç»“æ„è®¾è®¡
```typescript
// router/index.ts
import { createRouter, createWebHistory } from 'vue-router';
import { useAuthStore } from '@/stores/auth';
import { showToast } from 'vant';
import type { RouteRecordRaw } from 'vue-router';

// è·¯ç”±é…ç½®
const routes: RouteRecordRaw[] = [
  {
    path: '/',
    redirect: '/home'
  },
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/pages/auth/LoginPage.vue'),
    meta: {
      title: 'ç™»å½•',
      requiresAuth: false,
      keepAlive: false
    }
  },
  {
    path: '/home',
    name: 'Home',
    component: () => import('@/pages/home/HomePage.vue'),
    meta: {
      title: 'é¦–é¡µ',
      requiresAuth: true,
      keepAlive: true,
      tabBar: true
    }
  },
  {
    path: '/performance',
    name: 'Performance',
    component: () => import('@/pages/performance/PerformanceLayout.vue'),
    meta: {
      title: 'ä¸šç»©åˆ†æ',
      requiresAuth: true,
      keepAlive: true,
      tabBar: true
    },
    children: [
      {
        path: 'employee',
        name: 'EmployeePerformance',
        component: () => import('@/pages/performance/EmployeePerformancePage.vue'),
        meta: {
          title: 'å‘˜å·¥ä¸šç»©',
          requiresAuth: true,
          keepAlive: true
        }
      },
      {
        path: 'employee/:id',
        name: 'EmployeeDetail',
        component: () => import('@/pages/performance/EmployeeDetailPage.vue'),
        meta: {
          title: 'å‘˜å·¥è¯¦æƒ…',
          requiresAuth: true,
          keepAlive: false
        }
      }
    ]
  }
];

const router = createRouter({
  history: createWebHistory(),
  routes
});

// è·¯ç”±å®ˆå«
router.beforeEach((to, from, next) => {
  const authStore = useAuthStore();

  // è®¾ç½®é¡µé¢æ ‡é¢˜
  document.title = to.meta.title as string || 'ç»è¥åˆ†æ';

  // æ£€æŸ¥ç™»å½•çŠ¶æ€
  if (to.meta.requiresAuth && !authStore.isLoggedIn) {
    next('/login');
    return;
  }

  // æ£€æŸ¥æƒé™
  if (to.meta.permission && !authStore.hasPermission(to.meta.permission as string)) {
    showToast('æƒé™ä¸è¶³');
    next(false);
    return;
  }

  next();
});

export default router;
```

## âš¡ æ€§èƒ½ä¼˜åŒ–è§„èŒƒ

### 1. ç»„ä»¶æ‡’åŠ è½½
```typescript
// è·¯ç”±æ‡’åŠ è½½
const routes = [
  {
    path: '/performance',
    component: () => import('@/pages/performance/PerformancePage.vue')
  }
];

// ç»„ä»¶æ‡’åŠ è½½
import { defineAsyncComponent } from 'vue';

const AsyncChart = defineAsyncComponent({
  loader: () => import('@/components/charts/PerformanceChart.vue'),
  loadingComponent: () => import('@/components/common/LoadingSpinner.vue'),
  errorComponent: () => import('@/components/common/ErrorMessage.vue'),
  delay: 200,
  timeout: 3000
});
```

### 2. è™šæ‹Ÿæ»šåŠ¨å®ç°
```vue
<!-- components/common/VirtualList.vue -->
<template>
  <div class="virtual-list" ref="containerRef" @scroll="handleScroll">
    <div class="virtual-list-phantom" :style="{ height: phantomHeight + 'px' }"></div>
    <div class="virtual-list-content" :style="{ transform: `translateY(${offsetY}px)` }">
      <div
        v-for="(item, index) in visibleData"
        :key="getItemKey(item, startIndex + index)"
        class="virtual-list-item"
        :style="{ height: itemHeight + 'px' }"
      >
        <slot :item="item" :index="startIndex + index"></slot>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, onUnmounted } from 'vue';

interface Props {
  data: any[];
  itemHeight: number;
  containerHeight?: number;
  getItemKey?: (item: any, index: number) => string | number;
}

const props = withDefaults(defineProps<Props>(), {
  containerHeight: 400,
  getItemKey: (item, index) => item.id || index
});

const containerRef = ref<HTMLElement>();
const scrollTop = ref(0);

// è®¡ç®—å¯è§åŒºåŸŸ
const visibleCount = computed(() =>
  Math.ceil(props.containerHeight / props.itemHeight) + 2
);

const startIndex = computed(() =>
  Math.floor(scrollTop.value / props.itemHeight)
);

const endIndex = computed(() =>
  Math.min(startIndex.value + visibleCount.value, props.data.length)
);

// å¯è§æ•°æ®
const visibleData = computed(() =>
  props.data.slice(startIndex.value, endIndex.value)
);

// åç§»é‡
const offsetY = computed(() => startIndex.value * props.itemHeight);

// è™šæ‹Ÿé«˜åº¦
const phantomHeight = computed(() => props.data.length * props.itemHeight);

// æ»šåŠ¨å¤„ç†
function handleScroll(e: Event) {
  scrollTop.value = (e.target as HTMLElement).scrollTop;
}

onMounted(() => {
  containerRef.value?.addEventListener('scroll', handleScroll, { passive: true });
});

onUnmounted(() => {
  containerRef.value?.removeEventListener('scroll', handleScroll);
});
</script>

<style lang="scss" scoped>
.virtual-list {
  position: relative;
  overflow-y: auto;

  .virtual-list-phantom {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    z-index: -1;
  }

  .virtual-list-content {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
  }

  .virtual-list-item {
    box-sizing: border-box;
  }
}
</style>
```

### 3. å›¾ç‰‡æ‡’åŠ è½½
```typescript
// composables/useLazyLoad.ts
import { ref, onMounted, onUnmounted } from 'vue';

export function useLazyLoad() {
  const observer = ref<IntersectionObserver | null>(null);

  function observeElement(element: HTMLElement, callback: () => void) {
    if (!observer.value) {
      observer.value = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              callback();
              observer.value?.unobserve(entry.target);
            }
          });
        },
        {
          rootMargin: '50px'
        }
      );
    }

    observer.value.observe(element);
  }

  onUnmounted(() => {
    observer.value?.disconnect();
  });

  return {
    observeElement
  };
}

// ä½¿ç”¨ç¤ºä¾‹
<template>
  <img
    ref="imgRef"
    :src="imageSrc || placeholderSrc"
    @load="handleImageLoad"
    alt="å‘˜å·¥å¤´åƒ"
  />
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { useLazyLoad } from '@/composables/useLazyLoad';

const props = defineProps<{
  src: string;
  placeholder?: string;
}>();

const imgRef = ref<HTMLImageElement>();
const imageSrc = ref('');
const placeholderSrc = ref(props.placeholder || '/images/placeholder.png');

const { observeElement } = useLazyLoad();

onMounted(() => {
  if (imgRef.value) {
    observeElement(imgRef.value, () => {
      imageSrc.value = props.src;
    });
  }
});
</script>
```

## ğŸ§ª æµ‹è¯•è§„èŒƒ

### å•å…ƒæµ‹è¯•
```typescript
// tests/components/EmployeePerformanceCard.test.ts
import { describe, it, expect, vi } from 'vitest';
import { mount } from '@vue/test-utils';
import { createPinia, setActivePinia } from 'pinia';
import EmployeePerformanceCard from '@/components/business/EmployeePerformanceCard.vue';
import type { EmployeePerformance } from '@/types/performance';

// Mockæ•°æ®
const mockEmployeeData: EmployeePerformance = {
  id: 1,
  employeeId: 1001,
  employeeName: 'å¼ ä¸‰',
  deptName: 'é”€å”®ä¸€éƒ¨',
  dataDate: '2024-01-31',
  salesAmount: 50000,
  orderCount: 25,
  profitRate: 25.5,
  orderAmount: 52000,
  visitCustomers: 20,
  purchaseCustomers: 15
};

describe('EmployeePerformanceCard', () => {
  beforeEach(() => {
    setActivePinia(createPinia());
  });

  it('should render employee data correctly', () => {
    const wrapper = mount(EmployeePerformanceCard, {
      props: {
        employeeData: mockEmployeeData
      }
    });

    expect(wrapper.find('.employee-name').text()).toBe('å¼ ä¸‰');
    expect(wrapper.find('.dept-name').text()).toBe('é”€å”®ä¸€éƒ¨');
    expect(wrapper.text()).toContain('Â¥50,000.00');
    expect(wrapper.text()).toContain('25.50%');
  });

  it('should emit viewDetail event when button clicked', async () => {
    const wrapper = mount(EmployeePerformanceCard, {
      props: {
        employeeData: mockEmployeeData,
        showActions: true
      }
    });

    await wrapper.find('[data-testid="view-detail-btn"]').trigger('click');

    expect(wrapper.emitted('viewDetail')).toBeTruthy();
    expect(wrapper.emitted('viewDetail')?.[0]).toEqual([mockEmployeeData]);
  });

  it('should format currency correctly', () => {
    const wrapper = mount(EmployeePerformanceCard, {
      props: {
        employeeData: mockEmployeeData
      }
    });

    const salesAmountElement = wrapper.find('[data-testid="sales-amount"]');
    expect(salesAmountElement.text()).toBe('Â¥50,000.00');
  });
});
```

### é›†æˆæµ‹è¯•
```typescript
// tests/integration/performance.test.ts
import { describe, it, expect, beforeEach, vi } from 'vitest';
import { mount } from '@vue/test-utils';
import { createRouter, createWebHistory } from 'vue-router';
import { createPinia } from 'pinia';
import EmployeePerformancePage from '@/pages/performance/EmployeePerformancePage.vue';
import { performanceApi } from '@/api/modules/performance';

// Mock API
vi.mock('@/api/modules/performance', () => ({
  performanceApi: {
    getEmployeePerformanceList: vi.fn()
  }
}));

describe('EmployeePerformancePage Integration', () => {
  let router: any;
  let pinia: any;

  beforeEach(() => {
    router = createRouter({
      history: createWebHistory(),
      routes: [
        { path: '/performance/employee', component: EmployeePerformancePage }
      ]
    });

    pinia = createPinia();

    // Mock APIå“åº”
    vi.mocked(performanceApi.getEmployeePerformanceList).mockResolvedValue({
      code: 200,
      message: 'æŸ¥è¯¢æˆåŠŸ',
      data: {
        total: 2,
        list: [mockEmployeeData],
        pageNum: 1,
        pageSize: 20,
        pages: 1
      }
    });
  });

  it('should load and display employee performance data', async () => {
    const wrapper = mount(EmployeePerformancePage, {
      global: {
        plugins: [router, pinia]
      }
    });

    // ç­‰å¾…æ•°æ®åŠ è½½
    await wrapper.vm.$nextTick();
    await new Promise(resolve => setTimeout(resolve, 100));

    // éªŒè¯APIè°ƒç”¨
    expect(performanceApi.getEmployeePerformanceList).toHaveBeenCalled();

    // éªŒè¯æ•°æ®æ¸²æŸ“
    expect(wrapper.find('[data-testid="performance-list"]').exists()).toBe(true);
    expect(wrapper.findAll('[data-testid="performance-item"]')).toHaveLength(1);
  });
});
```

## ğŸ“± ç§»åŠ¨ç«¯é€‚é…è§„èŒƒ

### å“åº”å¼è®¾è®¡
```scss
// styles/responsive.scss

// æ–­ç‚¹å®šä¹‰
$breakpoints: (
  xs: 0,
  sm: 576px,
  md: 768px,
  lg: 992px,
  xl: 1200px,
  xxl: 1400px
);

// åª’ä½“æŸ¥è¯¢æ··å…¥
@mixin respond-to($breakpoint) {
  @if map-has-key($breakpoints, $breakpoint) {
    @media (min-width: map-get($breakpoints, $breakpoint)) {
      @content;
    }
  }
}

// ç§»åŠ¨ç«¯ä¼˜å…ˆè®¾è®¡
.performance-card {
  padding: 12px;
  font-size: 14px;

  @include respond-to(sm) {
    padding: 16px;
    font-size: 15px;
  }

  @include respond-to(md) {
    padding: 20px;
    font-size: 16px;
  }

  @include respond-to(lg) {
    padding: 24px;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
}

// å®‰å…¨åŒºåŸŸé€‚é…
.safe-area-page {
  padding-top: constant(safe-area-inset-top);
  padding-top: env(safe-area-inset-top);
  padding-bottom: constant(safe-area-inset-bottom);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: constant(safe-area-inset-left);
  padding-left: env(safe-area-inset-left);
  padding-right: constant(safe-area-inset-right);
  padding-right: env(safe-area-inset-right);
}
```

### è§¦æ‘¸äº¤äº’ä¼˜åŒ–
```scss
// è§¦æ‘¸ç›®æ ‡å¤§å°
.touch-target {
  min-height: 44px; // iOSæ¨èæœ€å°è§¦æ‘¸ç›®æ ‡
  min-width: 44px;

  // Androidæ¨è48dp
  @media (max-width: 768px) {
    min-height: 48px;
    min-width: 48px;
  }
}

// è§¦æ‘¸åé¦ˆ
.interactive-element {
  transition: all 0.2s ease;
  cursor: pointer;

  &:active {
    transform: scale(0.98);
    opacity: 0.8;
  }

  // ç¦ç”¨é•¿æŒ‰é€‰æ‹©
  -webkit-user-select: none;
  user-select: none;

  // ç¦ç”¨ç‚¹å‡»é«˜äº®
  -webkit-tap-highlight-color: transparent;

  // ç¦ç”¨åŒå‡»ç¼©æ”¾
  touch-action: manipulation;
}

// æ»‘åŠ¨æ‰‹åŠ¿
.swipe-item {
  position: relative;
  overflow: hidden;

  .swipe-content {
    transition: transform 0.3s ease;
  }

  .swipe-actions {
    position: absolute;
    top: 0;
    right: 0;
    height: 100%;
    display: flex;
    align-items: center;
    background: var(--error-color);
    color: white;
    padding: 0 16px;
    transform: translateX(100%);
    transition: transform 0.3s ease;
  }

  &.swiped {
    .swipe-content {
      transform: translateX(-80px);
    }

    .swipe-actions {
      transform: translateX(0);
    }
  }
}
```

## ğŸ”’ å®‰å…¨å¼€å‘è§„èŒƒ

### XSSé˜²æŠ¤
```typescript
// utils/security.ts

/**
 * HTMLè½¬ä¹‰
 */
export function escapeHtml(text: string): string {
  const map: Record<string, string> = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  };

  return text.replace(/[&<>"']/g, (m) => map[m]);
}

/**
 * è¿‡æ»¤å±é™©æ ‡ç­¾
 */
export function sanitizeHtml(html: string): string {
  const dangerousTags = /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi;
  const dangerousAttrs = /on\w+\s*=/gi;

  return html
    .replace(dangerousTags, '')
    .replace(dangerousAttrs, 'data-removed=');
}

/**
 * éªŒè¯URLå®‰å…¨æ€§
 */
export function isValidUrl(url: string): boolean {
  try {
    const urlObj = new URL(url);
    return ['http:', 'https:'].includes(urlObj.protocol);
  } catch {
    return false;
  }
}

/**
 * CSPå†…å®¹å®‰å…¨ç­–ç•¥
 */
export function setupCSP() {
  const meta = document.createElement('meta');
  meta.httpEquiv = 'Content-Security-Policy';
  meta.content = [
    "default-src 'self'",
    "script-src 'self' 'unsafe-inline' 'unsafe-eval'",
    "style-src 'self' 'unsafe-inline'",
    "img-src 'self' data: https:",
    "font-src 'self' data:",
    "connect-src 'self' https://api.business-analysis.com",
    "frame-src 'none'",
    "object-src 'none'"
  ].join('; ');

  document.head.appendChild(meta);
}
```

### æ•°æ®éªŒè¯
```typescript
// composables/useValidation.ts
import { ref, computed, reactive } from 'vue';

interface ValidationRule {
  required?: boolean;
  minLength?: number;
  maxLength?: number;
  pattern?: RegExp;
  validator?: (value: any) => string | true;
  message?: string;
}

export function useValidation<T extends Record<string, any>>(
  initialData: T,
  rules: Record<keyof T, ValidationRule[]>
) {
  const formData = ref<T>({ ...initialData });
  const errors = reactive<Partial<Record<keyof T, string>>>({});
  const touched = reactive<Partial<Record<keyof T, boolean>>>({});

  const isValid = computed(() => {
    return Object.keys(errors).length === 0;
  });

  const hasErrors = computed(() => {
    return Object.keys(errors).some(key => touched[key as keyof T]);
  });

  function validateField(field: keyof T): boolean {
    const fieldRules = rules[field] || [];
    const value = formData.value[field];

    // æ ‡è®°å­—æ®µå·²è¢«è§¦æ‘¸
    touched[field] = true;

    for (const rule of fieldRules) {
      // å¿…å¡«éªŒè¯
      if (rule.required && (!value || value === '')) {
        errors[field] = rule.message || 'æ­¤å­—æ®µä¸ºå¿…å¡«é¡¹';
        return false;
      }

      // å¦‚æœå€¼ä¸ºç©ºä¸”éå¿…å¡«ï¼Œè·³è¿‡å…¶ä»–éªŒè¯
      if (!value && !rule.required) {
        delete errors[field];
        continue;
      }

      // æœ€å°é•¿åº¦éªŒè¯
      if (rule.minLength && value.length < rule.minLength) {
        errors[field] = rule.message || `æœ€å°‘è¾“å…¥${rule.minLength}ä¸ªå­—ç¬¦`;
        return false;
      }

      // æœ€å¤§é•¿åº¦éªŒè¯
      if (rule.maxLength && value.length > rule.maxLength) {
        errors[field] = rule.message || `æœ€å¤šè¾“å…¥${rule.maxLength}ä¸ªå­—ç¬¦`;
        return false;
      }

      // æ­£åˆ™éªŒè¯
      if (rule.pattern && !rule.pattern.test(value)) {
        errors[field] = rule.message || 'æ ¼å¼ä¸æ­£ç¡®';
        return false;
      }

      // è‡ªå®šä¹‰éªŒè¯
      if (rule.validator) {
        const result = rule.validator(value);
        if (result !== true) {
          errors[field] = result;
          return false;
        }
      }
    }

    // éªŒè¯é€šè¿‡ï¼Œæ¸…é™¤é”™è¯¯
    delete errors[field];
    return true;
  }

  function validateAll(): boolean {
    let valid = true;

    for (const field in rules) {
      if (!validateField(field)) {
        valid = false;
      }
    }

    return valid;
  }

  function resetValidation() {
    Object.keys(errors).forEach(key => {
      delete errors[key as keyof T];
    });
    Object.keys(touched).forEach(key => {
      touched[key as keyof T] = false;
    });
  }

  function resetForm() {
    formData.value = { ...initialData };
    resetValidation();
  }

  return {
    formData,
    errors,
    touched,
    isValid,
    hasErrors,
    validateField,
    validateAll,
    resetValidation,
    resetForm
  };
}
```

## ğŸ“Š å›¾è¡¨ç»„ä»¶è§„èŒƒ

### EChartså°è£…ç»„ä»¶
```vue
<!-- components/charts/PerformanceTrendChart.vue -->
<template>
  <div class="performance-trend-chart">
    <div class="chart-header">
      <h3 class="chart-title">{{ title }}</h3>
      <div class="chart-controls">
        <van-button
          v-for="period in timePeriods"
          :key="period.value"
          size="mini"
          :type="selectedPeriod === period.value ? 'primary' : 'default'"
          @click="handlePeriodChange(period.value)"
        >
          {{ period.label }}
        </van-button>
      </div>
    </div>

    <base-chart
      :option="chartOption"
      :height="chartHeight"
      @chart-click="handleChartClick"
    />

    <div class="chart-summary" v-if="showSummary">
      <div class="summary-item" v-for="item in summaryData" :key="item.key">
        <span class="summary-label">{{ item.label }}</span>
        <span class="summary-value" :class="item.className">{{ item.value }}</span>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch } from 'vue';
import type { EChartsOption } from 'echarts';
import BaseChart from '@/components/charts/BaseChart.vue';
import { formatCurrency, formatPercent } from '@/utils/format';

interface Props {
  title: string;
  data: Array<{
    date: string;
    value: number;
    compareValue?: number;
  }>;
  chartHeight?: string;
  showSummary?: boolean;
  metric?: 'amount' | 'count' | 'rate';
}

const props = withDefaults(defineProps<Props>(), {
  chartHeight: '300px',
  showSummary: true,
  metric: 'amount'
});

interface Emits {
  periodChange: [period: string];
  chartClick: [data: any];
}

const emit = defineEmits<Emits>();

// æ—¶é—´å‘¨æœŸé€‰é¡¹
const timePeriods = [
  { label: '7å¤©', value: '7d' },
  { label: '30å¤©', value: '30d' },
  { label: '90å¤©', value: '90d' }
];

const selectedPeriod = ref('30d');

// å›¾è¡¨é…ç½®
const chartOption = computed<EChartsOption>(() => {
  const xAxisData = props.data.map(item => item.date);
  const seriesData = props.data.map(item => item.value);
  const compareData = props.data.map(item => item.compareValue || 0);

  return {
    tooltip: {
      trigger: 'axis',
      formatter: (params: any) => {
        const data = params[0];
        const value = formatValue(data.value);
        return `${data.axisValue}<br/>${data.seriesName}: ${value}`;
      }
    },
    legend: {
      data: ['å½“æœŸ', 'ä¸ŠæœŸ']
    },
    xAxis: {
      type: 'category',
      data: xAxisData,
      axisLabel: {
        rotate: 45
      }
    },
    yAxis: {
      type: 'value',
      axisLabel: {
        formatter: (value: number) => formatValue(value)
      }
    },
    series: [
      {
        name: 'å½“æœŸ',
        type: 'line',
        data: seriesData,
        smooth: true,
        itemStyle: {
          color: '#1890ff'
        },
        areaStyle: {
          opacity: 0.3
        }
      },
      {
        name: 'ä¸ŠæœŸ',
        type: 'line',
        data: compareData,
        smooth: true,
        itemStyle: {
          color: '#52c41a'
        },
        lineStyle: {
          type: 'dashed'
        }
      }
    ]
  };
});

// æ±‡æ€»æ•°æ®
const summaryData = computed(() => {
  const total = props.data.reduce((sum, item) => sum + item.value, 0);
  const average = total / props.data.length;
  const max = Math.max(...props.data.map(item => item.value));
  const min = Math.min(...props.data.map(item => item.value));

  return [
    {
      key: 'total',
      label: 'æ€»è®¡',
      value: formatValue(total),
      className: 'text-primary'
    },
    {
      key: 'average',
      label: 'å¹³å‡',
      value: formatValue(average),
      className: 'text-info'
    },
    {
      key: 'max',
      label: 'æœ€é«˜',
      value: formatValue(max),
      className: 'text-success'
    },
    {
      key: 'min',
      label: 'æœ€ä½',
      value: formatValue(min),
      className: 'text-warning'
    }
  ];
});

// æ ¼å¼åŒ–æ•°å€¼
function formatValue(value: number): string {
  switch (props.metric) {
    case 'amount':
      return formatCurrency(value);
    case 'rate':
      return formatPercent(value);
    default:
      return value.toLocaleString();
  }
}

// æ—¶é—´å‘¨æœŸå˜åŒ–
function handlePeriodChange(period: string) {
  selectedPeriod.value = period;
  emit('periodChange', period);
}

// å›¾è¡¨ç‚¹å‡»
function handleChartClick(params: any) {
  emit('chartClick', params);
}
</script>

<style lang="scss" scoped>
.performance-trend-chart {
  background: white;
  border-radius: var(--border-radius-lg);
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-md);
  box-shadow: var(--shadow-sm);

  .chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-md);

    .chart-title {
      font-size: var(--font-size-lg);
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .chart-controls {
      display: flex;
      gap: var(--spacing-xs);
    }
  }

  .chart-summary {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--spacing-sm);
    margin-top: var(--spacing-md);
    padding-top: var(--spacing-md);
    border-top: 1px solid var(--border-color);

    @include respond-to(md) {
      grid-template-columns: repeat(4, 1fr);
    }

    .summary-item {
      text-align: center;

      .summary-label {
        display: block;
        font-size: var(--font-size-sm);
        color: var(--text-secondary);
        margin-bottom: var(--spacing-xs);
      }

      .summary-value {
        display: block;
        font-size: var(--font-size-md);
        font-weight: 600;

        &.text-primary { color: var(--primary-color); }
        &.text-success { color: var(--success-color); }
        &.text-warning { color: var(--warning-color); }
        &.text-info { color: var(--info-color); }
      }
    }
  }
}
</style>
```

## ğŸ”„ çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ

### Pinia Storeæ¨¡å—åŒ–
```typescript
// stores/modules/performance.ts
import { defineStore } from 'pinia';
import { ref, reactive, computed } from 'vue';
import { performanceApi } from '@/api/modules/performance';
import type { EmployeePerformance, PerformanceQuery } from '@/types/performance';

export const usePerformanceStore = defineStore('performance', () => {
  // çŠ¶æ€
  const performanceList = ref<EmployeePerformance[]>([]);
  const loading = ref(false);
  const currentVersion = ref<string>('');
  const lastUpdateTime = ref<string>('');

  // æŸ¥è¯¢æ¡ä»¶
  const queryParams = reactive<PerformanceQuery>({
    pageNum: 1,
    pageSize: 20,
    startDate: '',
    endDate: '',
    sortField: 'salesAmount',
    sortOrder: 'desc',
    filters: {}
  });

  // åˆ†é¡µä¿¡æ¯
  const pagination = reactive({
    total: 0,
    pageNum: 1,
    pageSize: 20,
    pages: 0,
    hasNext: false,
    hasPrev: false
  });

  // è®¡ç®—å±æ€§
  const totalSales = computed(() =>
    performanceList.value.reduce((sum, item) => sum + item.salesAmount, 0)
  );

  const averageSales = computed(() =>
    performanceList.value.length > 0 ? totalSales.value / performanceList.value.length : 0
  );

  const topPerformer = computed(() =>
    performanceList.value.reduce((top, current) =>
      current.salesAmount > top.salesAmount ? current : top,
      performanceList.value[0]
    )
  );

  // æ–¹æ³•
  async function fetchPerformanceList(params?: Partial<PerformanceQuery>) {
    loading.value = true;
    try {
      if (params) {
        Object.assign(queryParams, params);
      }

      const response = await performanceApi.getEmployeePerformanceList(queryParams);

      if (queryParams.pageNum === 1) {
        performanceList.value = response.data.list;
      } else {
        performanceList.value.push(...response.data.list);
      }

      Object.assign(pagination, {
        total: response.data.total,
        pageNum: response.data.pageNum,
        pageSize: response.data.pageSize,
        pages: response.data.pages,
        hasNext: response.data.hasNext,
        hasPrev: response.data.hasPrev
      });

      lastUpdateTime.value = new Date().toISOString();

      return response;
    } catch (error) {
      throw error;
    } finally {
      loading.value = false;
    }
  }

  async function refreshData() {
    queryParams.pageNum = 1;
    return fetchPerformanceList();
  }

  function resetQuery() {
    Object.assign(queryParams, {
      pageNum: 1,
      pageSize: 20,
      startDate: '',
      endDate: '',
      sortField: 'salesAmount',
      sortOrder: 'desc',
      filters: {}
    });
    performanceList.value = [];
    Object.assign(pagination, {
      total: 0,
      pageNum: 1,
      pageSize: 20,
      pages: 0,
      hasNext: false,
      hasPrev: false
    });
  }

  function updateEmployee(employeeId: number, updates: Partial<EmployeePerformance>) {
    const index = performanceList.value.findIndex(item => item.employeeId === employeeId);
    if (index !== -1) {
      Object.assign(performanceList.value[index], updates);
    }
  }

  return {
    // çŠ¶æ€
    performanceList,
    loading,
    currentVersion,
    lastUpdateTime,
    queryParams,
    pagination,
    // è®¡ç®—å±æ€§
    totalSales,
    averageSales,
    topPerformer,
    // æ–¹æ³•
    fetchPerformanceList,
    refreshData,
    resetQuery,
    updateEmployee
  };
});
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2024å¹´8æœˆ
**ç»´æŠ¤å›¢é˜Ÿ**: å‰ç«¯å¼€å‘ç»„

> æœ¬æ–‡æ¡£è§„èŒƒäº†ç§»åŠ¨ç«¯APPçš„å®Œæ•´å¼€å‘æ ‡å‡†ï¼ŒåŒ…æ‹¬æŠ€æœ¯æ¶æ„ã€ç»„ä»¶è®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨è§„èŒƒç­‰ã€‚æ‰€æœ‰å‰ç«¯å¼€å‘äººå‘˜å¿…é¡»ä¸¥æ ¼éµå¾ªæ­¤è§„èŒƒï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œç”¨æˆ·ä½“éªŒã€‚

## ğŸ›£ï¸ è·¯ç”±é…ç½®è§„èŒƒ

### è·¯ç”±ç»“æ„è®¾è®¡
```typescript
// router/index.ts
import { createRouter, createWebHistory } from 'vue-router';
import { useAuthStore } from '@/stores/auth';
import type { RouteRecordRaw } from 'vue-router';

// è·¯ç”±é…ç½®
const routes: RouteRecordRaw[] = [
  {
    path: '/',
    redirect: '/home'
  },
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/pages/auth/LoginPage.vue'),
    meta: {
      title: 'ç™»å½•',
      requiresAuth: false,
      keepAlive: false
    }
  },
  {
    path: '/home',
    name: 'Home',
    component: () => import('@/pages/home/HomePage.vue'),
    meta: {
      title: 'é¦–é¡µ',
      requiresAuth: true,
      keepAlive: true,
      tabBar: true
    }
  },
  {
    path: '/performance',
    name: 'Performance',
    component: () => import('@/pages/performance/PerformanceLayout.vue'),
    meta: {
      title: 'ä¸šç»©åˆ†æ',
      requiresAuth: true,
      keepAlive: true,
      tabBar: true
    },
    children: [
      {
        path: 'employee',
        name: 'EmployeePerformance',
        component: () => import('@/pages/performance/EmployeePerformancePage.vue'),
        meta: {
          title: 'å‘˜å·¥ä¸šç»©',
          requiresAuth: true,
          keepAlive: true
        }
      }
    ]
  }
];

const router = createRouter({
  history: createWebHistory(),
  routes
});

// è·¯ç”±å®ˆå«
router.beforeEach((to, from, next) => {
  const authStore = useAuthStore();

  // è®¾ç½®é¡µé¢æ ‡é¢˜
  document.title = to.meta.title as string || 'ç»è¥åˆ†æ';

  // æ£€æŸ¥ç™»å½•çŠ¶æ€
  if (to.meta.requiresAuth && !authStore.isLoggedIn) {
    next('/login');
    return;
  }

  next();
});

export default router;
```

## âš¡ æ€§èƒ½ä¼˜åŒ–è§„èŒƒ

### 1. ç»„ä»¶æ‡’åŠ è½½
```typescript
// è·¯ç”±æ‡’åŠ è½½
const routes = [
  {
    path: '/performance',
    component: () => import('@/pages/performance/PerformancePage.vue')
  }
];

// ç»„ä»¶æ‡’åŠ è½½
import { defineAsyncComponent } from 'vue';

const AsyncChart = defineAsyncComponent({
  loader: () => import('@/components/charts/PerformanceChart.vue'),
  loadingComponent: () => import('@/components/common/LoadingSpinner.vue'),
  errorComponent: () => import('@/components/common/ErrorMessage.vue'),
  delay: 200,
  timeout: 3000
});
```

### 2. ç¼“å­˜ç­–ç•¥
```typescript
// composables/useCache.ts
import { ref, computed } from 'vue';

interface CacheOptions {
  ttl?: number; // ç¼“å­˜æ—¶é—´(ç§’)
  key: string;  // ç¼“å­˜é”®
}

export function useCache<T>(options: CacheOptions) {
  const { ttl = 300, key } = options;

  const cacheData = ref<T | null>(null);
  const cacheTime = ref<number>(0);

  const isExpired = computed(() => {
    if (!cacheTime.value) return true;
    return Date.now() - cacheTime.value > ttl * 1000;
  });

  function setCache(data: T) {
    cacheData.value = data;
    cacheTime.value = Date.now();

    // å­˜å‚¨åˆ°localStorage
    localStorage.setItem(key, JSON.stringify({
      data,
      timestamp: cacheTime.value
    }));
  }

  function getCache(): T | null {
    if (cacheData.value && !isExpired.value) {
      return cacheData.value;
    }

    // ä»localStorageè¯»å–
    const cached = localStorage.getItem(key);
    if (cached) {
      const { data, timestamp } = JSON.parse(cached);
      if (Date.now() - timestamp < ttl * 1000) {
        cacheData.value = data;
        cacheTime.value = timestamp;
        return data;
      }
    }

    return null;
  }

  return {
    cacheData,
    isExpired,
    setCache,
    getCache
  };
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2024å¹´8æœˆ
**ç»´æŠ¤å›¢é˜Ÿ**: å‰ç«¯å¼€å‘ç»„
