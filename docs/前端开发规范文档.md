# 前端开发规范文档

## 📱 移动端技术架构

### 技术栈选型
- **框架**: Vue 3.3+ (Composition API)
- **语言**: TypeScript 5.0+
- **UI组件**: Vant 4.6+ (移动端UI库)
- **状态管理**: Pinia 2.1+
- **路由**: Vue Router 4.2+
- **HTTP客户端**: Axios 1.4+
- **构建工具**: Vite 4.0+
- **代码规范**: ESLint + Prettier
- **测试框架**: Vitest + Vue Test Utils

### 项目目录结构
```
src/
├── api/                    # API接口定义
│   ├── modules/           # 按模块分组的接口
│   │   ├── auth.ts       # 认证相关接口
│   │   ├── performance.ts # 业绩相关接口
│   │   └── analysis.ts   # 分析相关接口
│   ├── types/            # 接口类型定义
│   └── request.ts        # 请求封装
├── assets/               # 静态资源
│   ├── images/          # 图片资源
│   ├── icons/           # 图标资源
│   └── styles/          # 全局样式
├── components/           # 公共组件
│   ├── common/          # 通用组件
│   ├── charts/          # 图表组件
│   └── business/        # 业务组件
├── composables/          # 组合式函数
│   ├── useAuth.ts       # 认证相关
│   ├── useRequest.ts    # 请求相关
│   └── useChart.ts      # 图表相关
├── pages/               # 页面组件
│   ├── home/           # 首页
│   ├── performance/    # 业绩模块
│   ├── analysis/       # 分析模块
│   └── profile/        # 个人中心
├── router/              # 路由配置
├── stores/              # 状态管理
│   ├── auth.ts         # 认证状态
│   ├── performance.ts  # 业绩数据状态
│   └── app.ts          # 应用全局状态
├── utils/               # 工具函数
│   ├── format.ts       # 格式化工具
│   ├── validate.ts     # 验证工具
│   └── storage.ts      # 存储工具
├── types/               # 类型定义
│   ├── api.ts          # API类型
│   ├── business.ts     # 业务类型
│   └── common.ts       # 通用类型
├── App.vue             # 根组件
└── main.ts             # 入口文件
```

## 🎨 UI/UX设计规范

### 设计系统
```scss
// 设计令牌 (Design Tokens)
:root {
  // 主色调
  --primary-color: #1890ff;
  --primary-light: #40a9ff;
  --primary-dark: #096dd9;
  
  // 辅助色
  --success-color: #52c41a;
  --warning-color: #faad14;
  --error-color: #f5222d;
  --info-color: #1890ff;
  
  // 中性色
  --text-primary: #262626;
  --text-secondary: #595959;
  --text-disabled: #bfbfbf;
  --border-color: #d9d9d9;
  --background-color: #f5f5f5;
  
  // 间距
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 16px;
  --spacing-lg: 24px;
  --spacing-xl: 32px;
  
  // 字体
  --font-size-xs: 10px;
  --font-size-sm: 12px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-xxl: 20px;
  
  // 圆角
  --border-radius-sm: 2px;
  --border-radius-md: 4px;
  --border-radius-lg: 8px;
  
  // 阴影
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12);
  --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.12);
  --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.12);
}
```

### 组件设计原则
1. **原子化设计**: 按照原子、分子、组织、模板、页面的层次设计
2. **响应式设计**: 适配不同屏幕尺寸和方向
3. **无障碍设计**: 支持屏幕阅读器和键盘导航
4. **性能优化**: 组件懒加载、虚拟滚动
5. **主题定制**: 支持主题切换和个性化定制

### 移动端适配方案
```typescript
// rem适配方案
function setRem() {
  const baseSize = 37.5; // 基准大小
  const scale = document.documentElement.clientWidth / 375; // 设计稿宽度375px
  document.documentElement.style.fontSize = baseSize * Math.min(scale, 2) + 'px';
}

// viewport适配
const viewport = document.querySelector('meta[name=viewport]');
viewport?.setAttribute('content', 
  'width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no');

// 安全区域适配 (iPhone X等)
.safe-area-inset {
  padding-top: constant(safe-area-inset-top);
  padding-top: env(safe-area-inset-top);
  padding-bottom: constant(safe-area-inset-bottom);
  padding-bottom: env(safe-area-inset-bottom);
}
```

## 🔧 开发工具配置

### Vite配置
```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import { resolve } from 'path';

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      '@/api': resolve(__dirname, 'src/api'),
      '@/components': resolve(__dirname, 'src/components'),
      '@/utils': resolve(__dirname, 'src/utils'),
      '@/types': resolve(__dirname, 'src/types')
    }
  },
  css: {
    preprocessorOptions: {
      scss: {
        additionalData: '@import "@/assets/styles/variables.scss";'
      }
    }
  },
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '/api')
      }
    }
  },
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['vue', 'vue-router', 'pinia'],
          ui: ['vant'],
          charts: ['echarts']
        }
      }
    }
  }
});
```

### ESLint配置
```javascript
// .eslintrc.js
module.exports = {
  env: {
    browser: true,
    es2021: true,
    node: true
  },
  extends: [
    'eslint:recommended',
    '@vue/eslint-config-typescript',
    '@vue/eslint-config-prettier'
  ],
  parserOptions: {
    ecmaVersion: 'latest',
    sourceType: 'module'
  },
  rules: {
    // Vue相关规则
    'vue/multi-word-component-names': 'off',
    'vue/no-unused-vars': 'error',
    'vue/no-mutating-props': 'error',
    
    // TypeScript相关规则
    '@typescript-eslint/no-unused-vars': 'error',
    '@typescript-eslint/explicit-function-return-type': 'warn',
    '@typescript-eslint/no-explicit-any': 'warn',
    
    // 通用规则
    'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'no-debugger': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'prefer-const': 'error',
    'no-var': 'error'
  }
};
```

## 📦 状态管理规范

### Pinia Store设计
```typescript
// stores/auth.ts
import { defineStore } from 'pinia';
import { ref, computed } from 'vue';
import type { User, LoginRequest } from '@/types/auth';

export const useAuthStore = defineStore('auth', () => {
  // 状态
  const token = ref<string>('');
  const user = ref<User | null>(null);
  const permissions = ref<string[]>([]);
  
  // 计算属性
  const isLoggedIn = computed(() => !!token.value);
  const hasPermission = computed(() => (permission: string) => {
    return permissions.value.includes(permission) || permissions.value.includes('*:*:*');
  });
  
  // 方法
  async function login(loginData: LoginRequest) {
    try {
      const response = await authApi.login(loginData);
      token.value = response.data.token;
      user.value = response.data.user;
      permissions.value = response.data.user.permissions;
      
      // 存储到本地
      localStorage.setItem('token', token.value);
      localStorage.setItem('user', JSON.stringify(user.value));
      
      return response;
    } catch (error) {
      throw error;
    }
  }
  
  function logout() {
    token.value = '';
    user.value = null;
    permissions.value = [];
    localStorage.removeItem('token');
    localStorage.removeItem('user');
  }
  
  function initAuth() {
    const savedToken = localStorage.getItem('token');
    const savedUser = localStorage.getItem('user');
    
    if (savedToken && savedUser) {
      token.value = savedToken;
      user.value = JSON.parse(savedUser);
      permissions.value = user.value?.permissions || [];
    }
  }
  
  return {
    // 状态
    token,
    user,
    permissions,
    // 计算属性
    isLoggedIn,
    hasPermission,
    // 方法
    login,
    logout,
    initAuth
  };
});
```

### 业务数据Store
```typescript
// stores/performance.ts
import { defineStore } from 'pinia';
import { ref, reactive } from 'vue';
import type { EmployeePerformance, PerformanceQuery } from '@/types/performance';

export const usePerformanceStore = defineStore('performance', () => {
  // 状态
  const performanceList = ref<EmployeePerformance[]>([]);
  const loading = ref(false);
  const currentVersion = ref<string>('');
  
  // 查询条件
  const queryParams = reactive<PerformanceQuery>({
    pageNum: 1,
    pageSize: 20,
    startDate: '',
    endDate: '',
    sortField: 'salesAmount',
    sortOrder: 'desc'
  });
  
  // 分页信息
  const pagination = reactive({
    total: 0,
    pageNum: 1,
    pageSize: 20,
    pages: 0
  });
  
  // 方法
  async function fetchPerformanceList(params?: Partial<PerformanceQuery>) {
    loading.value = true;
    try {
      Object.assign(queryParams, params);
      const response = await performanceApi.getEmployeePerformanceList(queryParams);
      
      performanceList.value = response.data.list;
      Object.assign(pagination, {
        total: response.data.total,
        pageNum: response.data.pageNum,
        pageSize: response.data.pageSize,
        pages: response.data.pages
      });
      
      return response;
    } catch (error) {
      throw error;
    } finally {
      loading.value = false;
    }
  }
  
  function resetQuery() {
    Object.assign(queryParams, {
      pageNum: 1,
      pageSize: 20,
      startDate: '',
      endDate: '',
      employeeIds: [],
      deptIds: [],
      sortField: 'salesAmount',
      sortOrder: 'desc'
    });
  }
  
  return {
    // 状态
    performanceList,
    loading,
    currentVersion,
    queryParams,
    pagination,
    // 方法
    fetchPerformanceList,
    resetQuery
  };
});
```

## 🎯 组件开发规范

### 组件命名规范
```typescript
// 组件文件命名：PascalCase
// 文件名: EmployeePerformanceCard.vue
// 组件名: EmployeePerformanceCard

// 组件注册名：kebab-case
<employee-performance-card />

// Props命名：camelCase
interface Props {
  employeeData: EmployeePerformance;
  showDetails?: boolean;
  onItemClick?: (item: EmployeePerformance) => void;
}
```

### 组件结构模板
```vue
<template>
  <div class="employee-performance-card">
    <!-- 组件内容 -->
    <div class="card-header">
      <h3 class="employee-name">{{ employeeData.employeeName }}</h3>
      <span class="dept-name">{{ employeeData.deptName }}</span>
    </div>
    
    <div class="card-content">
      <div class="metric-item" v-for="metric in displayMetrics" :key="metric.key">
        <span class="metric-label">{{ metric.label }}</span>
        <span class="metric-value" :class="metric.className">
          {{ formatValue(metric.value, metric.type) }}
        </span>
      </div>
    </div>
    
    <div class="card-actions" v-if="showActions">
      <van-button size="small" @click="handleViewDetail">查看详情</van-button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import type { EmployeePerformance } from '@/types/performance';
import { formatCurrency, formatPercent } from '@/utils/format';

// Props定义
interface Props {
  employeeData: EmployeePerformance;
  showActions?: boolean;
}

const props = withDefaults(defineProps<Props>(), {
  showActions: true
});

// Emits定义
interface Emits {
  viewDetail: [employee: EmployeePerformance];
  itemClick: [employee: EmployeePerformance];
}

const emit = defineEmits<Emits>();

// 计算属性
const displayMetrics = computed(() => [
  {
    key: 'salesAmount',
    label: '销售金额',
    value: props.employeeData.salesAmount,
    type: 'currency',
    className: 'text-primary'
  },
  {
    key: 'orderCount',
    label: '订单数量',
    value: props.employeeData.orderCount,
    type: 'number',
    className: 'text-info'
  },
  {
    key: 'profitRate',
    label: '毛利率',
    value: props.employeeData.profitRate,
    type: 'percent',
    className: props.employeeData.profitRate >= 25 ? 'text-success' : 'text-warning'
  }
]);

// 方法
function formatValue(value: number, type: string): string {
  switch (type) {
    case 'currency':
      return formatCurrency(value);
    case 'percent':
      return formatPercent(value);
    default:
      return value.toString();
  }
}

function handleViewDetail() {
  emit('viewDetail', props.employeeData);
}
</script>

<style lang="scss" scoped>
.employee-performance-card {
  background: white;
  border-radius: var(--border-radius-lg);
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-sm);
  box-shadow: var(--shadow-sm);
  
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-sm);
    
    .employee-name {
      font-size: var(--font-size-lg);
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }
    
    .dept-name {
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
    }
  }
  
  .card-content {
    .metric-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-xs) 0;
      
      .metric-label {
        font-size: var(--font-size-sm);
        color: var(--text-secondary);
      }
      
      .metric-value {
        font-size: var(--font-size-md);
        font-weight: 500;
        
        &.text-primary { color: var(--primary-color); }
        &.text-success { color: var(--success-color); }
        &.text-warning { color: var(--warning-color); }
        &.text-info { color: var(--info-color); }
      }
    }
  }
  
  .card-actions {
    margin-top: var(--spacing-md);
    text-align: right;
  }
}
</style>
```

## 🔌 API调用规范

### HTTP请求封装
```typescript
// api/request.ts
import axios, { type AxiosInstance, type AxiosRequestConfig, type AxiosResponse } from 'axios';
import { showToast } from 'vant';
import { useAuthStore } from '@/stores/auth';
import router from '@/router';

// 创建axios实例
const request: AxiosInstance = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
});

// 请求拦截器
request.interceptors.request.use(
  (config) => {
    const authStore = useAuthStore();
    
    // 添加认证token
    if (authStore.token) {
      config.headers.Authorization = `Bearer ${authStore.token}`;
    }
    
    // 添加请求ID
    config.headers['X-Request-ID'] = generateRequestId();
    
    // 添加客户端信息
    config.headers['X-Client-Version'] = import.meta.env.VITE_APP_VERSION;
    config.headers['X-Platform'] = 'mobile';
    
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// 响应拦截器
request.interceptors.response.use(
  (response: AxiosResponse) => {
    const { code, message, data } = response.data;
    
    if (code === 200) {
      return response.data;
    } else {
      // 业务错误处理
      showToast(message || '请求失败');
      return Promise.reject(new Error(message));
    }
  },
  (error) => {
    // HTTP错误处理
    if (error.response) {
      const { status, data } = error.response;
      
      switch (status) {
        case 401:
          // Token过期，跳转登录
          const authStore = useAuthStore();
          authStore.logout();
          router.push('/login');
          showToast('登录已过期，请重新登录');
          break;
        case 403:
          showToast('权限不足');
          break;
        case 404:
          showToast('请求的资源不存在');
          break;
        case 500:
          showToast('服务器内部错误');
          break;
        default:
          showToast(data?.message || '网络错误');
      }
    } else {
      showToast('网络连接失败');
    }
    
    return Promise.reject(error);
  }
);

export default request;
```

### API模块定义
```typescript
// api/modules/performance.ts
import request from '@/api/request';
import type { 
  EmployeePerformanceQuery, 
  EmployeePerformanceResponse,
  EmployeeDetailResponse 
} from '@/types/performance';

export const performanceApi = {
  // 获取员工业绩列表
  getEmployeePerformanceList(params: EmployeePerformanceQuery) {
    return request.get<PageResponse<EmployeePerformanceResponse>>('/performance/employee/list', {
      params
    });
  },
  
  // 获取员工业绩详情
  getEmployeePerformanceDetail(employeeId: number, params: {
    startDate: string;
    endDate: string;
    versionId?: string;
  }) {
    return request.get<EmployeeDetailResponse>(`/performance/employee/${employeeId}`, {
      params
    });
  },
  
  // 导出员工业绩数据
  exportEmployeePerformance(params: {
    startDate: string;
    endDate: string;
    employeeIds?: number[];
    format: 'excel' | 'csv';
  }) {
    return request.post<{ downloadUrl: string }>('/export/employee-performance', params);
  }
};
```

## 📊 图表组件规范

### ECharts封装
```vue
<!-- components/charts/BaseChart.vue -->
<template>
  <div ref="chartRef" :style="{ width, height }" class="base-chart"></div>
</template>

<script setup lang="ts">
import { ref, onMounted, onUnmounted, watch, nextTick } from 'vue';
import * as echarts from 'echarts/core';
import type { EChartsOption } from 'echarts';

interface Props {
  option: EChartsOption;
  width?: string;
  height?: string;
  theme?: string;
}

const props = withDefaults(defineProps<Props>(), {
  width: '100%',
  height: '300px',
  theme: 'default'
});

const chartRef = ref<HTMLDivElement>();
let chartInstance: echarts.ECharts | null = null;

// 初始化图表
function initChart() {
  if (!chartRef.value) return;
  
  chartInstance = echarts.init(chartRef.value, props.theme);
  chartInstance.setOption(props.option);
  
  // 响应式调整
  window.addEventListener('resize', handleResize);
}

// 更新图表
function updateChart() {
  if (chartInstance) {
    chartInstance.setOption(props.option, true);
  }
}

// 调整大小
function handleResize() {
  if (chartInstance) {
    chartInstance.resize();
  }
}

// 监听配置变化
watch(() => props.option, updateChart, { deep: true });

onMounted(() => {
  nextTick(initChart);
});

onUnmounted(() => {
  if (chartInstance) {
    chartInstance.dispose();
    window.removeEventListener('resize', handleResize);
  }
});
</script>

<style lang="scss" scoped>
.base-chart {
  min-height: 200px;
}
</style>
```

## 🔍 工具函数规范

### 格式化工具
```typescript
// utils/format.ts

/**
 * 格式化货币
 * @param value 数值
 * @param currency 货币符号
 * @returns 格式化后的货币字符串
 */
export function formatCurrency(value: number, currency = '¥'): string {
  if (value === null || value === undefined) return '-';
  
  return `${currency}${value.toLocaleString('zh-CN', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  })}`;
}

/**
 * 格式化百分比
 * @param value 数值
 * @param decimals 小数位数
 * @returns 格式化后的百分比字符串
 */
export function formatPercent(value: number, decimals = 2): string {
  if (value === null || value === undefined) return '-';
  
  return `${value.toFixed(decimals)}%`;
}

/**
 * 格式化数字
 * @param value 数值
 * @param decimals 小数位数
 * @returns 格式化后的数字字符串
 */
export function formatNumber(value: number, decimals = 0): string {
  if (value === null || value === undefined) return '-';
  
  return value.toLocaleString('zh-CN', {
    minimumFractionDigits: decimals,
    maximumFractionDigits: decimals
  });
}

/**
 * 格式化日期
 * @param date 日期
 * @param format 格式
 * @returns 格式化后的日期字符串
 */
export function formatDate(date: string | Date, format = 'YYYY-MM-DD'): string {
  if (!date) return '-';
  
  const d = new Date(date);
  const year = d.getFullYear();
  const month = String(d.getMonth() + 1).padStart(2, '0');
  const day = String(d.getDate()).padStart(2, '0');
  const hour = String(d.getHours()).padStart(2, '0');
  const minute = String(d.getMinutes()).padStart(2, '0');
  const second = String(d.getSeconds()).padStart(2, '0');
  
  return format
    .replace('YYYY', year.toString())
    .replace('MM', month)
    .replace('DD', day)
    .replace('HH', hour)
    .replace('mm', minute)
    .replace('ss', second);
}

/**
 * 格式化增长率
 * @param current 当前值
 * @param previous 上期值
 * @returns 增长率对象
 */
export function formatGrowthRate(current: number, previous: number) {
  if (!previous || previous === 0) {
    return {
      rate: 0,
      text: '-',
      type: 'neutral' as const
    };
  }
  
  const rate = ((current - previous) / previous) * 100;
  const type = rate > 0 ? 'increase' : rate < 0 ? 'decrease' : 'neutral';
  const text = rate > 0 ? `+${rate.toFixed(2)}%` : `${rate.toFixed(2)}%`;
  
  return { rate, text, type };
}
```

### 验证工具
```typescript
// utils/validate.ts

/**
 * 验证手机号
 */
export function validatePhone(phone: string): boolean {
  const phoneRegex = /^1[3-9]\d{9}$/;
  return phoneRegex.test(phone);
}

/**
 * 验证邮箱
 */
export function validateEmail(email: string): boolean {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
}

/**
 * 验证日期范围
 */
export function validateDateRange(startDate: string, endDate: string): {
  valid: boolean;
  message?: string;
} {
  if (!startDate || !endDate) {
    return { valid: false, message: '请选择日期范围' };
  }
  
  const start = new Date(startDate);
  const end = new Date(endDate);
  
  if (start > end) {
    return { valid: false, message: '开始日期不能大于结束日期' };
  }
  
  const diffDays = (end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24);
  if (diffDays > 365) {
    return { valid: false, message: '日期范围不能超过365天' };
  }
  
  return { valid: true };
}

/**
 * 表单验证规则
 */
export const validationRules = {
  required: (message = '此字段为必填项') => (value: any) => {
    if (value === null || value === undefined || value === '') {
      return message;
    }
    return true;
  },
  
  minLength: (min: number, message?: string) => (value: string) => {
    if (value && value.length < min) {
      return message || `最少输入${min}个字符`;
    }
    return true;
  },
  
  maxLength: (max: number, message?: string) => (value: string) => {
    if (value && value.length > max) {
      return message || `最多输入${max}个字符`;
    }
    return true;
  },
  
  phone: (message = '请输入正确的手机号') => (value: string) => {
    if (value && !validatePhone(value)) {
      return message;
    }
    return true;
  },
  
  email: (message = '请输入正确的邮箱地址') => (value: string) => {
    if (value && !validateEmail(value)) {
      return message;
    }
    return true;
  }
};
```

## 🛣️ 路由配置规范

### 路由结构设计
```typescript
// router/index.ts
import { createRouter, createWebHistory } from 'vue-router';
import { useAuthStore } from '@/stores/auth';
import { showToast } from 'vant';
import type { RouteRecordRaw } from 'vue-router';

// 路由配置
const routes: RouteRecordRaw[] = [
  {
    path: '/',
    redirect: '/home'
  },
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/pages/auth/LoginPage.vue'),
    meta: {
      title: '登录',
      requiresAuth: false,
      keepAlive: false
    }
  },
  {
    path: '/home',
    name: 'Home',
    component: () => import('@/pages/home/HomePage.vue'),
    meta: {
      title: '首页',
      requiresAuth: true,
      keepAlive: true,
      tabBar: true
    }
  },
  {
    path: '/performance',
    name: 'Performance',
    component: () => import('@/pages/performance/PerformanceLayout.vue'),
    meta: {
      title: '业绩分析',
      requiresAuth: true,
      keepAlive: true,
      tabBar: true
    },
    children: [
      {
        path: 'employee',
        name: 'EmployeePerformance',
        component: () => import('@/pages/performance/EmployeePerformancePage.vue'),
        meta: {
          title: '员工业绩',
          requiresAuth: true,
          keepAlive: true
        }
      },
      {
        path: 'employee/:id',
        name: 'EmployeeDetail',
        component: () => import('@/pages/performance/EmployeeDetailPage.vue'),
        meta: {
          title: '员工详情',
          requiresAuth: true,
          keepAlive: false
        }
      }
    ]
  }
];

const router = createRouter({
  history: createWebHistory(),
  routes
});

// 路由守卫
router.beforeEach((to, from, next) => {
  const authStore = useAuthStore();

  // 设置页面标题
  document.title = to.meta.title as string || '经营分析';

  // 检查登录状态
  if (to.meta.requiresAuth && !authStore.isLoggedIn) {
    next('/login');
    return;
  }

  // 检查权限
  if (to.meta.permission && !authStore.hasPermission(to.meta.permission as string)) {
    showToast('权限不足');
    next(false);
    return;
  }

  next();
});

export default router;
```

## ⚡ 性能优化规范

### 1. 组件懒加载
```typescript
// 路由懒加载
const routes = [
  {
    path: '/performance',
    component: () => import('@/pages/performance/PerformancePage.vue')
  }
];

// 组件懒加载
import { defineAsyncComponent } from 'vue';

const AsyncChart = defineAsyncComponent({
  loader: () => import('@/components/charts/PerformanceChart.vue'),
  loadingComponent: () => import('@/components/common/LoadingSpinner.vue'),
  errorComponent: () => import('@/components/common/ErrorMessage.vue'),
  delay: 200,
  timeout: 3000
});
```

### 2. 虚拟滚动实现
```vue
<!-- components/common/VirtualList.vue -->
<template>
  <div class="virtual-list" ref="containerRef" @scroll="handleScroll">
    <div class="virtual-list-phantom" :style="{ height: phantomHeight + 'px' }"></div>
    <div class="virtual-list-content" :style="{ transform: `translateY(${offsetY}px)` }">
      <div
        v-for="(item, index) in visibleData"
        :key="getItemKey(item, startIndex + index)"
        class="virtual-list-item"
        :style="{ height: itemHeight + 'px' }"
      >
        <slot :item="item" :index="startIndex + index"></slot>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, onUnmounted } from 'vue';

interface Props {
  data: any[];
  itemHeight: number;
  containerHeight?: number;
  getItemKey?: (item: any, index: number) => string | number;
}

const props = withDefaults(defineProps<Props>(), {
  containerHeight: 400,
  getItemKey: (item, index) => item.id || index
});

const containerRef = ref<HTMLElement>();
const scrollTop = ref(0);

// 计算可见区域
const visibleCount = computed(() =>
  Math.ceil(props.containerHeight / props.itemHeight) + 2
);

const startIndex = computed(() =>
  Math.floor(scrollTop.value / props.itemHeight)
);

const endIndex = computed(() =>
  Math.min(startIndex.value + visibleCount.value, props.data.length)
);

// 可见数据
const visibleData = computed(() =>
  props.data.slice(startIndex.value, endIndex.value)
);

// 偏移量
const offsetY = computed(() => startIndex.value * props.itemHeight);

// 虚拟高度
const phantomHeight = computed(() => props.data.length * props.itemHeight);

// 滚动处理
function handleScroll(e: Event) {
  scrollTop.value = (e.target as HTMLElement).scrollTop;
}

onMounted(() => {
  containerRef.value?.addEventListener('scroll', handleScroll, { passive: true });
});

onUnmounted(() => {
  containerRef.value?.removeEventListener('scroll', handleScroll);
});
</script>

<style lang="scss" scoped>
.virtual-list {
  position: relative;
  overflow-y: auto;

  .virtual-list-phantom {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    z-index: -1;
  }

  .virtual-list-content {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
  }

  .virtual-list-item {
    box-sizing: border-box;
  }
}
</style>
```

### 3. 图片懒加载
```typescript
// composables/useLazyLoad.ts
import { ref, onMounted, onUnmounted } from 'vue';

export function useLazyLoad() {
  const observer = ref<IntersectionObserver | null>(null);

  function observeElement(element: HTMLElement, callback: () => void) {
    if (!observer.value) {
      observer.value = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              callback();
              observer.value?.unobserve(entry.target);
            }
          });
        },
        {
          rootMargin: '50px'
        }
      );
    }

    observer.value.observe(element);
  }

  onUnmounted(() => {
    observer.value?.disconnect();
  });

  return {
    observeElement
  };
}

// 使用示例
<template>
  <img
    ref="imgRef"
    :src="imageSrc || placeholderSrc"
    @load="handleImageLoad"
    alt="员工头像"
  />
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { useLazyLoad } from '@/composables/useLazyLoad';

const props = defineProps<{
  src: string;
  placeholder?: string;
}>();

const imgRef = ref<HTMLImageElement>();
const imageSrc = ref('');
const placeholderSrc = ref(props.placeholder || '/images/placeholder.png');

const { observeElement } = useLazyLoad();

onMounted(() => {
  if (imgRef.value) {
    observeElement(imgRef.value, () => {
      imageSrc.value = props.src;
    });
  }
});
</script>
```

## 🧪 测试规范

### 单元测试
```typescript
// tests/components/EmployeePerformanceCard.test.ts
import { describe, it, expect, vi } from 'vitest';
import { mount } from '@vue/test-utils';
import { createPinia, setActivePinia } from 'pinia';
import EmployeePerformanceCard from '@/components/business/EmployeePerformanceCard.vue';
import type { EmployeePerformance } from '@/types/performance';

// Mock数据
const mockEmployeeData: EmployeePerformance = {
  id: 1,
  employeeId: 1001,
  employeeName: '张三',
  deptName: '销售一部',
  dataDate: '2024-01-31',
  salesAmount: 50000,
  orderCount: 25,
  profitRate: 25.5,
  orderAmount: 52000,
  visitCustomers: 20,
  purchaseCustomers: 15
};

describe('EmployeePerformanceCard', () => {
  beforeEach(() => {
    setActivePinia(createPinia());
  });

  it('should render employee data correctly', () => {
    const wrapper = mount(EmployeePerformanceCard, {
      props: {
        employeeData: mockEmployeeData
      }
    });

    expect(wrapper.find('.employee-name').text()).toBe('张三');
    expect(wrapper.find('.dept-name').text()).toBe('销售一部');
    expect(wrapper.text()).toContain('¥50,000.00');
    expect(wrapper.text()).toContain('25.50%');
  });

  it('should emit viewDetail event when button clicked', async () => {
    const wrapper = mount(EmployeePerformanceCard, {
      props: {
        employeeData: mockEmployeeData,
        showActions: true
      }
    });

    await wrapper.find('[data-testid="view-detail-btn"]').trigger('click');

    expect(wrapper.emitted('viewDetail')).toBeTruthy();
    expect(wrapper.emitted('viewDetail')?.[0]).toEqual([mockEmployeeData]);
  });

  it('should format currency correctly', () => {
    const wrapper = mount(EmployeePerformanceCard, {
      props: {
        employeeData: mockEmployeeData
      }
    });

    const salesAmountElement = wrapper.find('[data-testid="sales-amount"]');
    expect(salesAmountElement.text()).toBe('¥50,000.00');
  });
});
```

### 集成测试
```typescript
// tests/integration/performance.test.ts
import { describe, it, expect, beforeEach, vi } from 'vitest';
import { mount } from '@vue/test-utils';
import { createRouter, createWebHistory } from 'vue-router';
import { createPinia } from 'pinia';
import EmployeePerformancePage from '@/pages/performance/EmployeePerformancePage.vue';
import { performanceApi } from '@/api/modules/performance';

// Mock API
vi.mock('@/api/modules/performance', () => ({
  performanceApi: {
    getEmployeePerformanceList: vi.fn()
  }
}));

describe('EmployeePerformancePage Integration', () => {
  let router: any;
  let pinia: any;

  beforeEach(() => {
    router = createRouter({
      history: createWebHistory(),
      routes: [
        { path: '/performance/employee', component: EmployeePerformancePage }
      ]
    });

    pinia = createPinia();

    // Mock API响应
    vi.mocked(performanceApi.getEmployeePerformanceList).mockResolvedValue({
      code: 200,
      message: '查询成功',
      data: {
        total: 2,
        list: [mockEmployeeData],
        pageNum: 1,
        pageSize: 20,
        pages: 1
      }
    });
  });

  it('should load and display employee performance data', async () => {
    const wrapper = mount(EmployeePerformancePage, {
      global: {
        plugins: [router, pinia]
      }
    });

    // 等待数据加载
    await wrapper.vm.$nextTick();
    await new Promise(resolve => setTimeout(resolve, 100));

    // 验证API调用
    expect(performanceApi.getEmployeePerformanceList).toHaveBeenCalled();

    // 验证数据渲染
    expect(wrapper.find('[data-testid="performance-list"]').exists()).toBe(true);
    expect(wrapper.findAll('[data-testid="performance-item"]')).toHaveLength(1);
  });
});
```

## 📱 移动端适配规范

### 响应式设计
```scss
// styles/responsive.scss

// 断点定义
$breakpoints: (
  xs: 0,
  sm: 576px,
  md: 768px,
  lg: 992px,
  xl: 1200px,
  xxl: 1400px
);

// 媒体查询混入
@mixin respond-to($breakpoint) {
  @if map-has-key($breakpoints, $breakpoint) {
    @media (min-width: map-get($breakpoints, $breakpoint)) {
      @content;
    }
  }
}

// 移动端优先设计
.performance-card {
  padding: 12px;
  font-size: 14px;

  @include respond-to(sm) {
    padding: 16px;
    font-size: 15px;
  }

  @include respond-to(md) {
    padding: 20px;
    font-size: 16px;
  }

  @include respond-to(lg) {
    padding: 24px;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
}

// 安全区域适配
.safe-area-page {
  padding-top: constant(safe-area-inset-top);
  padding-top: env(safe-area-inset-top);
  padding-bottom: constant(safe-area-inset-bottom);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: constant(safe-area-inset-left);
  padding-left: env(safe-area-inset-left);
  padding-right: constant(safe-area-inset-right);
  padding-right: env(safe-area-inset-right);
}
```

### 触摸交互优化
```scss
// 触摸目标大小
.touch-target {
  min-height: 44px; // iOS推荐最小触摸目标
  min-width: 44px;

  // Android推荐48dp
  @media (max-width: 768px) {
    min-height: 48px;
    min-width: 48px;
  }
}

// 触摸反馈
.interactive-element {
  transition: all 0.2s ease;
  cursor: pointer;

  &:active {
    transform: scale(0.98);
    opacity: 0.8;
  }

  // 禁用长按选择
  -webkit-user-select: none;
  user-select: none;

  // 禁用点击高亮
  -webkit-tap-highlight-color: transparent;

  // 禁用双击缩放
  touch-action: manipulation;
}

// 滑动手势
.swipe-item {
  position: relative;
  overflow: hidden;

  .swipe-content {
    transition: transform 0.3s ease;
  }

  .swipe-actions {
    position: absolute;
    top: 0;
    right: 0;
    height: 100%;
    display: flex;
    align-items: center;
    background: var(--error-color);
    color: white;
    padding: 0 16px;
    transform: translateX(100%);
    transition: transform 0.3s ease;
  }

  &.swiped {
    .swipe-content {
      transform: translateX(-80px);
    }

    .swipe-actions {
      transform: translateX(0);
    }
  }
}
```

## 🔒 安全开发规范

### XSS防护
```typescript
// utils/security.ts

/**
 * HTML转义
 */
export function escapeHtml(text: string): string {
  const map: Record<string, string> = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  };

  return text.replace(/[&<>"']/g, (m) => map[m]);
}

/**
 * 过滤危险标签
 */
export function sanitizeHtml(html: string): string {
  const dangerousTags = /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi;
  const dangerousAttrs = /on\w+\s*=/gi;

  return html
    .replace(dangerousTags, '')
    .replace(dangerousAttrs, 'data-removed=');
}

/**
 * 验证URL安全性
 */
export function isValidUrl(url: string): boolean {
  try {
    const urlObj = new URL(url);
    return ['http:', 'https:'].includes(urlObj.protocol);
  } catch {
    return false;
  }
}

/**
 * CSP内容安全策略
 */
export function setupCSP() {
  const meta = document.createElement('meta');
  meta.httpEquiv = 'Content-Security-Policy';
  meta.content = [
    "default-src 'self'",
    "script-src 'self' 'unsafe-inline' 'unsafe-eval'",
    "style-src 'self' 'unsafe-inline'",
    "img-src 'self' data: https:",
    "font-src 'self' data:",
    "connect-src 'self' https://api.business-analysis.com",
    "frame-src 'none'",
    "object-src 'none'"
  ].join('; ');

  document.head.appendChild(meta);
}
```

### 数据验证
```typescript
// composables/useValidation.ts
import { ref, computed, reactive } from 'vue';

interface ValidationRule {
  required?: boolean;
  minLength?: number;
  maxLength?: number;
  pattern?: RegExp;
  validator?: (value: any) => string | true;
  message?: string;
}

export function useValidation<T extends Record<string, any>>(
  initialData: T,
  rules: Record<keyof T, ValidationRule[]>
) {
  const formData = ref<T>({ ...initialData });
  const errors = reactive<Partial<Record<keyof T, string>>>({});
  const touched = reactive<Partial<Record<keyof T, boolean>>>({});

  const isValid = computed(() => {
    return Object.keys(errors).length === 0;
  });

  const hasErrors = computed(() => {
    return Object.keys(errors).some(key => touched[key as keyof T]);
  });

  function validateField(field: keyof T): boolean {
    const fieldRules = rules[field] || [];
    const value = formData.value[field];

    // 标记字段已被触摸
    touched[field] = true;

    for (const rule of fieldRules) {
      // 必填验证
      if (rule.required && (!value || value === '')) {
        errors[field] = rule.message || '此字段为必填项';
        return false;
      }

      // 如果值为空且非必填，跳过其他验证
      if (!value && !rule.required) {
        delete errors[field];
        continue;
      }

      // 最小长度验证
      if (rule.minLength && value.length < rule.minLength) {
        errors[field] = rule.message || `最少输入${rule.minLength}个字符`;
        return false;
      }

      // 最大长度验证
      if (rule.maxLength && value.length > rule.maxLength) {
        errors[field] = rule.message || `最多输入${rule.maxLength}个字符`;
        return false;
      }

      // 正则验证
      if (rule.pattern && !rule.pattern.test(value)) {
        errors[field] = rule.message || '格式不正确';
        return false;
      }

      // 自定义验证
      if (rule.validator) {
        const result = rule.validator(value);
        if (result !== true) {
          errors[field] = result;
          return false;
        }
      }
    }

    // 验证通过，清除错误
    delete errors[field];
    return true;
  }

  function validateAll(): boolean {
    let valid = true;

    for (const field in rules) {
      if (!validateField(field)) {
        valid = false;
      }
    }

    return valid;
  }

  function resetValidation() {
    Object.keys(errors).forEach(key => {
      delete errors[key as keyof T];
    });
    Object.keys(touched).forEach(key => {
      touched[key as keyof T] = false;
    });
  }

  function resetForm() {
    formData.value = { ...initialData };
    resetValidation();
  }

  return {
    formData,
    errors,
    touched,
    isValid,
    hasErrors,
    validateField,
    validateAll,
    resetValidation,
    resetForm
  };
}
```

## 📊 图表组件规范

### ECharts封装组件
```vue
<!-- components/charts/PerformanceTrendChart.vue -->
<template>
  <div class="performance-trend-chart">
    <div class="chart-header">
      <h3 class="chart-title">{{ title }}</h3>
      <div class="chart-controls">
        <van-button
          v-for="period in timePeriods"
          :key="period.value"
          size="mini"
          :type="selectedPeriod === period.value ? 'primary' : 'default'"
          @click="handlePeriodChange(period.value)"
        >
          {{ period.label }}
        </van-button>
      </div>
    </div>

    <base-chart
      :option="chartOption"
      :height="chartHeight"
      @chart-click="handleChartClick"
    />

    <div class="chart-summary" v-if="showSummary">
      <div class="summary-item" v-for="item in summaryData" :key="item.key">
        <span class="summary-label">{{ item.label }}</span>
        <span class="summary-value" :class="item.className">{{ item.value }}</span>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch } from 'vue';
import type { EChartsOption } from 'echarts';
import BaseChart from '@/components/charts/BaseChart.vue';
import { formatCurrency, formatPercent } from '@/utils/format';

interface Props {
  title: string;
  data: Array<{
    date: string;
    value: number;
    compareValue?: number;
  }>;
  chartHeight?: string;
  showSummary?: boolean;
  metric?: 'amount' | 'count' | 'rate';
}

const props = withDefaults(defineProps<Props>(), {
  chartHeight: '300px',
  showSummary: true,
  metric: 'amount'
});

interface Emits {
  periodChange: [period: string];
  chartClick: [data: any];
}

const emit = defineEmits<Emits>();

// 时间周期选项
const timePeriods = [
  { label: '7天', value: '7d' },
  { label: '30天', value: '30d' },
  { label: '90天', value: '90d' }
];

const selectedPeriod = ref('30d');

// 图表配置
const chartOption = computed<EChartsOption>(() => {
  const xAxisData = props.data.map(item => item.date);
  const seriesData = props.data.map(item => item.value);
  const compareData = props.data.map(item => item.compareValue || 0);

  return {
    tooltip: {
      trigger: 'axis',
      formatter: (params: any) => {
        const data = params[0];
        const value = formatValue(data.value);
        return `${data.axisValue}<br/>${data.seriesName}: ${value}`;
      }
    },
    legend: {
      data: ['当期', '上期']
    },
    xAxis: {
      type: 'category',
      data: xAxisData,
      axisLabel: {
        rotate: 45
      }
    },
    yAxis: {
      type: 'value',
      axisLabel: {
        formatter: (value: number) => formatValue(value)
      }
    },
    series: [
      {
        name: '当期',
        type: 'line',
        data: seriesData,
        smooth: true,
        itemStyle: {
          color: '#1890ff'
        },
        areaStyle: {
          opacity: 0.3
        }
      },
      {
        name: '上期',
        type: 'line',
        data: compareData,
        smooth: true,
        itemStyle: {
          color: '#52c41a'
        },
        lineStyle: {
          type: 'dashed'
        }
      }
    ]
  };
});

// 汇总数据
const summaryData = computed(() => {
  const total = props.data.reduce((sum, item) => sum + item.value, 0);
  const average = total / props.data.length;
  const max = Math.max(...props.data.map(item => item.value));
  const min = Math.min(...props.data.map(item => item.value));

  return [
    {
      key: 'total',
      label: '总计',
      value: formatValue(total),
      className: 'text-primary'
    },
    {
      key: 'average',
      label: '平均',
      value: formatValue(average),
      className: 'text-info'
    },
    {
      key: 'max',
      label: '最高',
      value: formatValue(max),
      className: 'text-success'
    },
    {
      key: 'min',
      label: '最低',
      value: formatValue(min),
      className: 'text-warning'
    }
  ];
});

// 格式化数值
function formatValue(value: number): string {
  switch (props.metric) {
    case 'amount':
      return formatCurrency(value);
    case 'rate':
      return formatPercent(value);
    default:
      return value.toLocaleString();
  }
}

// 时间周期变化
function handlePeriodChange(period: string) {
  selectedPeriod.value = period;
  emit('periodChange', period);
}

// 图表点击
function handleChartClick(params: any) {
  emit('chartClick', params);
}
</script>

<style lang="scss" scoped>
.performance-trend-chart {
  background: white;
  border-radius: var(--border-radius-lg);
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-md);
  box-shadow: var(--shadow-sm);

  .chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-md);

    .chart-title {
      font-size: var(--font-size-lg);
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .chart-controls {
      display: flex;
      gap: var(--spacing-xs);
    }
  }

  .chart-summary {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--spacing-sm);
    margin-top: var(--spacing-md);
    padding-top: var(--spacing-md);
    border-top: 1px solid var(--border-color);

    @include respond-to(md) {
      grid-template-columns: repeat(4, 1fr);
    }

    .summary-item {
      text-align: center;

      .summary-label {
        display: block;
        font-size: var(--font-size-sm);
        color: var(--text-secondary);
        margin-bottom: var(--spacing-xs);
      }

      .summary-value {
        display: block;
        font-size: var(--font-size-md);
        font-weight: 600;

        &.text-primary { color: var(--primary-color); }
        &.text-success { color: var(--success-color); }
        &.text-warning { color: var(--warning-color); }
        &.text-info { color: var(--info-color); }
      }
    }
  }
}
</style>
```

## 🔄 状态管理最佳实践

### Pinia Store模块化
```typescript
// stores/modules/performance.ts
import { defineStore } from 'pinia';
import { ref, reactive, computed } from 'vue';
import { performanceApi } from '@/api/modules/performance';
import type { EmployeePerformance, PerformanceQuery } from '@/types/performance';

export const usePerformanceStore = defineStore('performance', () => {
  // 状态
  const performanceList = ref<EmployeePerformance[]>([]);
  const loading = ref(false);
  const currentVersion = ref<string>('');
  const lastUpdateTime = ref<string>('');

  // 查询条件
  const queryParams = reactive<PerformanceQuery>({
    pageNum: 1,
    pageSize: 20,
    startDate: '',
    endDate: '',
    sortField: 'salesAmount',
    sortOrder: 'desc',
    filters: {}
  });

  // 分页信息
  const pagination = reactive({
    total: 0,
    pageNum: 1,
    pageSize: 20,
    pages: 0,
    hasNext: false,
    hasPrev: false
  });

  // 计算属性
  const totalSales = computed(() =>
    performanceList.value.reduce((sum, item) => sum + item.salesAmount, 0)
  );

  const averageSales = computed(() =>
    performanceList.value.length > 0 ? totalSales.value / performanceList.value.length : 0
  );

  const topPerformer = computed(() =>
    performanceList.value.reduce((top, current) =>
      current.salesAmount > top.salesAmount ? current : top,
      performanceList.value[0]
    )
  );

  // 方法
  async function fetchPerformanceList(params?: Partial<PerformanceQuery>) {
    loading.value = true;
    try {
      if (params) {
        Object.assign(queryParams, params);
      }

      const response = await performanceApi.getEmployeePerformanceList(queryParams);

      if (queryParams.pageNum === 1) {
        performanceList.value = response.data.list;
      } else {
        performanceList.value.push(...response.data.list);
      }

      Object.assign(pagination, {
        total: response.data.total,
        pageNum: response.data.pageNum,
        pageSize: response.data.pageSize,
        pages: response.data.pages,
        hasNext: response.data.hasNext,
        hasPrev: response.data.hasPrev
      });

      lastUpdateTime.value = new Date().toISOString();

      return response;
    } catch (error) {
      throw error;
    } finally {
      loading.value = false;
    }
  }

  async function refreshData() {
    queryParams.pageNum = 1;
    return fetchPerformanceList();
  }

  function resetQuery() {
    Object.assign(queryParams, {
      pageNum: 1,
      pageSize: 20,
      startDate: '',
      endDate: '',
      sortField: 'salesAmount',
      sortOrder: 'desc',
      filters: {}
    });
    performanceList.value = [];
    Object.assign(pagination, {
      total: 0,
      pageNum: 1,
      pageSize: 20,
      pages: 0,
      hasNext: false,
      hasPrev: false
    });
  }

  function updateEmployee(employeeId: number, updates: Partial<EmployeePerformance>) {
    const index = performanceList.value.findIndex(item => item.employeeId === employeeId);
    if (index !== -1) {
      Object.assign(performanceList.value[index], updates);
    }
  }

  return {
    // 状态
    performanceList,
    loading,
    currentVersion,
    lastUpdateTime,
    queryParams,
    pagination,
    // 计算属性
    totalSales,
    averageSales,
    topPerformer,
    // 方法
    fetchPerformanceList,
    refreshData,
    resetQuery,
    updateEmployee
  };
});
```

---

**文档版本**: v1.0
**最后更新**: 2024年8月
**维护团队**: 前端开发组

> 本文档规范了移动端APP的完整开发标准，包括技术架构、组件设计、性能优化、安全规范等。所有前端开发人员必须严格遵循此规范，确保代码质量和用户体验。

## 🛣️ 路由配置规范

### 路由结构设计
```typescript
// router/index.ts
import { createRouter, createWebHistory } from 'vue-router';
import { useAuthStore } from '@/stores/auth';
import type { RouteRecordRaw } from 'vue-router';

// 路由配置
const routes: RouteRecordRaw[] = [
  {
    path: '/',
    redirect: '/home'
  },
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/pages/auth/LoginPage.vue'),
    meta: {
      title: '登录',
      requiresAuth: false,
      keepAlive: false
    }
  },
  {
    path: '/home',
    name: 'Home',
    component: () => import('@/pages/home/HomePage.vue'),
    meta: {
      title: '首页',
      requiresAuth: true,
      keepAlive: true,
      tabBar: true
    }
  },
  {
    path: '/performance',
    name: 'Performance',
    component: () => import('@/pages/performance/PerformanceLayout.vue'),
    meta: {
      title: '业绩分析',
      requiresAuth: true,
      keepAlive: true,
      tabBar: true
    },
    children: [
      {
        path: 'employee',
        name: 'EmployeePerformance',
        component: () => import('@/pages/performance/EmployeePerformancePage.vue'),
        meta: {
          title: '员工业绩',
          requiresAuth: true,
          keepAlive: true
        }
      }
    ]
  }
];

const router = createRouter({
  history: createWebHistory(),
  routes
});

// 路由守卫
router.beforeEach((to, from, next) => {
  const authStore = useAuthStore();

  // 设置页面标题
  document.title = to.meta.title as string || '经营分析';

  // 检查登录状态
  if (to.meta.requiresAuth && !authStore.isLoggedIn) {
    next('/login');
    return;
  }

  next();
});

export default router;
```

## ⚡ 性能优化规范

### 1. 组件懒加载
```typescript
// 路由懒加载
const routes = [
  {
    path: '/performance',
    component: () => import('@/pages/performance/PerformancePage.vue')
  }
];

// 组件懒加载
import { defineAsyncComponent } from 'vue';

const AsyncChart = defineAsyncComponent({
  loader: () => import('@/components/charts/PerformanceChart.vue'),
  loadingComponent: () => import('@/components/common/LoadingSpinner.vue'),
  errorComponent: () => import('@/components/common/ErrorMessage.vue'),
  delay: 200,
  timeout: 3000
});
```

### 2. 缓存策略
```typescript
// composables/useCache.ts
import { ref, computed } from 'vue';

interface CacheOptions {
  ttl?: number; // 缓存时间(秒)
  key: string;  // 缓存键
}

export function useCache<T>(options: CacheOptions) {
  const { ttl = 300, key } = options;

  const cacheData = ref<T | null>(null);
  const cacheTime = ref<number>(0);

  const isExpired = computed(() => {
    if (!cacheTime.value) return true;
    return Date.now() - cacheTime.value > ttl * 1000;
  });

  function setCache(data: T) {
    cacheData.value = data;
    cacheTime.value = Date.now();

    // 存储到localStorage
    localStorage.setItem(key, JSON.stringify({
      data,
      timestamp: cacheTime.value
    }));
  }

  function getCache(): T | null {
    if (cacheData.value && !isExpired.value) {
      return cacheData.value;
    }

    // 从localStorage读取
    const cached = localStorage.getItem(key);
    if (cached) {
      const { data, timestamp } = JSON.parse(cached);
      if (Date.now() - timestamp < ttl * 1000) {
        cacheData.value = data;
        cacheTime.value = timestamp;
        return data;
      }
    }

    return null;
  }

  return {
    cacheData,
    isExpired,
    setCache,
    getCache
  };
}
```

---

**文档版本**: v1.0
**最后更新**: 2024年8月
**维护团队**: 前端开发组
