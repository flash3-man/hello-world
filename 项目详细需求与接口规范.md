# 超悦业务管理系统 — 详细需求与接口规范

本文档汇总项目的业务需求、页面/路由与交互规范、数据模型定义，以及与后端进行交互时所需的接口、参数、请求/响应结构与错误约定。用于前后端协作、评审、开发与验收。

## 1. 项目概述

- 名称：超悦业务管理系统（PWA + Web + 可打包 Electron）
- 技术栈：Vue 3、Vue Router、ES6+、CSS3，构建工具 Vue CLI 5；服务端交互采用 RESTful API；支持 PWA/离线缓存。
- 目标：为企业管理者提供围绕“员工、客户、商品、资金”的数据洞察，支撑目标管理、业绩分析、拜访分析、铺市/市场分析、报表导出等决策流程。

## 2. 业务目标

- 提升经营透明度：提供首页关键指标、风险播报与快速入口。
- 提升分析效率：多维度业绩对比、员工 360° 分析、拜访覆盖与转化分析。
- 提升目标管理：公司/部门/员工三级目标拆解与跟踪。
- 提升执行闭环：从“发现问题 → 下钻到人/客/品 → 导出与跟进”的完整链路。

## 3. 用户与场景

- 管理者（公司/区域/部门负责人）：看总览、对比、极值、导出；聚焦异常和标杆。
- 中层/一线（主管/员工）：看个人/小组指标变化、目标进度、客户清单与拜访任务。

## 4. 页面与路由

系统采用 SPA，核心路由如下（参照 `src/router/index.js`）：

- `/` 首页看板 HomePage
- `/employee-analysis` 员工整体分析 EmployeeAnalysis
- `/employee-detail-analysis` 员工详细分析 EmployeeDetailAnalysis
- `/visit-analysis` 拜访分析 VisitAnalysis（新增）
- `/performance-analysis` 业绩变化分析 PerformanceAnalysis
- `/employee-performance` 员工业绩汇总 EmployeePerformance
- `/goal-management` 目标管理 GoalManagement
- `/monthly-report` 综合月报 MonthlyReport
- `/market-analysis` 铺市分析 MarketAnalysis
- `/customer-analysis` 客户分析 CustomerAnalysis
- `/customer-return` 客户销退汇总 CustomerReturn
- `/quick-access` 快捷访问 QuickAccessPage
- `/department-goal-detail/:goalId` 部门目标明细 DepartmentGoalDetail
- `/employee-dynamics` 员工动态 EmployeeDynamics

## 5. 交互与视觉规范（移动优先）

- 色彩：主色蓝 #1677FF / iOS 蓝 #007AFF；风险橙 #FF7D00；增长绿 #00B42A；下降红 #F53F3F；文本主黑 #111~#000；辅灰 #333/#666/#999。
- 布局：移动端遵循“顶部导航 → 筛选 → 数据 → 底部操作”；表格行高 44px，表头吸顶；解读区行距 1.5；关键极值用色强化（最低红、最高蓝）。
- 可用性：可排序（升/降）、可下钻、导出、Lazy/分页、横向滚动（小屏多列）。

## 6. 功能模块需求（摘要）

### 6.1 首页看板
- 指标总览、经营风险播报（异常/提醒）、快速功能入口（可配置）。
- 指标卡点击跳转对应明细（业绩/客户/订单等）。

### 6.2 员工整体分析 EmployeeAnalysis
- 维度切换：拜访/销售/铺市/利润；支持日期选择、指标说明、排序与详情跳转。
- 典型指标：拜访覆盖、拜访效率、销售额/单数/客数、转化率等。

### 6.3 员工详细分析 EmployeeDetailAnalysis
- 360° 分析：综合雷达、订单能力、销售趋势、退货/回款；时间对比、图形可放大、详情下钻。

### 6.4 业绩变化分析 PerformanceAnalysis
- 指标（销售额/单数/客数/客单价…）× 维度（片区/员工/客户/商品/品牌/分类），支持日期选择、排序、下钻（员工/客户…）。

### 6.5 拜访分析 VisitAnalysis（新增）
- 顶部：返回、标题、导出；标题下方左侧显示日期范围选择。
- 指标切换：客户拜访率/拜访下单率（按钮组居中）。
- 解读区：平均值、低于平均人数、最低/最高员工与数据（居中展示）。
- 数据表：员工名称（可点击进入个人详情）、拜访客户数、负责客户数/下单客户数、指标列；全部支持排序；移动端横向滚动；极值用色标注。

### 6.6 铺市/客户分析、月报、目标管理、快捷访问
- 铺市：覆盖率、未覆盖客户清单、区域/员工维度统计与导出。
- 客户分析：客户覆盖、客户清单与基础画像、最近订单。
- 月报/日报：核心业务指标、同比环比、指标说明与跳转联动。
- 目标管理：公司/部门/员工三级目标，筛选、排序、进度与异常提示。
- 快捷访问：功能聚合、搜索与个性化配置。

## 7. 数据模型（前后端对齐）

```js
Employee {
  id: Number,
  name: String,
  avatar?: String,
  department?: String,
  position?: String,
  status?: 'active' | 'inactive'
}

PerformanceData {
  id: Number,
  employeeId: Number,
  period: String, // YYYY-MM / YYYY-MM-DD
  salesAmount: Number,
  orderCount: Number,
  customerCount: Number,
  visitCount: Number,
  conversionRate: Number,
  growthRate?: Number,
  trend?: 'up' | 'down' | 'stable'
}

Customer {
  id: Number,
  name: String,
  address?: String,
  region?: String,
  status?: 'covered' | 'uncovered' | 'new' | 'lost',
  lastOrderDate?: string,
  totalOrders?: Number,
  totalAmount?: Number
}

Order {
  id: Number,
  orderNo: String,
  customerId: Number,
  employeeId: Number,
  amount: Number,
  quantity: Number,
  status: 'pending' | 'confirmed' | 'shipped' | 'completed' | 'cancelled',
  orderDate: string,
  deliveryDate?: string,
  paymentStatus?: 'unpaid' | 'partial' | 'paid',
  products: Array<{ id:number; name:string; sku?:string; quantity:number; price:number; amount:number }>
}

Goal {
  id: Number,
  level: 'company' | 'department' | 'employee',
  name: String,
  metric: 'sales-amount' | 'order-count' | 'customer-count' | 'coverage' | string,
  target: Number,
  current: Number,
  completionRate: Number,
  period: { start: string; end: string },
  status: 'in-progress' | 'completed' | 'delayed'
}
```

## 8. 接口调用总规范

- Base URL：`https://api.company.com/v1`（测试/生产分环境）
- 认证：Bearer Token（请求头 `Authorization: Bearer <token>`）
- 通用请求头：`Content-Type: application/json; charset=UTF-8`
- 时间格式：ISO 8601（UTC）或 `YYYY-MM-DD`/`YYYY-MM`
- 通用响应结构：

```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": "2025-01-01T10:00:00Z",
  "requestId": "req_xxx"
}
```

- 通用错误结构（节选）：

```json
{
  "code": 400,
  "message": "请求参数错误",
  "error": {
    "type": "VALIDATION_ERROR",
    "details": [{ "field": "employeeId", "message": "员工ID不能为空" }]
  },
  "timestamp": "2025-01-01T10:00:00Z",
  "requestId": "req_xxx"
}
```

## 9. 模块接口清单（请求参数与返回结构）

以下接口源自并整合了现有《API接口文档.md》，同时补充了与新“拜访分析”页面的对齐说明。

### 9.1 认证
- 登录：`POST /auth/login`
- 刷新 Token：`POST /auth/refresh`

### 9.2 首页概览
- 概览数据：`GET /dashboard/overview?dateRange=YYYY-MM-DD,YYYY-MM-DD`
- 数据详情：`GET /dashboard/data-detail/{type}`（type: sales/orders/customers/employees）

### 9.3 员工整体分析/拜访分析

用于“员工整体分析”与“拜访分析（VisitAnalysis）”页面：

- 整体分析：`GET /employees/analysis`
  - params：
    - `dimension`: `visit|sales|market|profit`（拜访分析使用 `visit`）
    - `dateRange`: `YYYY-MM-DD,YYYY-MM-DD`
    - `sortBy`: `visits|sales|customers|conversionRate|...`
    - `sortOrder`: `asc|desc`
    - `page`, `pageSize`
  - response.data：
    - summary: { totalEmployees, activeEmployees, avgPerformance, ... }
    - employees: [{ id, name, department, rank, performance: { visits, sales, customers, orders, conversionRate, growth }, ... }]
    - pagination

拜访分析页面所需字段映射：
- 拜访客户数：`performance.visits` 或后端返回 `visitedCustomers`
- 负责客户数：建议后端扩展 `responsibleCustomers`
- 拜访下单客户数：建议后端扩展 `orderedCustomers`
- 客户拜访率：`visitedCustomers / responsibleCustomers`
- 拜访下单率：`orderedCustomers / visitedCustomers`

为避免前端二次聚合成本，建议新增/补充：
- `GET /employees/visit-stats`
  - params：`dateRange`, `departmentId?`, `keyword?`, `sortField?=visitRate|orderRate|visitedCustomers|responsibleCustomers|orderedCustomers`, `sortOrder?=asc|desc`, `page?`, `pageSize?`
  - response.data.employees：`[{ id, name, visitedCustomers, responsibleCustomers, orderedCustomers, visitRate, orderRate }]`

### 9.4 员工详细分析
- `GET /employees/{employeeId}/detail-analysis`
  - params：`statisticalPeriod`, `comparisonPeriod`
  - response：员工基础信息、雷达、订单能力、销售/均价趋势、退货、回款等结构（参考现有文档）。

### 9.5 业绩变化分析
- `GET /performance/analysis`
  - params：`metric`, `dimension`, `currentDate`, `compareDate`, `businessCategory?`, `sortField?`, `sortOrder?`, `page?`, `pageSize?`
  - response：summary、analysisData（支持 rank、trend、contribution）、drilldownOptions、pagination。
- 下钻：`GET /performance/drilldown?parentId=&drilldownType=&metric=&dateRange=`

### 9.6 铺市分析
- `GET /market/analysis?dateRange=&analysisType=&region=&employeeId=`
- 客户清单：`GET /market/customers?employeeId=&status=&page=&pageSize=`

### 9.7 客户管理
- 客户列表：`GET /customers?keyword=&region=&status=&employeeId=&page=&pageSize=`
- 客户详情：`GET /customers/{customerId}`（包含统计与最近订单）

### 9.8 订单管理
- 订单列表：`GET /orders?...`
- 创建订单：`POST /orders`

### 9.9 报表导出
- 创建导出任务：`POST /reports/employee-performance/export`
- 查询导出状态：`GET /reports/export-status/{taskId}`

### 9.10 系统配置/用户偏好
- 获取配置：`GET /system/config`
- 更新偏好：`PUT /users/preferences`

## 10. 字段与参数约定（关键项）

- `dateRange`：字符串，格式 `start,end`，闭区间；服务端负责兜底校验。
- 分页：`page`（1 起），`pageSize`（默认 20，最大建议 100）。
- 排序：`sortField` + `sortOrder`（asc/desc）。
- 货币：以分或元为单位（需统一）；响应返回应明确单位，建议以元返回且保留两位小数。
- 百分比：0~1 之间的浮点（由前端渲染百分号），或直接返回百分号字符串（需统一，建议数值）。

## 11. 错误码与幂等

- 认证相关：`401 INVALID_TOKEN`，需要跳转登录或刷新 Token。
- 权限：`403 PERMISSION_DENIED`。
- 频控：`429 RATE_LIMIT_EXCEEDED`；建议返回 `retryAfter` 秒。
- 幂等：导出、创建类接口建议提供 `Idempotency-Key` 请求头。

## 12. 安全与合规

- HTTPS/TLS；敏感头与 Token 不落本地持久化（或设置有效期/刷新机制）。
- CORS 按域白名单；CSRF 视后台策略；日志脱敏（手机号、身份证、坐标等）。

## 13. 性能与缓存

- 列表分页 + 后端排序；可选 Cursor/Keyset 分页。
- 懒加载与按需返回（字段可裁剪）；静态资源长缓存；接口 ETag/Last-Modified。

## 14. 验收标准（示例）

- 页面正确渲染并满足交互：筛选、排序、切换、下钻、导出。
- 指标口径与后端对齐：公式/颗粒度/时间范围一致；随机抽样核对 5% 数据。
- 性能：95% 请求 < 2s；首屏 < 2s（3G），交互 < 100ms。
- 可用性：移动端滚动/横向滚动顺畅，表头吸顶与行高 44px，极值高亮，从首页到明细跳转链路闭环。

## 15. 与后端对齐清单（落地所需）

1) 确认“拜访分析”页面数据来源：
   - 复用 `GET /employees/analysis?dimension=visit` 或提供 `GET /employees/visit-stats` 返回 `{ visitedCustomers, responsibleCustomers, orderedCustomers, visitRate, orderRate }`。
2) 明确指标口径：
   - 客户拜访率 = 拜访客户数 / 负责客户数；拜访下单率 = 拜访下单客户数 / 拜访客户数。
3) 统一时间与单位：日期、金额、百分比、时区。
4) 列表排序字段：`visitedCustomers|responsibleCustomers|orderedCustomers|visitRate|orderRate`。
5) 报表导出：任务创建与轮询、下载 URL、过期时间。

——

更新日期：2025-08-13
维护人：前端 / 后端共同维护


